"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[711],{34711:function(e,t,n){n.r(t),n.d(t,{default:function(){return z}});var i=n(72791),r=n(20803),a=n(50228),o=n(11210),s=n(64880),l=n(74165),d=n(15861),c=n(70885),u=n(85554),f=n(57337),m=n(89721),p=n(91482),h=n(95178),g=n(16263),x=n(45586),v=n(31128),j=n(74142),Z=n(52797),y=n(13811),w=n(16992),C=n(65348),b=n(60788),S=n(8440),k=n(59911),N=n(77248),D=n(52898),A=function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,i,r,a,o){var s,d,c;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=[t,n].sort().join("."),d=s.toLowerCase()+a,c=[i,r].sort().join(" and "),u.ZP.createNewRoom(s.toLowerCase()),u.ZP.setOwner(s.toLowerCase()),u.ZP.roomConfig(s.toLowerCase(),{roomName:c}),u.ZP.subsribe(d),u.ZP.presenceInRoom(d),setTimeout((function(){var e;u.ZP.sendInvite((e=t)?e.replace(/([A-Z])/g,"_$1").toLowerCase():"invalid string passed",d.toLowerCase(),o)}),1e3),e.abrupt("return",{roomJid:d,roomName:c});case 10:case"end":return e.stop()}}),e)})));return function(t,n,i,r,a,o){return e.apply(this,arguments)}}(),I=n(80184),P=function(e){var t=e.message,n=e.userJid,r=e.position,a=e.buttonSender,l=e.chooseDirectRoom,d=t.data.senderFirstName,m=t.data.senderLastName,P=t.data.senderJID,J=(0,s.k6)(),R=(0,i.useState)(),M=(0,c.Z)(R,2),K=M[0],L=M[1],E=(0,j.Z)(),z=(0,Z.Z)(E.breakpoints.down("md")),T=(0,i.useState)(!1),U=(0,c.Z)(T,2),F=U[0],_=U[1],B=i.useState(null),W=(0,c.Z)(B,2),O=W[0],q=W[1],V=(0,i.useState)("transfer"),H=(0,c.Z)(V,2),Y=H[0],$=H[1],G=(0,i.useState)(""),Q=(0,c.Z)(G,2),X=Q[0],ee=Q[1],te=Boolean(O),ne=(0,i.useState)(""),ie=(0,c.Z)(ne,2),re=ie[0],ae=ie[1],oe=(0,o.K)((function(e){return e.balance})).filter((function(e){return!e.tokenType&&e.contractAddress.length>10})),se=(0,i.useState)(),le=(0,c.Z)(se,2),de=(le[0],le[1]),ce=(0,o.K)((function(e){return e.user})),ue=(0,o.K)((function(e){return e.loaderArchive}));return(0,i.useEffect)((function(){t.data.quickReplies&&L(JSON.parse(t.data.quickReplies)),(0,f.k2)(ce.walletAddress).then((function(e){de(e.data.result)}))}),[]),(0,I.jsxs)("div",{is:"Message",children:[r.separator?(0,I.jsx)(v.it,{children:r.separator}):null,(0,I.jsxs)(v.v0,{model:{sender:d+" "+m,direction:String(n).split("/")[0]===String(P).split("/")[0]?"outgoing":"incoming",position:r.position},avatarPosition:String(n).split("/")[0]===String(P).split("/")[0]?"tr":"tl",avatarSpacer:"first"!==r.type&&"single"!==r.type,children:[("first"===r.type||"single"===r.type)&&(0,I.jsx)("img",{style:{borderRadius:"50%",boxSizing:"border-box",width:"42px",height:"42px",cursor:"pointer"},onClick:function(){return J.push("/profile/"+t.data.senderWalletAddress)},is:"Avatar",src:t.data.photoURL,onError:function(e){var t=e.currentTarget;t.onerror=null,t.src="https://icotar.com/initials/"+d+" "+m},alt:d}),(0,I.jsxs)(v.v0.CustomContent,{children:[("first"===r.type||"single"===r.type)&&(0,I.jsxs)("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,I.jsxs)("strong",{style:{cursor:"pointer"},onClick:function(){return J.push("/profile/"+t.data.senderWalletAddress)},children:[d," ",m,(0,I.jsx)("br",{})]}),String(n).split("/")[0]!==String(P).split("/")[0]?(0,I.jsx)(y.Z,{"aria-label":"more",id:"long-button","aria-controls":te?"long-menu":void 0,"aria-expanded":te?"true":void 0,"aria-haspopup":"true",onClick:function(e){q(e.currentTarget)},children:(0,I.jsx)(D.Z,{})}):null]}),t.data.isMediafile&&"image"===t.data.mimetype.split("/")[0]?(0,I.jsx)(v.v0.ImageContent,{src:t.data.location,alt:t.data.originalName,width:200}):null,t.data.isMediafile&&"application"===t.data.mimetype.split("/")[0]?(0,I.jsxs)("a",{target:"_blank",href:t.data.location,children:[(0,I.jsx)(v.v0.ImageContent,{src:t.data.locationPreview,alt:t.data.originalName,width:150}),t.data.mimetype.split("/")[1]]}):null,t.data.isMediafile&&"video"===t.data.mimetype.split("/")[0]?(0,I.jsxs)("video",{controls:!0,width:"200px",children:[(0,I.jsx)("source",{src:t.data.location,type:t.data.mimetype,title:t.data.originalName}),"Sorry, your browser doesn't support videos."]}):null,t.data.isMediafile?null:t.body]}),("last"===r.type||"single"===r.type)&&(0,I.jsx)(v.v0.Footer,{sentTime:(0,h.Z)(new Date,new Date(t.date))>5?(0,p.Z)(new Date(t.date),"h:mm:ss a"):(0,g.Z)((0,x.Z)(new Date(t.date),0),new Date,{addSuffix:!0})})]},t.key),K?(0,I.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"max-content",marginLeft:"45px"},children:K.map((function(e,t){return(0,I.jsx)(v.zx,{onClick:function(){return a(e)},border:!0,children:e.name},t)}))}):null,(0,I.jsxs)(w.Z,{id:"basic-menu",anchorEl:O,open:te,onClose:function(){return q(null)},MenuListProps:{"aria-labelledby":"basic-button"},anchorOrigin:{vertical:"bottom",horizontal:"center"},children:[(0,I.jsx)(C.Z,{onClick:function(){return e="transfer",q(null),_(!0),void $(e);var e},children:"Transfer coins"}),(0,I.jsx)(C.Z,{onClick:function(){A(ce.walletAddress,t.data.senderWalletAddress,ce.firstName,t.data.senderFirstName,"@conference.dev.dxmpp.com",t.data.senderJID).then((function(e){u.ZP.getRooms(),ue||l(e.roomJid)})).catch((function(e){console.log("openPrivateRoom Error: ",e)}))},children:"Direct message"}),(0,I.jsx)(C.Z,{onClick:function(){return q(null)},children:"Ban this user"})]}),(0,I.jsxs)(b.Z,{fullScreen:z,open:F,onClose:function(){return _(!0)},"aria-labelledby":"responsive-dialog-title",children:[(0,I.jsxs)(S.Z,{children:["error"===Y?(0,I.jsx)("div",{children:X}):null,"transfer"===Y?(0,I.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:["Rewards ",(0,I.jsx)("strong",{children:oe[0].tokenName})," with coins",(0,I.jsx)(k.Z,{id:"outlined-basic",label:"Outlined",type:"number",variant:"outlined",value:re,onChange:function(e){return ae(e.target.value)}}),(0,I.jsx)(v.zx,{onClick:function(){(0,f.tZ)(oe[0].tokenSymbol,oe[0].tokenName,Number(re),t.data.senderWalletAddress).then((function(){var e=ce.firstName+" "+ce.lastName+" -> "+re+" "+oe[0].tokenName+" -> "+t.data.senderFirstName+" "+t.data.senderLastName;u.ZP.sendSystemMessage(t.roomJID,ce.firstName,ce.lastName,ce.walletAddress,e,null,t.id),_(!1)})).catch((function(e){console.log(e),ee("An error occurred during the coin transfer."),$("error")}))},children:"Send"})]}):null]}),(0,I.jsx)(N.Z,{children:(0,I.jsx)(v.zx,{onClick:function(){return _(!1)},autoFocus:!0,children:"Close"})})]})]})},J=function(e){var t=e.message;e.userJid;return(0,I.jsx)("div",{style:{textAlign:"center",color:"#6ea9d7",fontSize:".8em",boxSizing:"border-box",fontFamily:"Helvetica Neue,Segoe UI,Helvetica,Arial,sans-serif"},children:t.body},t.key)},R=n(40464),M=n(39571),K=n(96580),L=n(17205);function E(){var e,t,n=(0,o.K)((function(e){return e.historyMessages})),r=(0,o.K)((function(e){return e.user})),s=(0,o.K)((function(e){return e.userChatRooms})),y=(0,o.K)((function(e){return e.loaderArchive})),w=(0,o.K)((function(e){return e.currentUntrackedChatRoom})),C=(0,i.useState)(),k=(0,c.Z)(C,2),D=k[0],A=k[1],E=(0,i.useState)(""),z=(0,c.Z)(E,2),T=z[0],U=z[1],F=(0,i.useState)(""),_=(0,c.Z)(F,2),B=_[0],W=_[1],O=(0,i.useState)({jid:"",name:"",room_background:"",room_thumbnail:"",users_cnt:""}),q=(0,c.Z)(O,2),V=q[0],H=q[1],Y=(0,i.useRef)(null),$=(0,j.Z)(),G=(0,Z.Z)($.breakpoints.down("md")),Q=(0,i.useState)(!1),X=(0,c.Z)(Q,2),ee=X[0],te=X[1],ne=(0,i.useState)(!1),ie=(0,c.Z)(ne,2),re=ie[0],ae=ie[1],oe=(0,i.useState)({headline:"",description:""}),se=(0,c.Z)(oe,2),le=se[0],de=se[1];(0,i.useEffect)((function(){(0,f.k2)(r.walletAddress).then((function(e){A(e.data.result)}))}),[]);var ce=function(e){W(e),H(s.filter((function(t){return t.jid===e}))[0]),o.K.getState().clearCounterChatRoom(e),o.K.getState().setCurrentUntrackedChatRoom(e);var t=n.filter((function(t){return t.roomJID===e}));if(!y&&t.length<=10&&t.length>0){var i=t[0].id;u.ZP.getPaginatedArchive(e,String(i),10)}},ue=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return y&&t.length<=0?"Loading...":t.length>0?t[0].body:"No messages yet"},fe=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return t.length<=0?"":(0,h.Z)(new Date,new Date(t[0].date))>1?(0,p.Z)(new Date(t[0].date),"hh:mm"):(0,g.Z)((0,x.Z)(new Date(t[0].date),0),new Date,{addSuffix:!0})},me=function(e){var t="";null!==D&&void 0!==D&&D.profileImage&&(t=null===D||void 0===D?void 0:D.profileImage),u.ZP.sendMessage(B,r.firstName,r.lastName,t,r.walletAddress,"object"===typeof e?e.value:T,"object"===typeof e?e.notDisplayedValue:null)};return(0,i.useEffect)((function(){var e=setTimeout((function(){u.ZP.pausedComposing(r.walletAddress,V.jid)}),1e3);return function(){return clearTimeout(e)}}),[T]),(0,i.useEffect)((function(){w&&ce(w),window.onblur=function(){o.K.getState().setCurrentUntrackedChatRoom("")},window.onfocus=function(){B&&(o.K.getState().setCurrentUntrackedChatRoom(B),o.K.getState().clearCounterChatRoom(B))}}),[B]),(0,I.jsxs)(a.Z,{style:{height:"500px"},children:[(0,I.jsxs)(v.tz,{responsive:!0,children:[(0,I.jsxs)(v.YE,{position:"left",scrollable:!1,children:[(0,I.jsx)(v.ol,{placeholder:"Search..."}),(0,I.jsx)(v.p7,{loading:y,children:s.map((function(e){return(0,I.jsx)(v.ri,{active:e.jid===B,unreadCnt:e.unreadMessages,onClick:function(){return ce(e.jid)},name:e.name,info:ue(e.jid),lastActivityTime:fe(e.jid),children:(0,I.jsx)(v.qE,{src:"none"!==e.room_background?e.room_background:"https://icotar.com/initials/"+e.name})},e.jid)}))})]}),(0,I.jsxs)(v.uU,{children:[!!V.name&&(0,I.jsxs)(v.BU,{children:[(0,I.jsx)(v.BU.Back,{}),n.filter((function(e){return e.roomJID===B})).length>0&&(0,I.jsx)(v.BU.Content,{userName:V.name,info:"Active "+(0,g.Z)((0,x.Z)(new Date(n.filter((function(e){return e.roomJID===B})).slice(-1)[0].date),0),new Date,{addSuffix:!0})}),(0,I.jsx)(v.BU.Actions,{children:(0,I.jsx)(m.Z,{})})]}),(0,I.jsxs)(v.rN,{loadingMore:y,onYReachStart:function(){if(!y){var e=n.filter((function(e){return e.roomJID===B}))[0].id;u.ZP.getPaginatedArchive(B,String(e),10)}},typingIndicator:!(null===(e=s.filter((function(e){return e.jid===B}))[0])||void 0===e||!e.composing)&&(0,I.jsx)(v.c2,{content:null===(t=s.filter((function(e){return e.jid===B}))[0])||void 0===t?void 0:t.composing}),children:[n.filter((function(e){return e.roomJID===B})).map((function(e,t,n){var i,r,a,o,s=function(e,t,n){var i,r,a,o,s,l,d=null===(i=e[n-1])||void 0===i||null===(r=i.data.senderJID)||void 0===r?void 0:r.split("/")[0],c=null===(a=e[n+1])||void 0===a||null===(o=a.data.senderJID)||void 0===o?void 0:o.split("/")[0],u=null===(s=t.data.senderJID)||void 0===s?void 0:s.split("/")[0],f={position:"single",type:"single"};return e[n-1]&&t&&(0,p.Z)(new Date(null===(l=e[n-1])||void 0===l?void 0:l.date),"dd")!==(0,p.Z)(new Date(t.date),"dd")&&(f.separator=(0,p.Z)(new Date(t.date),"EEEE, dd LLLL yyyy")),d!==u&&c!==u?f:d!==u&&c===u?(f.position="first",f.type="first",f):d===u&&c===u?(f.position="normal",f.type="normal",f):d===u&&c!==u?(f.position="single",f.type="last",f):f}(n,e,t);return"false"===e.data.isSystemMessage?(0,I.jsx)(P,{is:"Message",position:s,message:e,userJid:null===(i=u.ZP.client)||void 0===i||null===(r=i.jid)||void 0===r?void 0:r.toString(),buttonSender:me,chooseDirectRoom:ce},e.id):(0,I.jsx)(J,{is:"Message",message:e,userJid:null===(a=u.ZP.client)||void 0===a||null===(o=a.jid)||void 0===o?void 0:o.toString()})})),n.length<=0||!B&&(0,I.jsx)(v.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:y?"Loading...":(0,I.jsx)("span",{children:!B&&"To get started, please select a chat room."})}),!y&&B&&n.filter((function(e){return e.roomJID===B})).length<=0&&(0,I.jsx)(v.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:"Message list is empty"})]}),!!V.name&&(0,I.jsxs)("div",{is:"MessageInput",children:[(0,I.jsx)(v.Ru,{placeholder:"Type message here",onChange:function(e){U(e),u.ZP.isComposing(r.walletAddress,V.jid,r.firstName+" "+r.lastName)},onSend:me,onAttachClick:function(){return Y.current.click()}}),(0,I.jsx)("input",{type:"file",name:"file",id:"file",onChange:function(e){return function(e){de({headline:"File is loading, please wait...",description:""}),te(!0);var t=new FormData;t.append("files",e),(0,f.cT)(t).then((function(e){var t="";null!==D&&void 0!==D&&D.profileImage&&(t=null===D||void 0===D?void 0:D.profileImage),e.data.results.map(function(){var e=(0,d.Z)((0,l.Z)().mark((function e(n){var i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={firstName:r.firstName,lastName:r.lastName,walletAddress:r.walletAddress,chatName:V.name,userAvatar:t,createdAt:n.createdAt,expiresAt:n.expiresAt,fileName:n.filename,isVisible:n.isVisible,location:n.location,locationPreview:n.locationPreview,mimetype:n.mimetype,originalName:n.originalname,ownerKey:n.ownerKey,size:n.size,duration:null===n||void 0===n?void 0:n.duration,updatedAt:n.updatedAt,userId:n.userId,waveForm:"",attachmentId:n._id,wrappable:!0},u.ZP.sendMediaMessageStanza(B,i),te(!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).catch((function(e){console.log(e),de({headline:"Error",description:"An error occurred while uploading the file"}),ae(!0)})),Y.current.value=""}(e.target.files[0])},ref:Y,style:{display:"none"}})]})]})]}),(0,I.jsxs)(b.Z,{fullScreen:G,open:ee,onClose:function(){return te(!0)},"aria-labelledby":"responsive-dialog-title",children:[(0,I.jsx)(R.Z,{id:"responsive-dialog-title",children:le.headline}),(0,I.jsx)(S.Z,{children:re&&le.description.length>0?(0,I.jsx)(M.Z,{children:le.description}):(0,I.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,I.jsx)(K.Z,{})})}),re?(0,I.jsx)(N.Z,{children:(0,I.jsx)(L.Z,{onClick:function(){return te(!1)},autoFocus:!0,children:"Close"})}):null]})]})}function z(){var e=(0,o.K)((function(e){return e.user})),t=(0,o.K)((function(e){return e.messages})),n=(0,s.k6)();return(0,i.useEffect)((function(){e.firstName||n.push("/")}),[e.firstName,n]),(0,I.jsxs)(r.Z,{maxWidth:"xl",style:{height:"calc(100vh - 68px)"},children:[(0,I.jsx)(a.Z,{children:"Chat"}),(0,I.jsx)(a.Z,{children:t.length}),(0,I.jsx)(E,{})]})}}}]);
//# sourceMappingURL=711.29d2997e.chunk.js.map