"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[451],{23895:function(e,n,t){t.d(n,{c:function(){return l}});var i=t(74165),r=t(15861),o=t(85554),s=t(11210),a=function(e){return e?e.replace(/([A-Z])/g,"_$1").toLowerCase():"invalid string passed"},l=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(n,t,r,l,c,d){var u,m,p,f,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=[n,t].sort().join("."),m=u.toLowerCase()+c,p=[r,l].sort().join(" and "),f=s.K.getState().userChatRooms,h=!1,0===f.filter((function(e){return e.jid===m})).length&&(h=!0,o.ZP.createNewRoom(u.toLowerCase()),o.ZP.setOwner(u.toLowerCase()),o.ZP.roomConfig(u.toLowerCase(),{roomName:p}),o.ZP.subsribe(m),o.ZP.presenceInRoom(m),setTimeout((function(){o.ZP.sendInvite(a(n),m.toLowerCase(),a(t))}),1e3)),e.abrupt("return",{roomJid:m,roomName:p,isNewRoom:h});case 7:case"end":return e.stop()}}),e)})));return function(n,t,i,r,o,s){return e.apply(this,arguments)}}()},81451:function(e,n,t){t.r(n),t.d(n,{default:function(){return Ce}});var i,r=t(72791),o=t(20803),s=t(1413),a=t(74165),l=t(15861),c=t(70885),d=t(85554),u=t(11210),m=t(47409),p=t(91482),f=t(16263),h=t(45586),x=t(78703),g=t(31128),v=t(95178),j=t(64880),y=t(13811),Z=t(48928),w=t(58487),b=t(30199),k=t(17205),C=t(52898),S=t(57050),N=t(52791),I=t(73763),D=t(80184),A=function(e){var n=e.message,t=e.userJid,i=e.position,o=e.buttonSender,s=e.toggleTransferDialog,a=e.onMediaMessageClick,l=n.data.senderFirstName,d=n.data.senderLastName,u=t===n.data.senderJID,m=(0,j.k6)(),x=(0,r.useState)(),A=(0,c.Z)(x,2),R=A[0],M=A[1],P=r.useState(null),L=(0,c.Z)(P,2),J=L[0],z=L[1],K=Boolean(J),T=(0,r.useState)("incoming"),E=(0,c.Z)(T,2),F=E[0],U=E[1],_=function(){z(null),s(!0,n)};return(0,r.useEffect)((function(){n.data.quickReplies&&M(JSON.parse(n.data.quickReplies)),U(u?"outgoing":"incoming")}),[]),(0,D.jsxs)("div",{is:"Message",children:[!!i.separator&&(0,D.jsx)(g.it,{children:i.separator}),(0,D.jsxs)(g.v0,{onContextMenu:function(e){"incoming"===F&&(e.preventDefault(),_())},style:{marginBottom:"last"===i.type||"single"===i.type?15:null},model:{sender:l+" "+d,direction:F,position:i.position},avatarPosition:u?"tr":"tl",avatarSpacer:"first"!==i.type&&"single"!==i.type,children:[("first"===i.type||"single"===i.type)&&(0,D.jsx)("img",{style:{borderRadius:"50%",boxSizing:"border-box",width:"42px",height:"42px",cursor:"pointer"},onClick:function(){return m.push("/profile/"+n.data.senderWalletAddress)},is:"Avatar",src:n.data.photoURL?n.data.photoURL:+l+" "+d,onError:function(e){var n=e.currentTarget;n.onerror=null,n.src="https://icotar.com/initials/"+l+" "+d},alt:l}),(0,D.jsxs)(g.v0.CustomContent,{children:[("first"===i.type||"single"===i.type)&&(0,D.jsxs)("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,D.jsxs)("strong",{style:{cursor:"pointer"},onClick:function(){return m.push("/profile/"+n.data.senderWalletAddress)},children:[l," ",d,(0,D.jsx)("br",{})]}),!u&&(0,D.jsx)(y.Z,{"aria-label":"more",id:"long-button","aria-controls":K?"long-menu":void 0,"aria-expanded":K?"true":void 0,"aria-haspopup":"true",onClick:_,children:(0,D.jsx)(C.Z,{})})]}),n.data.isMediafile&&!!I.NX[n.data.mimetype]&&(0,D.jsx)(Z.Z,{sx:{maxWidth:200},children:(0,D.jsx)(w.Z,{onClick:function(){a(!0,n)},children:(0,D.jsx)(b.Z,{style:{height:150,objectFit:"cover",objectPosition:"left"},component:"img",height:"150",image:n.data.location,alt:n.data.originalName})})}),n.data.isMediafile&&!!I.p2[n.data.mimetype]&&(0,D.jsxs)("video",{controls:!0,width:"200px",children:[(0,D.jsx)("source",{src:n.data.location,type:n.data.mimetype,title:n.data.originalName}),"Sorry, your browser doesn't support videos."]}),n.data.isMediafile&&!!I.KS[n.data.mimetype]&&(0,D.jsxs)("audio",{controls:!0,children:[(0,D.jsx)("source",{src:n.data.location,type:n.data.mimetype}),"Your browser does not support the audio element."]}),!n.data.isMediafile&&(0,D.jsxs)("div",{children:[(0,D.jsx)("span",{dangerouslySetInnerHTML:{__html:n.body.replace(/\b(https?\:\/\/\S+)/gm,'<a href="$1">$1</a>')}}),(0,D.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:5,minWidth:200,color:"incoming"===F?"rgb(110, 169, 215)":"#c6e3fa",flexDirection:"incoming"===F?"row":"row-reverse"},children:[(0,D.jsx)("div",{style:{fontSize:12},children:(0,v.Z)(new Date,new Date(n.date))>5?(0,p.Z)(new Date(n.date),"h:mm a"):(0,f.Z)((0,h.Z)(new Date(n.date),0),new Date,{addSuffix:!0})}),n.coinsInMessage>0&&(0,D.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,D.jsx)("div",{style:{fontSize:12},children:null===n||void 0===n?void 0:n.coinsInMessage}),(0,D.jsx)("img",{src:S,style:{width:25,height:25},alt:"coin"})]})]})]})]})]}),!!R&&(0,D.jsx)(N.Z,{sx:{"& button":{m:.5}},children:(0,D.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"max-content",marginLeft:"45px"},children:R.map((function(e,n){return(0,D.jsx)(k.Z,{variant:"outlined",size:"small",onClick:function(){return o(e)},children:e.name},n)}))})})]})},R=function(e){var n=e.message;e.userJid;return(0,D.jsx)("div",{style:{textAlign:"center",color:"#6ea9d7",fontSize:".8em",boxSizing:"border-box",fontFamily:"Helvetica Neue,Segoe UI,Helvetica,Arial,sans-serif"},children:n.body},n.key)},M=t(74142),P=t(52797),L=t(50228),J=t(60788),z=t(40464),K=t(8440),T=t(39571),E=t(96580),F=t(77248),U=t(18267),_=t(4942),W="/chat/",B=function(e){var n=e.room,t=e.name,i=e.chatId,r=e.setDirection,o=(0,j.k6)();return n?(0,D.jsx)(L.Z,{justifyContent:"center",alignItems:"center",style:{padding:"10px 0",maxWidth:170},children:(0,D.jsx)(k.Z,{onClick:function(){r(),o.push(W+n.roomJid+I.Ts)},children:t})}):(0,D.jsx)(L.Z,{justifyContent:"center",alignItems:"center",style:{padding:"10px 0"},children:(0,D.jsx)(k.Z,{disabled:!i,onClick:function(){r(),o.push(W+"none")},children:"Empty"})})},V=t(91803),H=t(4565),O=function(e){var n=e.room,t=e.direction,i=e.previousRoom,r=(0,j.k6)();return null!==n&&void 0!==n&&n.name?(0,D.jsxs)(L.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,D.jsx)(H.Z,{sx:{fontWeight:"bold",fontSize:18},children:n.name}),(0,D.jsx)(H.Z,{children:n.description})]}):(0,D.jsxs)(L.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,D.jsxs)(L.Z,{sx:{alignItems:"center",display:"flex"},children:[(0,D.jsxs)(H.Z,{children:["This space is empty. You can build your own room here for"," ",(0,D.jsx)("b",{children:"120 "})]}),(0,D.jsx)("img",{src:S,style:{width:20,height:20},alt:"coin"})]}),(0,D.jsx)(k.Z,{onClick:function(){r.push("/newchat",{metaDirection:t,metaRoom:i})},children:"Create Meta Room"})]})},Y=t(84094),$="north",q="west",X="south",G="east",Q={north:"n",west:"w",south:"s",east:"e"},ee=(i={},(0,_.Z)(i,q,G),(0,_.Z)(i,G,q),(0,_.Z)(i,X,$),(0,_.Z)(i,$,X),i),ne={name:"",description:"",ownerNavLinks:{west:null,east:null,north:null,south:null},ownerId:"",contractAddress:"",createdAt:new Date,_id:"",roomJid:"",updatedAt:new Date,userNavLinks:{west:null,east:null,north:null,south:null}},te={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",p:2,outline:"none"},ie=function(e){var n=e.chatId,t=e.open,i=e.onClose,o=(0,r.useState)(""),s=(0,c.Z)(o,2),p=s[0],f=s[1],h=(0,r.useState)(!1),x=(0,c.Z)(h,2),g=x[0],v=x[1],j=(0,r.useState)(),Z=(0,c.Z)(j,2),w=Z[0],b=Z[1],k=(0,r.useState)(ne),C=(0,c.Z)(k,2),S=C[0],N=C[1],A=(0,u.K)((function(e){return e.user})),R=(0,M.Z)(),P=function(){var e=(0,l.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(!0),e.prev=1,e.next=4,(0,m.Vy)().get("/room/getRoom/"+n);case 4:t=e.sent,N(t.data.result),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),N(ne),console.log(e.t0);case 12:v(!1);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){n||N(ne),n&&P()}),[n]);var J=function(e,n,t){var i=(0,d.$I)(A.walletAddress),r=A.firstName+" "+A.lastName+" has joined <-",o=A.firstName+" "+A.lastName+" has left ->",s={senderFirstName:A.firstName,senderLastName:A.lastName,senderWalletAddress:A.walletAddress,isSystemMessage:!0,tokenAmount:0,receiverMessageId:"",mucname:e,photoURL:A.profileImage,roomJid:n,isReply:!1,mainMessageText:"",mainMessageId:"",mainMessageUserName:""};d.ZP.sendMessageStanza(i+I.yK,n,t?o:r,s)},z=function(){var e=(0,l.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,m.Vy)().post("/room/join/"+n,{});case 3:t=e.sent,console.log(t.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();if((0,r.useEffect)((function(){null!==w&&void 0!==w&&w.name&&J(w.name,w.roomJid+I.Ts,!0)}),[w]),(0,r.useEffect)((function(){S.name&&(J(S.name,S.roomJid+I.Ts,!1),z())}),[S]),!S.roomJid&&!p)return null;var K=function(e){var t,i,r,o,s=function(e){return ee[e]}(p);return function(){var e,n,t,i,r,o,s,a;return!(null!==S&&void 0!==S&&null!==(e=S.ownerNavLinks)&&void 0!==e&&e.south)&&!(null!==S&&void 0!==S&&null!==(n=S.ownerNavLinks)&&void 0!==n&&n.east)&&!(null!==S&&void 0!==S&&null!==(t=S.ownerNavLinks)&&void 0!==t&&t.west)&&!(null!==S&&void 0!==S&&null!==(i=S.ownerNavLinks)&&void 0!==i&&i.north)&&!(null!==S&&void 0!==S&&null!==(r=S.userNavLinks)&&void 0!==r&&r.south)&&!(null!==S&&void 0!==S&&null!==(o=S.userNavLinks)&&void 0!==o&&o.east)&&!(null!==S&&void 0!==S&&null!==(s=S.userNavLinks)&&void 0!==s&&s.west)&&!(null!==S&&void 0!==S&&null!==(a=S.userNavLinks)&&void 0!==a&&a.north)}()&&e===s?(0,D.jsx)(B,{name:s+":"+(null===w||void 0===w?void 0:w.name),chatId:n,room:w,setDirection:function(){f(s),b(w)}}):(0,D.jsx)(B,{name:Q[e]+":"+((null===(t=S.ownerNavLinks[e])||void 0===t?void 0:t.name)||(null===(i=S.userNavLinks[e])||void 0===i?void 0:i.name)),chatId:n,room:(null===S||void 0===S||null===(r=S.ownerNavLinks)||void 0===r?void 0:r[e])||(null===S||void 0===S||null===(o=S.userNavLinks)||void 0===o?void 0:o[e]),setDirection:function(){f(e),b(S)}})};return(0,D.jsx)(V.Z,{open:t,onClose:i,children:(0,D.jsx)(L.Z,{sx:te,children:g?(0,D.jsx)(E.Z,{size:50}):(0,D.jsxs)(L.Z,{children:[(0,D.jsx)(L.Z,{sx:{bgcolor:"white",mb:"10px",borderRadius:"10px",p:2},children:(0,D.jsx)(O,{room:S,direction:p,previousRoom:w})}),(0,D.jsxs)(L.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",bgcolor:"white",borderRadius:"10px",p:2},children:[K($),(0,D.jsxs)(L.Z,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",alignItems:"center",justifyContent:"center"},children:[(0,D.jsx)(L.Z,{sx:{display:"flex"},children:K(q)}),(0,D.jsx)(L.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,D.jsx)(y.Z,{sx:{color:R.palette.primary.main},children:(0,D.jsx)(Y.Z,{fontSize:"large"})})}),(0,D.jsx)(L.Z,{sx:{display:"flex"},children:K(G)})]}),K(X)]})]})})})},re=t(14250),oe=t(81872),se=t(59911),ae=t(21686),le=t(64558),ce=t(68438),de=t(23895),ue=t(52775),me=[1,3,5,"x"],pe="dialog",fe="clarification",he="transfer";function xe(e){var n=e.open,t=e.onClose,i=(e.loading,e.message),o=e.onPrivateRoomClick,s=(0,u.K)((function(e){return e.user})),p=(0,r.useState)(1),f=(0,c.Z)(p,2),h=f[0],x=f[1],g=(0,r.useState)(pe),v=(0,c.Z)(g,2),j=v[0],y=v[1],Z=(0,u.K)((function(e){return e.balance})),w=(0,u.K)((function(e){return e.setNewUserChatRoom})),b=(0,ue.D)().showSnackbar,C=Z.filter((function(e){return!e.tokenType&&e.contractAddress.length>10})),N=function(e){"clarify"!==e?("block"===e&&(d.ZP.blacklistUser(i.data.senderJID),d.ZP.getBlackList(),u.K.getState().removeAllInMessageHistory(i.data.senderJID)),t()):y(fe)},A=function(){var e=(0,l.Z)((0,a.Z)().mark((function e(n){var r,o,l,c,u,p,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Number(n||h),e.prev=1,e.next=4,(0,m.tZ)("DPT",C[0].tokenName,r,i.data.senderWalletAddress);case 4:o=e.sent,l=C[0].tokenName===ce.zl?ce.w5:C[0].tokenName,c=s.firstName+" "+s.lastName,u=i.data.senderFirstName+" "+i.data.senderLastName,p="".concat(c," -> ").concat(h," ").concat(l," -> ").concat(u),f=o.data.transaction._id,d.ZP.sendSystemMessage(i.roomJID,s.firstName,s.lastName,s.walletAddress,p,r,i.id,f),t(),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(1),console.log(e.t0),b("error","An error occurred during the coin transfer."),t();case 19:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(n){return e.apply(this,arguments)}}(),R=function(){(0,de.c)(s.walletAddress,i.data.senderWalletAddress,s.firstName,i.data.senderFirstName,I.Ts,i.data.senderJID).then((function(e){if(e.isNewRoom){var n={jid:e.roomJid,name:e.roomName,room_background:"none",room_thumbnail:"none",users_cnt:"2",unreadMessages:0,composing:"",toUpdate:!0,description:""};w(n),o(e.roomJid)}else o(e.roomJid)})).catch((function(e){console.log("openPrivateRoom Error: ",e)})),t()};return(0,D.jsx)(J.Z,{open:n,onClose:t,maxWidth:"xl",children:(0,D.jsx)(K.Z,{children:function(){if(!i)return null;switch(j){case fe:return(0,D.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:["Are you sure you want to block the user?",(0,D.jsx)(k.Z,{onClick:function(){return N("block")},variant:"outlined",size:"small",children:"To block list"})]});case pe:return(0,D.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,D.jsxs)("div",{children:["Reward"," ",(0,D.jsx)("strong",{children:i.data.senderFirstName+" "+i.data.senderLastName})," ","with coins"]}),(0,D.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",margin:"10px 0px 10px 0px"},children:me.map((function(e){return(0,D.jsxs)("div",{style:{textAlign:"center",cursor:"pointer"},onClick:function(){"number"===typeof e?A(e):y(he)},children:[(0,D.jsx)("img",{src:S,style:{width:25,height:25},alt:"coin"}),(0,D.jsx)(H.Z,{sx:{fontWeight:"bold"},children:e})]},e)}))}),(0,D.jsx)(oe.Z,{style:{margin:"10px"}}),(0,D.jsx)(k.Z,{onClick:R,variant:"outlined",startIcon:(0,D.jsx)(ae.Z,{}),children:"Direct message"}),(0,D.jsx)(oe.Z,{style:{margin:"10px"}}),(0,D.jsx)(k.Z,{onClick:function(){return N("clarify")},variant:"contained",startIcon:(0,D.jsx)(le.Z,{}),children:"Block this user"}),(0,D.jsx)(H.Z,{style:{textAlign:"center"},variant:"caption",display:"block",gutterBottom:!0,children:"Stop seeing this user."})]});case he:return(0,D.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,D.jsx)(se.Z,{id:"standard-basic",type:"number",label:"Enter transfer amount",variant:"standard",onChange:function(e){return x(Number(e.target.value))}}),(0,D.jsx)(k.Z,{style:{marginTop:10},onClick:function(){return A()},variant:"outlined",size:"small",children:"Send coins"})]});default:return null}}()})})}var ge=t(29823),ve={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",boxShadow:24,p:4,borderRadius:"10px"},je=function(e){var n=e.open,t=e.onClose,i=e.mimetype,r=e.url;return(0,D.jsx)(V.Z,{open:n,onClose:t,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,D.jsxs)(L.Z,{sx:ve,children:[(0,D.jsx)(y.Z,{onClick:t,sx:{position:"absolute",top:0,right:0,color:"black"},children:(0,D.jsx)(ge.Z,{})}),function(){switch(i){case"image/jpeg":case"image/png":case"image/jpg":return(0,D.jsx)("img",{src:r,alt:"image1",style:{maxWidth:"100%",maxHeight:"90vh"}});default:return null}}()]})})},ye=t(61102),Ze=t(24177),we=t(95958);function be(e){var n=e.profile,t=e.currentRoom,i=e.roomData,o=(0,u.K)((function(e){return e.user})),s=(0,r.useState)(!1),p=(0,c.Z)(s,2),f=p[0],h=p[1],x=(0,we.I)(),g=(0,ue.D)().showSnackbar,v=(0,r.useCallback)((function(e){h(!0);var r=new FormData;r.append("files",e),(0,m.cT)(r).then((function(e){var r="";null!==n&&void 0!==n&&n.profileImage&&(r=null===n||void 0===n?void 0:n.profileImage),e.data.results.map(function(){var e=(0,l.Z)((0,a.Z)().mark((function e(n){var s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s={firstName:o.firstName,lastName:o.lastName,walletAddress:o.walletAddress,chatName:i.name,userAvatar:r,createdAt:n.createdAt,expiresAt:n.expiresAt,fileName:n.filename,isVisible:n.isVisible,location:n.location,locationPreview:n.locationPreview,mimetype:n.mimetype,originalName:n.originalname,ownerKey:n.ownerKey,size:n.size,duration:null===n||void 0===n?void 0:n.duration,updatedAt:n.updatedAt,userId:n.userId,waveForm:"",attachmentId:n._id,wrappable:!0},d.ZP.sendMediaMessageStanza(t,s);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),h(!1)})).catch((function(e){console.log(e),g("error","An error occurred while loading your audio.")}))}),[]);return(0,D.jsxs)(L.Z,{children:[(0,D.jsx)(L.Z,{style:{display:f?"none":"block"},children:(0,D.jsx)(we.h,{recorderControls:x,onRecordingComplete:v})}),f&&(0,D.jsx)(E.Z,{color:"secondary",size:"20px"})]})}function ke(){var e,n,t,i,o,v,Z=(0,u.K)((function(e){return e.historyMessages})),w=(0,u.K)((function(e){return e.user})),b=(0,u.K)((function(e){return e.userChatRooms})),C=(0,u.K)((function(e){return e.loaderArchive})),S=(0,u.K)((function(e){return e.currentUntrackedChatRoom})),N=(0,r.useState)(),_=(0,c.Z)(N,2),W=_[0],B=_[1],V=(0,r.useState)(""),H=(0,c.Z)(V,2),O=H[0],Y=H[1],$=(0,r.useState)(!0),q=(0,c.Z)($,2),X=q[0],G=q[1],Q=(0,r.useState)(""),ee=(0,c.Z)(Q,2),ne=ee[0],te=ee[1],oe=(0,r.useMemo)((function(){return b.find((function(e){return e.jid===ne}))}),[b,ne]),se=(0,r.useState)(!1),ae=(0,c.Z)(se,2),le=(ae[0],ae[1],(0,r.useState)({jid:"",name:"",room_background:"",room_thumbnail:"",users_cnt:""})),de=(0,c.Z)(le,2),ue=de[0],me=de[1],pe=(0,r.useState)({open:!1,message:null}),fe=(0,c.Z)(pe,2),he=fe[0],ge=fe[1],ve=(0,r.useState)({open:!1,message:null}),we=(0,c.Z)(ve,2),ke=we[0],Ce=we[1],Se=(0,r.useState)(!1),Ne=(0,c.Z)(Se,2),Ie=Ne[0],De=Ne[1],Ae=(0,r.useState)({headline:"",description:"",open:!1}),Re=(0,c.Z)(Ae,2),Me=Re[0],Pe=Re[1],Le=(0,r.useState)(!0),Je=(0,c.Z)(Le,2),ze=Je[0],Ke=Je[1],Te=(0,u.K)((function(e){return e.activeRoomFilter})),Ee=(0,u.K)((function(e){return e.setActiveRoomFilter})),Fe=Te===ce.hx.meta,Ue=(0,j.k6)(),_e=(0,j.UO)().roomJID,We=(0,r.useRef)(null),Be=(0,M.Z)(),Ve=(0,P.Z)(Be.breakpoints.down("md")),He=(0,r.useCallback)((function(e){rn(e[0])}),[ue]),Oe=(0,U.uI)({onDrop:He,noClick:!0,maxFiles:1}).getRootProps;(0,r.useEffect)((function(){_e&&(Qe(_e),G(!0))}),[_e]),(0,r.useEffect)((function(){(0,m.k2)(w.walletAddress).then((function(e){B(e.data.result)}))}),[]);var Ye,$e,qe=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ge({open:e,message:n})},Xe=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Ce({open:e,message:n})},Ge=function(e){Ue.push("/chat/"+e.split("@")[0]),Qe(e)},Qe=function(e){te(e);var n=b.filter((function(n){return n.jid===e}))[0];me(n),u.K.getState().clearCounterChatRoom(e),u.K.getState().setCurrentUntrackedChatRoom(e);var t=Z.filter((function(n){return n.roomJID===e}));if(Ke(!0),!C&&t.length<=10&&t.length>0){var i=t[0].id;d.ZP.getPaginatedArchive(e,String(i),50)}},en=function(e){var n=Z.filter((function(n){return n.roomJID===e})).slice(-1);return C&&n.length<=0?"Loading...":n.length>0?n[0].body:"No messages yet"},nn=function(e){var n=Z.filter((function(n){return n.roomJID===e})).slice(-1);return n.length<=0?"":(0,p.Z)(new Date(n[0].date),"H:mm")},tn=function(e){if(O.trim().length>0){var n="";null!==W&&void 0!==W&&W.profileImage&&(n=null===W||void 0===W?void 0:W.profileImage);var t=function(e){var n=e;return(0===(n=(n=(n=n.replace(/<br>/gi,"\n")).replace(/<p.*>/gi,"\n")).replace(/<(?:.|\s)*?>/g,"")).trim().length?(new DOMParser).parseFromString(e,"text/html"):(new DOMParser).parseFromString(n,"text/html")).body.textContent||""}(x.sanitize(O));t.trim().length>0&&d.ZP.sendMessage(ne,w.firstName,w.lastName,n,w.walletAddress,"object"===typeof e?e.value:t,"object"===typeof e?e.notDisplayedValue:null)}},rn=function(e){Pe({headline:"File is loading, please wait...",description:"",open:!0});var n=new FormData;n.append("files",e),(0,m.cT)(n).then((function(e){var n="";null!==W&&void 0!==W&&W.profileImage&&(n=null===W||void 0===W?void 0:W.profileImage),e.data.results.map(function(){var e=(0,l.Z)((0,a.Z)().mark((function e(t){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={firstName:w.firstName,lastName:w.lastName,walletAddress:w.walletAddress,chatName:ue.name,userAvatar:n,createdAt:t.createdAt,expiresAt:t.expiresAt,fileName:t.filename,isVisible:t.isVisible,location:t.location,locationPreview:t.locationPreview,mimetype:t.mimetype,originalName:t.originalname,ownerKey:t.ownerKey,size:t.size,duration:null===t||void 0===t?void 0:t.duration,updatedAt:t.updatedAt,userId:t.userId,waveForm:"",attachmentId:t._id,wrappable:!0},d.ZP.sendMediaMessageStanza(ne,i),Pe({open:!1,description:"",headline:""});case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())})).catch((function(e){console.log(e),Pe({headline:"Error",description:"An error occurred while uploading the file",open:!0})})),We.current&&(We.current.value="")};return(0,r.useEffect)((function(){var e=setTimeout((function(){d.ZP.pausedComposing(w.walletAddress,ue.jid)}),1e3);return function(){return clearTimeout(e)}}),[O]),(0,r.useEffect)((function(){S&&(_e&&"none"!==_e&&""!==_e&&S.split("@")[0]!==_e||(S.split("@")[1]?Ge(S):Ge(S+I.Ts))),S.split("@")[0]!==_e&&"none"!==_e&&""!==_e&&(u.K.getState().setCurrentUntrackedChatRoom(_e),Ge(_e)),window.onblur=function(){u.K.getState().setCurrentUntrackedChatRoom("")},window.onfocus=function(){ne&&(u.K.getState().setCurrentUntrackedChatRoom(ne),u.K.getState().clearCounterChatRoom(ne))}}),[ne]),(0,r.useEffect)((function(){var e=Z.filter((function(e){return e.roomJID===ne}));if(!C&&e.length>0&&e.length<=51&&ne&&ze){var n=e[0];e.length>=10&&e.length<15&&n.data.isSystemMessage?(Ke(!1),d.ZP.getPaginatedArchive(ne,String(n.id),5)):1===e.length&&(Ke(!1),d.ZP.getPaginatedArchive(ne,String(n.id),50))}}),[Z]),(0,D.jsxs)(L.Z,{style:{paddingBlock:"20px",height:"100%"},children:[(0,D.jsxs)(g.tz,{responsive:!0,children:[(0,D.jsxs)(g.YE,{position:"left",scrollable:!1,children:[(0,D.jsx)(g.ol,{placeholder:"Search..."}),(0,D.jsx)(g.p7,{loading:C,children:(Ye=b,$e=Te,$e===ce.hx.official||$e===ce.hx.favourite?Ye.filter((function(e){return e.group===ce.hx.official||e.group===ce.hx.favourite})):Ye.filter((function(e){return e.group!==ce.hx.official&&e.group!==ce.hx.favourite}))).map((function(e){return(0,D.jsx)(g.ri,{active:e.jid===ne,unreadCnt:e.unreadMessages,onClick:function(){return Ge(e.jid)},name:e.name,info:en(e.jid),lastActivityTime:nn(e.jid),children:(0,D.jsx)(g.qE,{src:"none"!==e.room_thumbnail?e.room_thumbnail:"https://icotar.com/initials/"+e.name})},e.jid)}))})]}),(0,D.jsx)("div",(0,s.Z)((0,s.Z)({},Oe()),{},{style:{width:"100%",height:"100%"},children:(0,D.jsxs)(g.uU,{children:[!!ue&&(0,D.jsxs)(g.BU,{children:[(0,D.jsx)(g.BU.Back,{}),(0,D.jsx)(g.BU.Content,{userName:ue.name,onClick:function(){Ue.push("/chatDetails/"+S)},info:Z.filter((function(e){return e.roomJID===ne})).length>0&&"Active "+(0,f.Z)((0,h.Z)(new Date(Z.filter((function(e){return e.roomJID===ne})).slice(-1)[0].date),0),new Date,{addSuffix:!0})}),(0,D.jsxs)(g.BU.Actions,{children:[(0,D.jsx)(be,{profile:W,currentRoom:ne,roomData:ue}),(0,D.jsx)(y.Z,{sx:{color:"black"},onClick:function(){return De(!0)},children:(0,D.jsx)(ye.Z,{})})]})]}),(0,D.jsxs)(g.rN,{style:{backgroundImage:null!==oe&&void 0!==oe&&oe.room_background?"url(".concat(oe.room_background,")"):"white",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%"},loadingMore:C,onYReachStart:function(){var e=Z.filter((function(e){return e.roomJID===ne}));if(!C){var n=e[0].id;d.ZP.getPaginatedArchive(ne,String(n),10)}},disableOnYReachWhenNoScroll:!0,typingIndicator:!(null===(e=b.filter((function(e){return e.jid===ne}))[0])||void 0===e||!e.composing)&&(0,D.jsx)(g.c2,{style:{opacity:".6"},content:null===(n=b.filter((function(e){return e.jid===ne}))[0])||void 0===n?void 0:n.composing}),children:[Z.filter((function(e){return e.roomJID===ne})).map((function(e,n,t){var i,r,o,s,a=function(e,n,t){var i,r,o,s,a,l,c,d=null===(i=e[t-1])||void 0===i||null===(r=i.data.senderJID)||void 0===r?void 0:r.split("/")[0],u=null===(o=e[t+1])||void 0===o||null===(s=o.data.senderJID)||void 0===s?void 0:s.split("/")[0],m=null===(a=n.data.senderJID)||void 0===a?void 0:a.split("/")[0],f={position:"single",type:"single"};return e[t-1]&&n&&(0,p.Z)(new Date(null===(c=e[t-1])||void 0===c?void 0:c.date),"dd")!==(0,p.Z)(new Date(n.date),"dd")&&(f.separator=(0,p.Z)(new Date(n.date),"EEEE, dd LLLL yyyy")),d!==m&&u!==m?f:d!==m&&u===m?(f.position="first",f.type="first",f):d===m&&u===m?(f.position="normal",f.type="normal",f):d===m&&u!==m&&"false"===(null===(l=e[t-1])||void 0===l?void 0:l.data.isSystemMessage)?(f.position="single",f.type="last",f):f}(t,e,n);return"false"===e.data.isSystemMessage?(0,D.jsx)(A,{is:"Message",position:a,message:e,userJid:null===(i=d.ZP.client)||void 0===i||null===(r=i.jid)||void 0===r?void 0:r.toString(),buttonSender:tn,chooseDirectRoom:Ge,toggleTransferDialog:qe,onMediaMessageClick:Xe},e.id):(0,D.jsx)(R,{is:"Message",message:e,userJid:null===(o=d.ZP.client)||void 0===o||null===(s=o.jid)||void 0===s?void 0:s.toString()},e.id)})),Z.length<=0||!ne||"none@conference.dev.dxmpp.com"===ne&&(0,D.jsx)(g.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:C?"Loading...":(0,D.jsx)("span",{children:ne&&"none@conference.dev.dxmpp.com"!==ne?null:"Choose a chat room or create one to start a conversation."})}),!C&&ne&&"none@conference.dev.dxmpp.com"!==ne&&Z.filter((function(e){return e.roomJID===ne})).length<=0&&(0,D.jsx)(g.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:"Message list is empty"})]}),!(null===ue||void 0===ue||!ue.name)&&(0,D.jsxs)("div",{is:"MessageInput",children:[(0,D.jsx)(g.Ru,{onPaste:function(e){var n=Array.from(e.clipboardData.items).find((function(e){return/^image\//.test(e.type)}));if(n){var t=n.getAsFile();rn(t)}},placeholder:"Type message here",onChange:function(e){Y(e),d.ZP.isComposing(w.walletAddress,ue.jid,w.firstName+" "+w.lastName)},onSend:tn,onAttachClick:function(){return We.current.click()}}),(0,D.jsx)("input",{type:"file",name:"file",id:"file",onChange:function(e){return rn(e.target.files[0])},ref:We,style:{display:"none"}})]})]})}))]}),(0,D.jsx)(xe,{open:he.open,onClose:function(){return qe(!1)},loading:!1,onPrivateRoomClick:Ge,message:he.message}),(0,D.jsx)(je,{open:ke.open,onClose:function(){return Xe(!1)},mimetype:null===(t=ke.message)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.mimetype,url:null===(o=ke.message)||void 0===o||null===(v=o.data)||void 0===v?void 0:v.location}),(0,D.jsxs)(J.Z,{fullScreen:Ve,open:Me.open,onClose:function(){return Pe({open:!1,description:"",headline:""})},"aria-labelledby":"responsive-dialog-title",children:[(0,D.jsx)(z.Z,{id:"responsive-dialog-title",children:Me.headline}),(0,D.jsx)(K.Z,{children:Me.description?(0,D.jsx)(T.Z,{children:Me.description}):(0,D.jsx)(L.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,D.jsx)(E.Z,{})})}),(0,D.jsx)(F.Z,{children:(0,D.jsx)(k.Z,{onClick:function(){return Pe({open:!1,description:"",headline:""})},autoFocus:!0,children:"Close"})})]}),(0,D.jsx)(re.z,{open:Ie,link:(0,Ze.C$)({roomAddress:null===oe||void 0===oe?void 0:oe.jid}),onClose:function(){De(!1)},title:"Share Chatroom"}),(0,D.jsx)(ie,{open:X||Fe,chatId:ne.split("@")[0],onClose:function(){G(!1),Fe&&Ee("")}})]})}function Ce(){return(0,D.jsx)(o.Z,{maxWidth:"xl",style:{height:"calc(100vh - 68px)"},children:(0,D.jsx)(ke,{})})}},14250:function(e,n,t){t.d(n,{z:function(){return m}});t(72791);var i=t(60788),r=t(40464),o=t(17205),s=t(13811),a=t(52791),l=t(80925),c=t(24177),d=t(29823),u=t(80184),m=function(e){var n=e.title,t=e.open,m=e.link,p=e.onClose;return(0,u.jsxs)(i.Z,{maxWidth:!1,open:t,onClose:p,children:[!!n&&(0,u.jsx)(r.Z,{sx:{padding:"0 24px",paddingTop:"20px"},children:n}),(0,u.jsxs)(a.Z,{sx:{padding:"20px"},children:[(0,u.jsx)(l.Z,{size:256,style:{height:"50vh",maxWidth:"100%",width:"100%"},value:m,viewBox:"0 0 256 256"}),(0,u.jsxs)(a.Z,{sx:{boxShadow:"0px 0px 10px -5px rgba(0,0,0,0.75)",borderRadius:"10px",display:"flex",justifyContent:"space-between",alignItems:"center",pl:"10px",my:"10px"},children:[(0,u.jsx)("span",{children:(0,c.aS)(m,50)}),(0,u.jsx)(o.Z,{variant:"contained",sx:{borderRadius:"10px",marginLeft:"5px"},onClick:function(){return navigator.clipboard.writeText(m)},children:"Copy"})]}),(0,u.jsx)(s.Z,{onClick:p,sx:{color:"black",position:"absolute",top:10,right:10,fontSize:"30px"},children:(0,u.jsx)(d.Z,{fontSize:"inherit"})})]})]})}}}]);
//# sourceMappingURL=451.8f2d5f2d.chunk.js.map