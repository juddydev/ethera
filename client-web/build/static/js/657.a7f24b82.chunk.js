"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[657],{23895:function(e,t,n){n.d(t,{c:function(){return l}});var i=n(74165),r=n(15861),a=n(85554),o=n(11210),s=function(e){return e?e.replace(/([A-Z])/g,"_$1").toLowerCase():"invalid string passed"},l=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r,l,d,c){var u,f,m,p,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=[t,n].sort().join("."),f=u.toLowerCase()+d,m=[r,l].sort().join(" and "),p=o.K.getState().userChatRooms,h=!1,0===p.filter((function(e){return e.jid===f})).length&&(h=!0,a.ZP.createNewRoom(u.toLowerCase()),a.ZP.setOwner(u.toLowerCase()),a.ZP.roomConfig(u.toLowerCase(),{roomName:m}),a.ZP.subsribe(f),a.ZP.presenceInRoom(f),setTimeout((function(){a.ZP.sendInvite(s(t),f.toLowerCase(),s(n))}),1e3)),e.abrupt("return",{roomJid:f,roomName:m,isNewRoom:h});case 7:case"end":return e.stop()}}),e)})));return function(t,n,i,r,a,o){return e.apply(this,arguments)}}()},7657:function(e,t,n){n.r(t),n.d(t,{default:function(){return q}});var i=n(72791),r=n(20803),a=n(1413),o=n(74165),s=n(15861),l=n(70885),d=n(50228),c=n(85554),u=n(11210),f=n(57337),m=n(89721),p=n(91482),h=n(95178),g=n(16263),x=n(45586),v=n(78703),j=n(31128),y=n(64880),Z=n(13811),w=n(48928),S=n(58487),C=n(30199),b=n(16992),D=n(70324),N=n(60788),k=n(8440),A=n(78473),P=n(4565),I=n(77248),R=n(52898),J=n(23895),M=n(57050),L=n(52791),K=n(80184),T=function(e){var t=e.message,n=e.userJid,r=e.position,a=e.buttonSender,o=e.chooseDirectRoom,s=t.data.senderFirstName,d=t.data.senderLastName,m=t.data.senderJID,v=(0,y.k6)(),T=(0,i.useState)(),E=(0,l.Z)(T,2),F=E[0],U=E[1],_=(0,i.useState)(!1),z=(0,l.Z)(_,2),O=z[0],W=z[1],B=i.useState(null),V=(0,l.Z)(B,2),q=V[0],H=V[1],Y=(0,i.useState)("transfer"),$=(0,l.Z)(Y,2),G=$[0],Q=$[1],X=(0,i.useState)(""),ee=(0,l.Z)(X,2),te=ee[0],ne=ee[1],ie=Boolean(q),re=(0,i.useState)(1),ae=(0,l.Z)(re,2),oe=ae[0],se=ae[1],le=(0,u.K)((function(e){return e.balance})).filter((function(e){return!e.tokenType&&e.contractAddress.length>10})),de=(0,u.K)((function(e){return e.user}));return(0,i.useEffect)((function(){t.data.quickReplies&&U(JSON.parse(t.data.quickReplies))}),[]),(0,K.jsxs)("div",{is:"Message",children:[r.separator?(0,K.jsx)(j.it,{children:r.separator}):null,(0,K.jsxs)(j.v0,{model:{sender:s+" "+d,direction:String(n).split("/")[0]===String(m).split("/")[0]?"outgoing":"incoming",position:r.position},avatarPosition:String(n).split("/")[0]===String(m).split("/")[0]?"tr":"tl",avatarSpacer:"first"!==r.type&&"single"!==r.type,children:[("first"===r.type||"single"===r.type)&&(0,K.jsx)("img",{style:{borderRadius:"50%",boxSizing:"border-box",width:"42px",height:"42px",cursor:"pointer"},onClick:function(){return v.push("/profile/"+t.data.senderWalletAddress)},is:"Avatar",src:t.data.photoURL?t.data.photoURL:"https://icotar.com/initials/"+s+" "+d,onError:function(e){var t=e.currentTarget;t.onerror=null,t.src="https://icotar.com/initials/"+s+" "+d},alt:s}),(0,K.jsxs)(j.v0.CustomContent,{children:[("first"===r.type||"single"===r.type)&&(0,K.jsxs)("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,K.jsxs)("strong",{style:{cursor:"pointer"},onClick:function(){return v.push("/profile/"+t.data.senderWalletAddress)},children:[s," ",d,(0,K.jsx)("br",{})]}),String(n).split("/")[0]!==String(m).split("/")[0]?(0,K.jsx)(Z.Z,{"aria-label":"more",id:"long-button","aria-controls":ie?"long-menu":void 0,"aria-expanded":ie?"true":void 0,"aria-haspopup":"true",onClick:function(e){H(e.currentTarget)},children:(0,K.jsx)(R.Z,{})}):null]}),t.data.isMediafile&&"image"===t.data.mimetype.split("/")[0]?(0,K.jsx)(w.Z,{sx:{maxWidth:200},children:(0,K.jsx)(S.Z,{onClick:function(){W(!0),Q("image")},children:(0,K.jsx)(C.Z,{style:{height:150,objectFit:"cover",objectPosition:"left"},component:"img",height:"150",image:t.data.location,alt:t.data.originalName})})}):null,t.data.isMediafile&&"application"===t.data.mimetype.split("/")[0]?(0,K.jsxs)("a",{target:"_blank",href:t.data.location,children:[(0,K.jsx)(j.v0.ImageContent,{src:t.data.locationPreview,alt:t.data.originalName,width:150}),t.data.mimetype.split("/")[1]]}):null,t.data.isMediafile&&"video"===t.data.mimetype.split("/")[0]?(0,K.jsxs)("video",{controls:!0,width:"200px",children:[(0,K.jsx)("source",{src:t.data.location,type:t.data.mimetype,title:t.data.originalName}),"Sorry, your browser doesn't support videos."]}):null,t.data.isMediafile?null:(0,K.jsx)("span",{dangerouslySetInnerHTML:{__html:t.body.replace(/\b(https?\:\/\/\S+)/gm,'<a href="$1">$1</a>')}})]}),("last"===r.type||"single"===r.type)&&(0,K.jsx)(j.v0.Footer,{sentTime:(0,h.Z)(new Date,new Date(t.date))>5?(0,p.Z)(new Date(t.date),"h:mm:ss a"):(0,g.Z)((0,x.Z)(new Date(t.date),0),new Date,{addSuffix:!0})})]}),F?(0,K.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"max-content",marginLeft:"45px"},children:F.map((function(e,t){return(0,K.jsx)(j.zx,{onClick:function(){return a(e)},border:!0,children:e.name},t)}))}):null,(0,K.jsxs)(b.Z,{id:"basic-menu",anchorEl:q,open:ie,onClose:function(){return H(null)},MenuListProps:{"aria-labelledby":"basic-button"},anchorOrigin:{vertical:"bottom",horizontal:"center"},children:[(0,K.jsx)(D.Z,{onClick:function(){return e="transfer",H(null),W(!0),void Q(e);var e},children:"Transfer coins"}),(0,K.jsx)(D.Z,{onClick:function(){(0,J.c)(de.walletAddress,t.data.senderWalletAddress,de.firstName,t.data.senderFirstName,"@conference.dev.dxmpp.com",t.data.senderJID).then((function(e){if(e.isNewRoom){u.K.getState().setLoaderArchive(!0);var t={jid:e.roomJid,name:e.roomName,room_background:"none",room_thumbnail:"none",users_cnt:"2",unreadMessages:0,composing:"",toUpdate:!0};u.K.getState().setNewUserChatRoom(t),console.log("SAVE ROOM TO LIST => ",u.K.getState().userChatRooms),o(e.roomJid),c.ZP.getRooms()}else o(e.roomJid)})).catch((function(e){console.log("openPrivateRoom Error: ",e)}))},children:"Direct message"})]}),(0,K.jsxs)(N.Z,{open:O,onClose:function(){return W(!0)},maxWidth:"xl","aria-labelledby":"responsive-dialog-title",children:[(0,K.jsxs)(k.Z,{children:["error"===G?(0,K.jsx)("div",{children:te}):null,"transfer"===G?(0,K.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,K.jsxs)("div",{children:["Reward"," ",(0,K.jsx)("strong",{children:t.data.senderFirstName+" "+t.data.senderLastName})," ","with coins"]}),(0,K.jsx)(A.ZP,{"aria-label":"Coin amount",defaultValue:1,valueLabelDisplay:"auto",step:2,marks:!0,min:1,max:7,value:oe,onChange:function(e,t){return se(t||t[0])},sx:{marginTop:"10px"}}),(0,K.jsxs)(L.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,K.jsx)(P.Z,{sx:{fontWeight:"bold"},children:oe}),(0,K.jsx)("img",{src:M,style:{width:30,height:30},alt:"coin"})]})]}):null,"image"===G?(0,K.jsx)("div",{children:(0,K.jsx)("img",{src:t.data.location,alt:t.data.originalName,style:{maxWidth:"100%"}})}):null]}),(0,K.jsxs)(I.Z,{children:["transfer"===G&&(0,K.jsx)(j.zx,{onClick:function(){(0,f.tZ)("DPT",le[0].tokenName,Number(oe),t.data.senderWalletAddress).then((function(){var e=de.firstName+" "+de.lastName+" -> "+oe+" "+le[0].tokenName+" -> "+t.data.senderFirstName+" "+t.data.senderLastName;c.ZP.sendSystemMessage(t.roomJID,de.firstName,de.lastName,de.walletAddress,e,null,t.id),W(!1)})).catch((function(e){console.log(e),ne("An error occurred during the coin transfer."),Q("error")}))},children:"Send"}),(0,K.jsx)(j.zx,{onClick:function(){return W(!1)},autoFocus:!0,children:"Close"})]})]})]})},E=function(e){var t=e.message;e.userJid;return(0,K.jsx)("div",{style:{textAlign:"center",color:"#6ea9d7",fontSize:".8em",boxSizing:"border-box",fontFamily:"Helvetica Neue,Segoe UI,Helvetica,Arial,sans-serif"},children:t.body},t.key)},F=n(74142),U=n(52797),_=n(40464),z=n(39571),O=n(96580),W=n(17205),B=n(18267);function V(){var e,t,n=(0,u.K)((function(e){return e.historyMessages})),r=(0,u.K)((function(e){return e.user})),Z=(0,u.K)((function(e){return e.userChatRooms})),w=(0,u.K)((function(e){return e.loaderArchive})),S=(0,u.K)((function(e){return e.currentUntrackedChatRoom})),C=(0,i.useState)(),b=(0,l.Z)(C,2),D=b[0],A=b[1],P=(0,i.useState)(""),R=(0,l.Z)(P,2),J=R[0],M=R[1],L=(0,i.useState)(""),V=(0,l.Z)(L,2),q=V[0],H=V[1],Y=(0,i.useState)({jid:"",name:"",room_background:"",room_thumbnail:"",users_cnt:""}),$=(0,l.Z)(Y,2),G=$[0],Q=$[1],X=(0,i.useRef)(null),ee=(0,F.Z)(),te=(0,U.Z)(ee.breakpoints.down("md")),ne=(0,i.useState)(!1),ie=(0,l.Z)(ne,2),re=ie[0],ae=ie[1],oe=(0,i.useState)(!1),se=(0,l.Z)(oe,2),le=se[0],de=se[1],ce=(0,i.useState)({headline:"",description:""}),ue=(0,l.Z)(ce,2),fe=ue[0],me=ue[1],pe=(0,y.UO)().roomJID,he=(0,y.k6)(),ge=(0,i.useState)(!0),xe=(0,l.Z)(ge,2),ve=xe[0],je=xe[1],ye=(0,i.useCallback)((function(e){De(e[0])}),[G]),Ze=(0,B.uI)({onDrop:ye,noClick:!0,maxFiles:1}).getRootProps;(0,i.useEffect)((function(){(0,f.k2)(r.walletAddress).then((function(e){A(e.data.result)}))}),[]);var we=function(e){he.push("/chat/"+e.split("@")[0]),H(e);var t=Z.filter((function(t){return t.jid===e}))[0];Q(t),u.K.getState().clearCounterChatRoom(e),u.K.getState().setCurrentUntrackedChatRoom(e);var i=n.filter((function(t){return t.roomJID===e}));if(je(!0),!w&&i.length<=10&&i.length>0){var r=i[0].id;c.ZP.getPaginatedArchive(e,String(r),50)}},Se=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return w&&t.length<=0?"Loading...":t.length>0?t[0].body:"No messages yet"},Ce=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return t.length<=0?"":(0,h.Z)(new Date,new Date(t[0].date))>1?(0,p.Z)(new Date(t[0].date),"hh:mm"):(0,g.Z)((0,x.Z)(new Date(t[0].date),0),new Date,{addSuffix:!0})},be=function(e){if(J.trim().length>0){var t="";null!==D&&void 0!==D&&D.profileImage&&(t=null===D||void 0===D?void 0:D.profileImage);var n=function(e){var t=e;return(0===(t=(t=(t=t.replace(/<br>/gi,"\n")).replace(/<p.*>/gi,"\n")).replace(/<(?:.|\s)*?>/g,"")).trim().length?(new DOMParser).parseFromString(e,"text/html"):(new DOMParser).parseFromString(t,"text/html")).body.textContent||""}(v.sanitize(J));n.trim().length>0&&c.ZP.sendMessage(q,r.firstName,r.lastName,t,r.walletAddress,"object"===typeof e?e.value:n,"object"===typeof e?e.notDisplayedValue:null)}},De=function(e){me({headline:"File is loading, please wait...",description:""}),ae(!0);var t=new FormData;t.append("files",e),(0,f.cT)(t).then((function(e){var t="";null!==D&&void 0!==D&&D.profileImage&&(t=null===D||void 0===D?void 0:D.profileImage),e.data.results.map(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={firstName:r.firstName,lastName:r.lastName,walletAddress:r.walletAddress,chatName:G.name,userAvatar:t,createdAt:n.createdAt,expiresAt:n.expiresAt,fileName:n.filename,isVisible:n.isVisible,location:n.location,locationPreview:n.locationPreview,mimetype:n.mimetype,originalName:n.originalname,ownerKey:n.ownerKey,size:n.size,duration:null===n||void 0===n?void 0:n.duration,updatedAt:n.updatedAt,userId:n.userId,waveForm:"",attachmentId:n._id,wrappable:!0},c.ZP.sendMediaMessageStanza(q,i),ae(!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).catch((function(e){console.log(e),me({headline:"Error",description:"An error occurred while uploading the file"}),de(!0)})),X.current&&(X.current.value="")};return(0,i.useEffect)((function(){var e=setTimeout((function(){c.ZP.pausedComposing(r.walletAddress,G.jid)}),1e3);return function(){return clearTimeout(e)}}),[J]),(0,i.useEffect)((function(){S&&(pe&&"none"!==pe&&""!==pe&&S.split("@")[0]!==pe||we(S)),S.split("@")[0]!==pe&&"none"!==pe&&""!==pe&&(u.K.getState().setCurrentUntrackedChatRoom(pe),we(pe)),window.onblur=function(){u.K.getState().setCurrentUntrackedChatRoom("")},window.onfocus=function(){q&&(u.K.getState().setCurrentUntrackedChatRoom(q),u.K.getState().clearCounterChatRoom(q))}}),[q]),(0,i.useEffect)((function(){var e=n.filter((function(e){return e.roomJID===q}));if(!w&&e.length>0&&e.length<=51&&q&&ve){var t=e[0];e.length>=10&&e.length<15&&t.data.isSystemMessage?(je(!1),c.ZP.getPaginatedArchive(q,String(t.id),5)):1===e.length&&(je(!1),c.ZP.getPaginatedArchive(q,String(t.id),50))}}),[n]),(0,K.jsxs)(d.Z,{style:{paddingBlock:"20px",height:"100%"},children:[(0,K.jsxs)(j.tz,{responsive:!0,children:[(0,K.jsxs)(j.YE,{position:"left",scrollable:!1,children:[(0,K.jsx)(j.ol,{placeholder:"Search..."}),(0,K.jsx)(j.p7,{loading:w,children:Z.map((function(e){return(0,K.jsx)(j.ri,{active:e.jid===q,unreadCnt:e.unreadMessages,onClick:function(){return we(e.jid)},name:e.name,info:Se(e.jid),lastActivityTime:Ce(e.jid),children:(0,K.jsx)(j.qE,{src:"none"!==e.room_background?e.room_background:"https://icotar.com/initials/"+e.name})},e.jid)}))})]}),(0,K.jsx)("div",(0,a.Z)((0,a.Z)({},Ze()),{},{style:{width:"100%",height:"100%"},children:(0,K.jsxs)(j.uU,{children:[!!G&&(0,K.jsxs)(j.BU,{children:[(0,K.jsx)(j.BU.Back,{}),n.filter((function(e){return e.roomJID===q})).length>0&&(0,K.jsx)(j.BU.Content,{userName:G.name,info:"Active "+(0,g.Z)((0,x.Z)(new Date(n.filter((function(e){return e.roomJID===q})).slice(-1)[0].date),0),new Date,{addSuffix:!0})}),(0,K.jsx)(j.BU.Actions,{children:(0,K.jsx)(m.Z,{})})]}),(0,K.jsxs)(j.rN,{loadingMore:w,onYReachStart:function(){var e=n.filter((function(e){return e.roomJID===q}));if(!w){var t=e[0].id;c.ZP.getPaginatedArchive(q,String(t),10)}},disableOnYReachWhenNoScroll:!0,typingIndicator:!(null===(e=Z.filter((function(e){return e.jid===q}))[0])||void 0===e||!e.composing)&&(0,K.jsx)(j.c2,{content:null===(t=Z.filter((function(e){return e.jid===q}))[0])||void 0===t?void 0:t.composing}),children:[n.filter((function(e){return e.roomJID===q})).map((function(e,t,n){var i,r,a,o,s=function(e,t,n){var i,r,a,o,s,l,d=null===(i=e[n-1])||void 0===i||null===(r=i.data.senderJID)||void 0===r?void 0:r.split("/")[0],c=null===(a=e[n+1])||void 0===a||null===(o=a.data.senderJID)||void 0===o?void 0:o.split("/")[0],u=null===(s=t.data.senderJID)||void 0===s?void 0:s.split("/")[0],f={position:"single",type:"single"};return e[n-1]&&t&&(0,p.Z)(new Date(null===(l=e[n-1])||void 0===l?void 0:l.date),"dd")!==(0,p.Z)(new Date(t.date),"dd")&&(f.separator=(0,p.Z)(new Date(t.date),"EEEE, dd LLLL yyyy")),d!==u&&c!==u?f:d!==u&&c===u?(f.position="first",f.type="first",f):d===u&&c===u?(f.position="normal",f.type="normal",f):d===u&&c!==u?(f.position="single",f.type="last",f):f}(n,e,t);return"false"===e.data.isSystemMessage?(0,K.jsx)(T,{is:"Message",position:s,message:e,userJid:null===(i=c.ZP.client)||void 0===i||null===(r=i.jid)||void 0===r?void 0:r.toString(),buttonSender:be,chooseDirectRoom:we},e.id):(0,K.jsx)(E,{is:"Message",message:e,userJid:null===(a=c.ZP.client)||void 0===a||null===(o=a.jid)||void 0===o?void 0:o.toString()},e.id)})),n.length<=0||!q&&(0,K.jsx)(j.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:w?"Loading...":(0,K.jsx)("span",{children:!q&&"To get started, please select a chat room."})}),!w&&q&&n.filter((function(e){return e.roomJID===q})).length<=0&&(0,K.jsx)(j.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:"Message list is empty"})]}),!!G&&(0,K.jsxs)("div",{is:"MessageInput",children:[(0,K.jsx)(j.Ru,{onPaste:function(e){var t=Array.from(e.clipboardData.items).find((function(e){return/^image\//.test(e.type)}));if(t){var n=t.getAsFile();De(n)}},placeholder:"Type message here",onChange:function(e){M(e),c.ZP.isComposing(r.walletAddress,G.jid,r.firstName+" "+r.lastName)},onSend:be,onAttachClick:function(){return X.current.click()}}),(0,K.jsx)("input",{type:"file",name:"file",id:"file",onChange:function(e){return De(e.target.files[0])},ref:X,style:{display:"none"}})]})]})}))]}),(0,K.jsxs)(N.Z,{fullScreen:te,open:re,onClose:function(){return ae(!0)},"aria-labelledby":"responsive-dialog-title",children:[(0,K.jsx)(_.Z,{id:"responsive-dialog-title",children:fe.headline}),(0,K.jsx)(k.Z,{children:le&&fe.description.length>0?(0,K.jsx)(z.Z,{children:fe.description}):(0,K.jsx)(d.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,K.jsx)(O.Z,{})})}),le?(0,K.jsx)(I.Z,{children:(0,K.jsx)(W.Z,{onClick:function(){return ae(!1)},autoFocus:!0,children:"Close"})}):null]})]})}function q(){return(0,K.jsx)(r.Z,{maxWidth:"xl",style:{height:"calc(100vh - 68px)"},children:(0,K.jsx)(V,{})})}}}]);
//# sourceMappingURL=657.a7f24b82.chunk.js.map