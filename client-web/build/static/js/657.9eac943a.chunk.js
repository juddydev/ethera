"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[657],{23895:function(e,t,n){n.d(t,{c:function(){return s}});var i=n(74165),r=n(15861),o=n(85554),a=function(e){return e?e.replace(/([A-Z])/g,"_$1").toLowerCase():"invalid string passed"},s=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r,s,l,d){var c,u,f;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=[t,n].sort().join("."),u=c.toLowerCase()+l,f=[r,s].sort().join(" and "),o.ZP.createNewRoom(c.toLowerCase()),o.ZP.setOwner(c.toLowerCase()),o.ZP.roomConfig(c.toLowerCase(),{roomName:f}),o.ZP.subsribe(u),o.ZP.presenceInRoom(u),setTimeout((function(){o.ZP.sendInvite(a(t),u.toLowerCase(),a(n))}),1e3),e.abrupt("return",{roomJid:u,roomName:f});case 10:case"end":return e.stop()}}),e)})));return function(t,n,i,r,o,a){return e.apply(this,arguments)}}()},7657:function(e,t,n){n.r(t),n.d(t,{default:function(){return F}});var i=n(72791),r=n(20803),o=n(50228),a=n(11210),s=n(74165),l=n(15861),d=n(70885),c=n(85554),u=n(57337),f=n(89721),m=n(91482),p=n(95178),h=n(16263),g=n(45586),x=n(31128),v=n(64880),j=n(13811),y=n(48928),Z=n(58487),w=n(30199),C=n(16992),b=n(65348),S=n(60788),k=n(8440),D=n(59911),N=n(77248),A=n(52898),I=n(23895),P=n(80184),J=function(e){var t=e.message,n=e.userJid,r=e.position,o=e.buttonSender,s=e.chooseDirectRoom,l=t.data.senderFirstName,f=t.data.senderLastName,J=t.data.senderJID,R=(0,v.k6)(),M=(0,i.useState)(),K=(0,d.Z)(M,2),L=K[0],E=K[1],z=(0,i.useState)(!1),U=(0,d.Z)(z,2),T=U[0],F=U[1],_=i.useState(null),W=(0,d.Z)(_,2),B=W[0],O=W[1],q=(0,i.useState)("transfer"),V=(0,d.Z)(q,2),H=V[0],Y=V[1],$=(0,i.useState)(""),G=(0,d.Z)($,2),Q=G[0],X=G[1],ee=Boolean(B),te=(0,i.useState)(""),ne=(0,d.Z)(te,2),ie=ne[0],re=ne[1],oe=(0,a.K)((function(e){return e.balance})).filter((function(e){return!e.tokenType&&e.contractAddress.length>10})),ae=(0,a.K)((function(e){return e.user})),se=(0,a.K)((function(e){return e.loaderArchive}));return(0,i.useEffect)((function(){t.data.quickReplies&&E(JSON.parse(t.data.quickReplies))}),[]),(0,P.jsxs)("div",{is:"Message",children:[r.separator?(0,P.jsx)(x.it,{children:r.separator}):null,(0,P.jsxs)(x.v0,{model:{sender:l+" "+f,direction:String(n).split("/")[0]===String(J).split("/")[0]?"outgoing":"incoming",position:r.position},avatarPosition:String(n).split("/")[0]===String(J).split("/")[0]?"tr":"tl",avatarSpacer:"first"!==r.type&&"single"!==r.type,children:[("first"===r.type||"single"===r.type)&&(0,P.jsx)("img",{style:{borderRadius:"50%",boxSizing:"border-box",width:"42px",height:"42px",cursor:"pointer"},onClick:function(){return R.push("/profile/"+t.data.senderWalletAddress)},is:"Avatar",src:t.data.photoURL,onError:function(e){var t=e.currentTarget;t.onerror=null,t.src="https://icotar.com/initials/"+l+" "+f},alt:l}),(0,P.jsxs)(x.v0.CustomContent,{children:[("first"===r.type||"single"===r.type)&&(0,P.jsxs)("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,P.jsxs)("strong",{style:{cursor:"pointer"},onClick:function(){return R.push("/profile/"+t.data.senderWalletAddress)},children:[l," ",f,(0,P.jsx)("br",{})]}),String(n).split("/")[0]!==String(J).split("/")[0]?(0,P.jsx)(j.Z,{"aria-label":"more",id:"long-button","aria-controls":ee?"long-menu":void 0,"aria-expanded":ee?"true":void 0,"aria-haspopup":"true",onClick:function(e){O(e.currentTarget)},children:(0,P.jsx)(A.Z,{})}):null]}),t.data.isMediafile&&"image"===t.data.mimetype.split("/")[0]?(0,P.jsx)(y.Z,{sx:{maxWidth:200},children:(0,P.jsx)(Z.Z,{onClick:function(){F(!0),Y("image")},children:(0,P.jsx)(w.Z,{style:{height:150,objectFit:"cover",objectPosition:"left"},component:"img",height:"150",image:t.data.location,alt:t.data.originalName})})}):null,t.data.isMediafile&&"application"===t.data.mimetype.split("/")[0]?(0,P.jsxs)("a",{target:"_blank",href:t.data.location,children:[(0,P.jsx)(x.v0.ImageContent,{src:t.data.locationPreview,alt:t.data.originalName,width:150}),t.data.mimetype.split("/")[1]]}):null,t.data.isMediafile&&"video"===t.data.mimetype.split("/")[0]?(0,P.jsxs)("video",{controls:!0,width:"200px",children:[(0,P.jsx)("source",{src:t.data.location,type:t.data.mimetype,title:t.data.originalName}),"Sorry, your browser doesn't support videos."]}):null,t.data.isMediafile?null:t.body]}),("last"===r.type||"single"===r.type)&&(0,P.jsx)(x.v0.Footer,{sentTime:(0,p.Z)(new Date,new Date(t.date))>5?(0,m.Z)(new Date(t.date),"h:mm:ss a"):(0,h.Z)((0,g.Z)(new Date(t.date),0),new Date,{addSuffix:!0})})]},t.key),L?(0,P.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"max-content",marginLeft:"45px"},children:L.map((function(e,t){return(0,P.jsx)(x.zx,{onClick:function(){return o(e)},border:!0,children:e.name},t)}))}):null,(0,P.jsxs)(C.Z,{id:"basic-menu",anchorEl:B,open:ee,onClose:function(){return O(null)},MenuListProps:{"aria-labelledby":"basic-button"},anchorOrigin:{vertical:"bottom",horizontal:"center"},children:[(0,P.jsx)(b.Z,{onClick:function(){return e="transfer",O(null),F(!0),void Y(e);var e},children:"Transfer coins"}),(0,P.jsx)(b.Z,{onClick:function(){(0,I.c)(ae.walletAddress,t.data.senderWalletAddress,ae.firstName,t.data.senderFirstName,"@conference.dev.dxmpp.com",t.data.senderJID).then((function(e){c.ZP.getRooms(),se||s(e.roomJid)})).catch((function(e){console.log("openPrivateRoom Error: ",e)}))},children:"Direct message"}),(0,P.jsx)(b.Z,{onClick:function(){return O(null)},children:"Ban this user"})]}),(0,P.jsxs)(S.Z,{open:T,onClose:function(){return F(!0)},maxWidth:"xl","aria-labelledby":"responsive-dialog-title",children:[(0,P.jsxs)(k.Z,{children:["error"===H?(0,P.jsx)("div",{children:Q}):null,"transfer"===H?(0,P.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:["Rewards ",(0,P.jsx)("strong",{children:oe[0].tokenName})," with coins",(0,P.jsx)(D.Z,{id:"outlined-basic",label:"Outlined",type:"number",variant:"outlined",value:ie,onChange:function(e){return re(e.target.value)}}),(0,P.jsx)(x.zx,{onClick:function(){(0,u.tZ)(oe[0].tokenSymbol,oe[0].tokenName,Number(ie),t.data.senderWalletAddress).then((function(){var e=ae.firstName+" "+ae.lastName+" -> "+ie+" "+oe[0].tokenName+" -> "+t.data.senderFirstName+" "+t.data.senderLastName;c.ZP.sendSystemMessage(t.roomJID,ae.firstName,ae.lastName,ae.walletAddress,e,null,t.id),F(!1)})).catch((function(e){console.log(e),X("An error occurred during the coin transfer."),Y("error")}))},children:"Send"})]}):null,"image"===H?(0,P.jsx)("div",{children:(0,P.jsx)("img",{src:t.data.location,alt:t.data.originalName,style:{maxWidth:"100%"}})}):null]}),(0,P.jsx)(N.Z,{children:(0,P.jsx)(x.zx,{onClick:function(){return F(!1)},autoFocus:!0,children:"Close"})})]})]})},R=function(e){var t=e.message;e.userJid;return(0,P.jsx)("div",{style:{textAlign:"center",color:"#6ea9d7",fontSize:".8em",boxSizing:"border-box",fontFamily:"Helvetica Neue,Segoe UI,Helvetica,Arial,sans-serif"},children:t.body},t.key)},M=n(74142),K=n(52797),L=n(40464),E=n(39571),z=n(96580),U=n(17205);function T(){var e,t,n=(0,a.K)((function(e){return e.historyMessages})),r=(0,a.K)((function(e){return e.user})),j=(0,a.K)((function(e){return e.userChatRooms})),y=(0,a.K)((function(e){return e.loaderArchive})),Z=(0,a.K)((function(e){return e.currentUntrackedChatRoom})),w=(0,i.useState)(),C=(0,d.Z)(w,2),b=C[0],D=C[1],A=(0,i.useState)(""),I=(0,d.Z)(A,2),T=I[0],F=I[1],_=(0,i.useState)(""),W=(0,d.Z)(_,2),B=W[0],O=W[1],q=(0,i.useState)({jid:"",name:"",room_background:"",room_thumbnail:"",users_cnt:""}),V=(0,d.Z)(q,2),H=V[0],Y=V[1],$=(0,i.useRef)(null),G=(0,M.Z)(),Q=(0,K.Z)(G.breakpoints.down("md")),X=(0,i.useState)(!1),ee=(0,d.Z)(X,2),te=ee[0],ne=ee[1],ie=(0,i.useState)(!1),re=(0,d.Z)(ie,2),oe=re[0],ae=re[1],se=(0,i.useState)({headline:"",description:""}),le=(0,d.Z)(se,2),de=le[0],ce=le[1],ue=(0,v.UO)().roomJID,fe=(0,v.k6)();(0,i.useEffect)((function(){(0,u.k2)(r.walletAddress).then((function(e){D(e.data.result)}))}),[]);var me=function(e){fe.push("/chat/"+e.split("@")[0]),O(e),Y(j.filter((function(t){return t.jid===e}))[0]),a.K.getState().clearCounterChatRoom(e),a.K.getState().setCurrentUntrackedChatRoom(e);var t=n.filter((function(t){return t.roomJID===e}));if(!y&&t.length<=10&&t.length>0){var i=t[0].id;c.ZP.getPaginatedArchive(e,String(i),10)}},pe=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return y&&t.length<=0?"Loading...":t.length>0?t[0].body:"No messages yet"},he=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return t.length<=0?"":(0,p.Z)(new Date,new Date(t[0].date))>1?(0,m.Z)(new Date(t[0].date),"hh:mm"):(0,h.Z)((0,g.Z)(new Date(t[0].date),0),new Date,{addSuffix:!0})},ge=function(e){var t="";null!==b&&void 0!==b&&b.profileImage&&(t=null===b||void 0===b?void 0:b.profileImage),c.ZP.sendMessage(B,r.firstName,r.lastName,t,r.walletAddress,"object"===typeof e?e.value:T,"object"===typeof e?e.notDisplayedValue:null)};return(0,i.useEffect)((function(){var e=setTimeout((function(){c.ZP.pausedComposing(r.walletAddress,H.jid)}),1e3);return function(){return clearTimeout(e)}}),[T]),(0,i.useEffect)((function(){if(Z&&(ue&&"none"!==ue&&Z.split("@")[0]!==ue||me(Z)),Z.split("@")[0]!==ue&&"none"!==ue){var e=ue+"@conference.dev.dxmpp.com";a.K.getState().setCurrentUntrackedChatRoom(e),me(e)}window.onblur=function(){a.K.getState().setCurrentUntrackedChatRoom("")},window.onfocus=function(){B&&(a.K.getState().setCurrentUntrackedChatRoom(B),a.K.getState().clearCounterChatRoom(B))}}),[B]),(0,P.jsxs)(o.Z,{style:{height:"500px"},children:[(0,P.jsxs)(x.tz,{responsive:!0,children:[(0,P.jsxs)(x.YE,{position:"left",scrollable:!1,children:[(0,P.jsx)(x.ol,{placeholder:"Search..."}),(0,P.jsx)(x.p7,{loading:y,children:j.map((function(e){return(0,P.jsx)(x.ri,{active:e.jid===B,unreadCnt:e.unreadMessages,onClick:function(){return me(e.jid)},name:e.name,info:pe(e.jid),lastActivityTime:he(e.jid),children:(0,P.jsx)(x.qE,{src:"none"!==e.room_background?e.room_background:"https://icotar.com/initials/"+e.name})},e.jid)}))})]}),(0,P.jsxs)(x.uU,{children:[!!H.name&&(0,P.jsxs)(x.BU,{children:[(0,P.jsx)(x.BU.Back,{}),n.filter((function(e){return e.roomJID===B})).length>0&&(0,P.jsx)(x.BU.Content,{userName:H.name,info:"Active "+(0,h.Z)((0,g.Z)(new Date(n.filter((function(e){return e.roomJID===B})).slice(-1)[0].date),0),new Date,{addSuffix:!0})}),(0,P.jsx)(x.BU.Actions,{children:(0,P.jsx)(f.Z,{})})]}),(0,P.jsxs)(x.rN,{loadingMore:y,onYReachStart:function(){if(!y){var e=n.filter((function(e){return e.roomJID===B}))[0].id;c.ZP.getPaginatedArchive(B,String(e),10)}},typingIndicator:!(null===(e=j.filter((function(e){return e.jid===B}))[0])||void 0===e||!e.composing)&&(0,P.jsx)(x.c2,{content:null===(t=j.filter((function(e){return e.jid===B}))[0])||void 0===t?void 0:t.composing}),children:[n.filter((function(e){return e.roomJID===B})).map((function(e,t,n){var i,r,o,a,s=function(e,t,n){var i,r,o,a,s,l,d=null===(i=e[n-1])||void 0===i||null===(r=i.data.senderJID)||void 0===r?void 0:r.split("/")[0],c=null===(o=e[n+1])||void 0===o||null===(a=o.data.senderJID)||void 0===a?void 0:a.split("/")[0],u=null===(s=t.data.senderJID)||void 0===s?void 0:s.split("/")[0],f={position:"single",type:"single"};return e[n-1]&&t&&(0,m.Z)(new Date(null===(l=e[n-1])||void 0===l?void 0:l.date),"dd")!==(0,m.Z)(new Date(t.date),"dd")&&(f.separator=(0,m.Z)(new Date(t.date),"EEEE, dd LLLL yyyy")),d!==u&&c!==u?f:d!==u&&c===u?(f.position="first",f.type="first",f):d===u&&c===u?(f.position="normal",f.type="normal",f):d===u&&c!==u?(f.position="single",f.type="last",f):f}(n,e,t);return"false"===e.data.isSystemMessage?(0,P.jsx)(J,{is:"Message",position:s,message:e,userJid:null===(i=c.ZP.client)||void 0===i||null===(r=i.jid)||void 0===r?void 0:r.toString(),buttonSender:ge,chooseDirectRoom:me},e.id):(0,P.jsx)(R,{is:"Message",message:e,userJid:null===(o=c.ZP.client)||void 0===o||null===(a=o.jid)||void 0===a?void 0:a.toString()},e.id)})),n.length<=0||!B&&(0,P.jsx)(x.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:y?"Loading...":(0,P.jsx)("span",{children:!B&&"To get started, please select a chat room."})}),!y&&B&&n.filter((function(e){return e.roomJID===B})).length<=0&&(0,P.jsx)(x.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:"Message list is empty"})]}),!!H.name&&(0,P.jsxs)("div",{is:"MessageInput",children:[(0,P.jsx)(x.Ru,{placeholder:"Type message here",onChange:function(e){F(e),c.ZP.isComposing(r.walletAddress,H.jid,r.firstName+" "+r.lastName)},onSend:ge,onAttachClick:function(){return $.current.click()}}),(0,P.jsx)("input",{type:"file",name:"file",id:"file",onChange:function(e){return function(e){ce({headline:"File is loading, please wait...",description:""}),ne(!0);var t=new FormData;t.append("files",e),(0,u.cT)(t).then((function(e){var t="";null!==b&&void 0!==b&&b.profileImage&&(t=null===b||void 0===b?void 0:b.profileImage),e.data.results.map(function(){var e=(0,l.Z)((0,s.Z)().mark((function e(n){var i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={firstName:r.firstName,lastName:r.lastName,walletAddress:r.walletAddress,chatName:H.name,userAvatar:t,createdAt:n.createdAt,expiresAt:n.expiresAt,fileName:n.filename,isVisible:n.isVisible,location:n.location,locationPreview:n.locationPreview,mimetype:n.mimetype,originalName:n.originalname,ownerKey:n.ownerKey,size:n.size,duration:null===n||void 0===n?void 0:n.duration,updatedAt:n.updatedAt,userId:n.userId,waveForm:"",attachmentId:n._id,wrappable:!0},c.ZP.sendMediaMessageStanza(B,i),ne(!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).catch((function(e){console.log(e),ce({headline:"Error",description:"An error occurred while uploading the file"}),ae(!0)})),$.current.value=""}(e.target.files[0])},ref:$,style:{display:"none"}})]})]})]}),(0,P.jsxs)(S.Z,{fullScreen:Q,open:te,onClose:function(){return ne(!0)},"aria-labelledby":"responsive-dialog-title",children:[(0,P.jsx)(L.Z,{id:"responsive-dialog-title",children:de.headline}),(0,P.jsx)(k.Z,{children:oe&&de.description.length>0?(0,P.jsx)(E.Z,{children:de.description}):(0,P.jsx)(o.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,P.jsx)(z.Z,{})})}),oe?(0,P.jsx)(N.Z,{children:(0,P.jsx)(U.Z,{onClick:function(){return ne(!1)},autoFocus:!0,children:"Close"})}):null]})]})}function F(){var e=(0,a.K)((function(e){return e.messages}));return(0,P.jsxs)(r.Z,{maxWidth:"xl",style:{height:"calc(100vh - 68px)"},children:[(0,P.jsx)(o.Z,{children:"Chat"}),(0,P.jsx)(o.Z,{children:e.length}),(0,P.jsx)(T,{})]})}}}]);
//# sourceMappingURL=657.9eac943a.chunk.js.map