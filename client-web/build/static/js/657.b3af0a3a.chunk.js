"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[657],{23895:function(e,t,n){n.d(t,{c:function(){return l}});var i=n(74165),r=n(15861),a=n(85554),o=n(11210),s=function(e){return e?e.replace(/([A-Z])/g,"_$1").toLowerCase():"invalid string passed"},l=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r,l,d,c){var u,m,f,p,g;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=[t,n].sort().join("."),m=u.toLowerCase()+d,f=[r,l].sort().join(" and "),p=o.K.getState().userChatRooms,g=!1,0===p.filter((function(e){return e.jid===m})).length&&(g=!0,a.ZP.createNewRoom(u.toLowerCase()),a.ZP.setOwner(u.toLowerCase()),a.ZP.roomConfig(u.toLowerCase(),{roomName:f}),a.ZP.subsribe(m),a.ZP.presenceInRoom(m),setTimeout((function(){a.ZP.sendInvite(s(t),m.toLowerCase(),s(n))}),1e3)),e.abrupt("return",{roomJid:m,roomName:f,isNewRoom:g});case 7:case"end":return e.stop()}}),e)})));return function(t,n,i,r,a,o){return e.apply(this,arguments)}}()},7657:function(e,t,n){n.r(t),n.d(t,{default:function(){return Y}});var i=n(72791),r=n(20803),a=n(1413),o=n(74165),s=n(15861),l=n(70885),d=n(50228),c=n(85554),u=n(11210),m=n(57337),f=n(89721),p=n(91482),g=n(16263),h=n(45586),x=n(78703),v=n(31128),j=n(95178),y=n(64880),Z=n(13811),w=n(48928),S=n(58487),b=n(30199),C=n(17205),k=n(60788),D=n(8440),N=n(36255),A=n(4565),I=n(81872),P=n(52898),M=n(23895),R=n(57050),J=n(52791),L=n(21686),K=n(64558),U=n(80184),z=function(e){var t=e.message,n=e.userJid,r=e.position,a=e.buttonSender,o=e.chooseDirectRoom,s=t.data.senderFirstName,d=t.data.senderLastName,f=t.data.senderJID,x=(0,y.k6)(),z=(0,i.useState)(),_=(0,l.Z)(z,2),E=_[0],F=_[1],T=(0,i.useState)(!1),W=(0,l.Z)(T,2),B=W[0],O=W[1],H=i.useState(null),V=(0,l.Z)(H,2),Y=V[0],q=V[1],$=(0,i.useState)("dialog"),G=(0,l.Z)($,2),Q=G[0],X=G[1],ee=(0,i.useState)(""),te=(0,l.Z)(ee,2),ne=te[0],ie=te[1],re=Boolean(Y),ae=(0,i.useState)(1),oe=(0,l.Z)(ae,2),se=oe[0],le=oe[1],de=(0,u.K)((function(e){return e.balance})).filter((function(e){return!e.tokenType&&e.contractAddress.length>10})),ce=(0,u.K)((function(e){return e.user})),ue=(0,i.useState)("incoming"),me=(0,l.Z)(ue,2),fe=me[0],pe=me[1],ge=function(e){q(null),O(!0),X(e)},he=function(e){"clarify"===e&&(ie("Are you sure you want to block the user?"),X("clarification")),"block"===e&&(c.ZP.blacklistUser(t.data.senderJID),u.K.getState().removeAllInMessageHistory(t.data.senderJID),O(!1))};return(0,i.useEffect)((function(){t.data.quickReplies&&F(JSON.parse(t.data.quickReplies)),pe(String(n).split("/")[0]===String(f).split("/")[0]?"outgoing":"incoming")}),[]),(0,U.jsxs)("div",{is:"Message",children:[r.separator?(0,U.jsx)(v.it,{children:r.separator}):null,(0,U.jsxs)(v.v0,{onContextMenu:"incoming"===fe?function(e){e.preventDefault(),ge("dialog")}:null,style:{marginBottom:"last"===r.type||"single"===r.type?15:null},model:{sender:s+" "+d,direction:fe,position:r.position},avatarPosition:String(n).split("/")[0]===String(f).split("/")[0]?"tr":"tl",avatarSpacer:"first"!==r.type&&"single"!==r.type,children:[("first"===r.type||"single"===r.type)&&(0,U.jsx)("img",{style:{borderRadius:"50%",boxSizing:"border-box",width:"42px",height:"42px",cursor:"pointer"},onClick:function(){return x.push("/profile/"+t.data.senderWalletAddress)},is:"Avatar",src:t.data.photoURL?t.data.photoURL:"https://icotar.com/initials/"+s+" "+d,onError:function(e){var t=e.currentTarget;t.onerror=null,t.src="https://icotar.com/initials/"+s+" "+d},alt:s}),(0,U.jsxs)(v.v0.CustomContent,{children:[("first"===r.type||"single"===r.type)&&(0,U.jsxs)("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,U.jsxs)("strong",{style:{cursor:"pointer"},onClick:function(){return x.push("/profile/"+t.data.senderWalletAddress)},children:[s," ",d,(0,U.jsx)("br",{})]}),String(n).split("/")[0]!==String(f).split("/")[0]?(0,U.jsx)(Z.Z,{"aria-label":"more",id:"long-button","aria-controls":re?"long-menu":void 0,"aria-expanded":re?"true":void 0,"aria-haspopup":"true",onClick:function(){return ge("dialog")},children:(0,U.jsx)(P.Z,{})}):null]}),t.data.isMediafile&&"image"===t.data.mimetype.split("/")[0]?(0,U.jsx)(w.Z,{sx:{maxWidth:200},children:(0,U.jsx)(S.Z,{onClick:function(){O(!0),X("image")},children:(0,U.jsx)(b.Z,{style:{height:150,objectFit:"cover",objectPosition:"left"},component:"img",height:"150",image:t.data.location,alt:t.data.originalName})})}):null,t.data.isMediafile&&"application"===t.data.mimetype.split("/")[0]?(0,U.jsxs)("a",{target:"_blank",href:t.data.location,children:[(0,U.jsx)(v.v0.ImageContent,{src:t.data.locationPreview,alt:t.data.originalName,width:150}),t.data.mimetype.split("/")[1]]}):null,t.data.isMediafile&&"video"===t.data.mimetype.split("/")[0]?(0,U.jsxs)("video",{controls:!0,width:"200px",children:[(0,U.jsx)("source",{src:t.data.location,type:t.data.mimetype,title:t.data.originalName}),"Sorry, your browser doesn't support videos."]}):null,t.data.isMediafile&&"audio"===t.data.mimetype.split("/")[0]?(0,U.jsxs)("audio",{controls:!0,children:[(0,U.jsx)("source",{src:t.data.location,type:t.data.mimetype}),"Your browser does not support the audio element."]}):null,t.data.isMediafile?null:(0,U.jsxs)("div",{children:[(0,U.jsx)("span",{dangerouslySetInnerHTML:{__html:t.body.replace(/\b(https?\:\/\/\S+)/gm,'<a href="$1">$1</a>')}}),(0,U.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:5,minWidth:200,color:"incoming"===fe?"rgb(110, 169, 215)":"#c6e3fa",flexDirection:"incoming"===fe?"row":"row-reverse"},children:[(0,U.jsx)("div",{style:{fontSize:12},children:(0,j.Z)(new Date,new Date(t.date))>5?(0,p.Z)(new Date(t.date),"h:mm a"):(0,g.Z)((0,h.Z)(new Date(t.date),0),new Date,{addSuffix:!0})}),t.coinsInMessage>0?(0,U.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,U.jsx)("div",{style:{fontSize:12},children:null===t||void 0===t?void 0:t.coinsInMessage}),(0,U.jsx)("img",{src:R,style:{width:25,height:25},alt:"coin"})]}):null]})]})]})]}),E?(0,U.jsx)(J.Z,{sx:{"& button":{m:.5}},children:(0,U.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"max-content",marginLeft:"45px"},children:E.map((function(e,t){return(0,U.jsx)(C.Z,{variant:"outlined",size:"small",onClick:function(){return a(e)},children:e.name},t)}))})}):null,(0,U.jsx)(k.Z,{open:B,onClose:function(){return O(!1)},maxWidth:"xl",children:(0,U.jsxs)(D.Z,{children:["error"===Q?(0,U.jsx)("div",{children:ne}):null,"clarification"===Q?(0,U.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[ne,(0,U.jsx)(C.Z,{onClick:function(){return he("block")},variant:"outlined",size:"small",children:"To block list"})]}):null,"dialog"===Q?(0,U.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,U.jsxs)("div",{children:["Reward"," ",(0,U.jsx)("strong",{children:t.data.senderFirstName+" "+t.data.senderLastName})," ","with coins"]}),(0,U.jsx)(N.ZP,{"aria-label":"Coin amount",defaultValue:1,valueLabelDisplay:"auto",step:2,marks:!0,min:1,max:7,value:se,onChange:function(e,t){return le(t||t[0])},sx:{marginTop:"10px"}}),(0,U.jsxs)(J.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,U.jsx)(A.Z,{sx:{fontWeight:"bold"},children:se}),(0,U.jsx)("img",{src:R,style:{width:30,height:30},alt:"coin"})]}),(0,U.jsx)(C.Z,{onClick:function(){(0,m.tZ)("DPT",de[0].tokenName,Number(se),t.data.senderWalletAddress).then((function(){var e=ce.firstName+" "+ce.lastName+" -> "+se+" "+de[0].tokenName+" -> "+t.data.senderFirstName+" "+t.data.senderLastName;c.ZP.sendSystemMessage(t.roomJID,ce.firstName,ce.lastName,ce.walletAddress,e,se,t.id),O(!1)})).catch((function(e){console.log(e),ie("An error occurred during the coin transfer."),X("error")}))},variant:"outlined",size:"small",children:"Send coins"}),(0,U.jsx)(I.Z,{style:{margin:"10px"}}),(0,U.jsx)(C.Z,{onClick:function(){(0,M.c)(ce.walletAddress,t.data.senderWalletAddress,ce.firstName,t.data.senderFirstName,"@conference.dev.dxmpp.com",t.data.senderJID).then((function(e){if(e.isNewRoom){var t={jid:e.roomJid,name:e.roomName,room_background:"none",room_thumbnail:"none",users_cnt:"2",unreadMessages:0,composing:"",toUpdate:!0};u.K.getState().setNewUserChatRoom(t),o(e.roomJid)}else o(e.roomJid)})).catch((function(e){console.log("openPrivateRoom Error: ",e)}))},variant:"outlined",startIcon:(0,U.jsx)(L.Z,{}),children:"Direct message"}),(0,U.jsx)(I.Z,{style:{margin:"10px"}}),(0,U.jsx)(C.Z,{onClick:function(){return he("clarify")},variant:"contained",startIcon:(0,U.jsx)(K.Z,{}),children:"Block this user"}),(0,U.jsx)(A.Z,{style:{textAlign:"center"},variant:"caption",display:"block",gutterBottom:!0,children:"Stop seeing this user."})]}):null,"image"===Q?(0,U.jsx)("div",{children:(0,U.jsx)("img",{src:t.data.location,alt:t.data.originalName,style:{maxWidth:"100%"}})}):null]})})]})},_=function(e){var t=e.message;e.userJid;return(0,U.jsx)("div",{style:{textAlign:"center",color:"#6ea9d7",fontSize:".8em",boxSizing:"border-box",fontFamily:"Helvetica Neue,Segoe UI,Helvetica,Arial,sans-serif"},children:t.body},t.key)},E=n(74142),F=n(52797),T=n(40464),W=n(39571),B=n(96580),O=n(77248),H=n(18267);function V(){var e,t,n=(0,u.K)((function(e){return e.historyMessages})),r=(0,u.K)((function(e){return e.user})),j=(0,u.K)((function(e){return e.userChatRooms})),Z=(0,u.K)((function(e){return e.loaderArchive})),w=(0,u.K)((function(e){return e.currentUntrackedChatRoom})),S=(0,i.useState)(),b=(0,l.Z)(S,2),N=b[0],A=b[1],I=(0,i.useState)(""),P=(0,l.Z)(I,2),M=P[0],R=P[1],J=(0,i.useState)(""),L=(0,l.Z)(J,2),K=L[0],V=L[1],Y=(0,i.useState)({jid:"",name:"",room_background:"",room_thumbnail:"",users_cnt:""}),q=(0,l.Z)(Y,2),$=q[0],G=q[1],Q=(0,i.useRef)(null),X=(0,E.Z)(),ee=(0,F.Z)(X.breakpoints.down("md")),te=(0,i.useState)(!1),ne=(0,l.Z)(te,2),ie=ne[0],re=ne[1],ae=(0,i.useState)(!1),oe=(0,l.Z)(ae,2),se=oe[0],le=oe[1],de=(0,i.useState)({headline:"",description:""}),ce=(0,l.Z)(de,2),ue=ce[0],me=ce[1],fe=(0,y.UO)().roomJID,pe=(0,y.k6)(),ge=(0,i.useState)(!0),he=(0,l.Z)(ge,2),xe=he[0],ve=he[1],je=(0,i.useCallback)((function(e){Ce(e[0])}),[$]),ye=(0,H.uI)({onDrop:je,noClick:!0,maxFiles:1}).getRootProps;(0,i.useEffect)((function(){(0,m.k2)(r.walletAddress).then((function(e){A(e.data.result)}))}),[]);var Ze=function(e){pe.push("/chat/"+e.split("@")[0]),V(e);var t=j.filter((function(t){return t.jid===e}))[0];G(t),u.K.getState().clearCounterChatRoom(e),u.K.getState().setCurrentUntrackedChatRoom(e);var i=n.filter((function(t){return t.roomJID===e}));if(ve(!0),!Z&&i.length<=10&&i.length>0){var r=i[0].id;c.ZP.getPaginatedArchive(e,String(r),50)}},we=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return Z&&t.length<=0?"Loading...":t.length>0?t[0].body:"No messages yet"},Se=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return t.length<=0?"":(0,p.Z)(new Date(t[0].date),"H:mm")},be=function(e){if(M.trim().length>0){var t="";null!==N&&void 0!==N&&N.profileImage&&(t=null===N||void 0===N?void 0:N.profileImage);var n=function(e){var t=e;return(0===(t=(t=(t=t.replace(/<br>/gi,"\n")).replace(/<p.*>/gi,"\n")).replace(/<(?:.|\s)*?>/g,"")).trim().length?(new DOMParser).parseFromString(e,"text/html"):(new DOMParser).parseFromString(t,"text/html")).body.textContent||""}(x.sanitize(M));n.trim().length>0&&c.ZP.sendMessage(K,r.firstName,r.lastName,t,r.walletAddress,"object"===typeof e?e.value:n,"object"===typeof e?e.notDisplayedValue:null)}},Ce=function(e){me({headline:"File is loading, please wait...",description:""}),re(!0);var t=new FormData;t.append("files",e),(0,m.cT)(t).then((function(e){var t="";null!==N&&void 0!==N&&N.profileImage&&(t=null===N||void 0===N?void 0:N.profileImage),e.data.results.map(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={firstName:r.firstName,lastName:r.lastName,walletAddress:r.walletAddress,chatName:$.name,userAvatar:t,createdAt:n.createdAt,expiresAt:n.expiresAt,fileName:n.filename,isVisible:n.isVisible,location:n.location,locationPreview:n.locationPreview,mimetype:n.mimetype,originalName:n.originalname,ownerKey:n.ownerKey,size:n.size,duration:null===n||void 0===n?void 0:n.duration,updatedAt:n.updatedAt,userId:n.userId,waveForm:"",attachmentId:n._id,wrappable:!0},c.ZP.sendMediaMessageStanza(K,i),re(!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).catch((function(e){console.log(e),me({headline:"Error",description:"An error occurred while uploading the file"}),le(!0)})),Q.current&&(Q.current.value="")};return(0,i.useEffect)((function(){var e=setTimeout((function(){c.ZP.pausedComposing(r.walletAddress,$.jid)}),1e3);return function(){return clearTimeout(e)}}),[M]),(0,i.useEffect)((function(){w&&(fe&&"none"!==fe&&""!==fe&&w.split("@")[0]!==fe||(w.split("@")[1]?Ze(w):Ze(w+"@conference.dev.dxmpp.com"))),w.split("@")[0]!==fe&&"none"!==fe&&""!==fe&&(u.K.getState().setCurrentUntrackedChatRoom(fe),Ze(fe)),window.onblur=function(){u.K.getState().setCurrentUntrackedChatRoom("")},window.onfocus=function(){K&&(u.K.getState().setCurrentUntrackedChatRoom(K),u.K.getState().clearCounterChatRoom(K))}}),[K]),(0,i.useEffect)((function(){var e=n.filter((function(e){return e.roomJID===K}));if(!Z&&e.length>0&&e.length<=51&&K&&xe){var t=e[0];e.length>=10&&e.length<15&&t.data.isSystemMessage?(ve(!1),c.ZP.getPaginatedArchive(K,String(t.id),5)):1===e.length&&(ve(!1),c.ZP.getPaginatedArchive(K,String(t.id),50))}}),[n]),(0,U.jsxs)(d.Z,{style:{paddingBlock:"20px",height:"100%"},children:[(0,U.jsxs)(v.tz,{responsive:!0,children:[(0,U.jsxs)(v.YE,{position:"left",scrollable:!1,children:[(0,U.jsx)(v.ol,{placeholder:"Search..."}),(0,U.jsx)(v.p7,{loading:Z,children:j.map((function(e){return(0,U.jsx)(v.ri,{active:e.jid===K,unreadCnt:e.unreadMessages,onClick:function(){return Ze(e.jid)},name:e.name,info:we(e.jid),lastActivityTime:Se(e.jid),children:(0,U.jsx)(v.qE,{src:"none"!==e.room_background?e.room_background:"https://icotar.com/initials/"+e.name})},e.jid)}))})]}),(0,U.jsx)("div",(0,a.Z)((0,a.Z)({},ye()),{},{style:{width:"100%",height:"100%"},children:(0,U.jsxs)(v.uU,{children:[!!$&&(0,U.jsxs)(v.BU,{children:[(0,U.jsx)(v.BU.Back,{}),n.filter((function(e){return e.roomJID===K})).length>0&&(0,U.jsx)(v.BU.Content,{userName:$.name,info:"Active "+(0,g.Z)((0,h.Z)(new Date(n.filter((function(e){return e.roomJID===K})).slice(-1)[0].date),0),new Date,{addSuffix:!0})}),(0,U.jsx)(v.BU.Actions,{children:(0,U.jsx)(f.Z,{})})]}),(0,U.jsxs)(v.rN,{loadingMore:Z,onYReachStart:function(){var e=n.filter((function(e){return e.roomJID===K}));if(!Z){var t=e[0].id;c.ZP.getPaginatedArchive(K,String(t),10)}},disableOnYReachWhenNoScroll:!0,typingIndicator:!(null===(e=j.filter((function(e){return e.jid===K}))[0])||void 0===e||!e.composing)&&(0,U.jsx)(v.c2,{style:{opacity:".6"},content:null===(t=j.filter((function(e){return e.jid===K}))[0])||void 0===t?void 0:t.composing}),children:[n.filter((function(e){return e.roomJID===K})).map((function(e,t,n){var i,r,a,o,s=function(e,t,n){var i,r,a,o,s,l,d,c=null===(i=e[n-1])||void 0===i||null===(r=i.data.senderJID)||void 0===r?void 0:r.split("/")[0],u=null===(a=e[n+1])||void 0===a||null===(o=a.data.senderJID)||void 0===o?void 0:o.split("/")[0],m=null===(s=t.data.senderJID)||void 0===s?void 0:s.split("/")[0],f={position:"single",type:"single"};return e[n-1]&&t&&(0,p.Z)(new Date(null===(d=e[n-1])||void 0===d?void 0:d.date),"dd")!==(0,p.Z)(new Date(t.date),"dd")&&(f.separator=(0,p.Z)(new Date(t.date),"EEEE, dd LLLL yyyy")),c!==m&&u!==m?f:c!==m&&u===m?(f.position="first",f.type="first",f):c===m&&u===m?(f.position="normal",f.type="normal",f):c===m&&u!==m&&"false"===(null===(l=e[n-1])||void 0===l?void 0:l.data.isSystemMessage)?(f.position="single",f.type="last",f):f}(n,e,t);return"false"===e.data.isSystemMessage?(0,U.jsx)(z,{is:"Message",position:s,message:e,userJid:null===(i=c.ZP.client)||void 0===i||null===(r=i.jid)||void 0===r?void 0:r.toString(),buttonSender:be,chooseDirectRoom:Ze},e.id):(0,U.jsx)(_,{is:"Message",message:e,userJid:null===(a=c.ZP.client)||void 0===a||null===(o=a.jid)||void 0===o?void 0:o.toString()},e.id)})),n.length<=0||!K&&(0,U.jsx)(v.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:Z?"Loading...":(0,U.jsx)("span",{children:!K&&"To get started, please select a chat room."})}),!Z&&K&&n.filter((function(e){return e.roomJID===K})).length<=0&&(0,U.jsx)(v.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:"Message list is empty"})]}),!(null===$||void 0===$||!$.name)&&(0,U.jsxs)("div",{is:"MessageInput",children:[(0,U.jsx)(v.Ru,{onPaste:function(e){var t=Array.from(e.clipboardData.items).find((function(e){return/^image\//.test(e.type)}));if(t){var n=t.getAsFile();Ce(n)}},placeholder:"Type message here",onChange:function(e){R(e),c.ZP.isComposing(r.walletAddress,$.jid,r.firstName+" "+r.lastName)},onSend:be,onAttachClick:function(){return Q.current.click()}}),(0,U.jsx)("input",{type:"file",name:"file",id:"file",onChange:function(e){return Ce(e.target.files[0])},ref:Q,style:{display:"none"}})]})]})}))]}),(0,U.jsxs)(k.Z,{fullScreen:ee,open:ie,onClose:function(){return re(!0)},"aria-labelledby":"responsive-dialog-title",children:[(0,U.jsx)(T.Z,{id:"responsive-dialog-title",children:ue.headline}),(0,U.jsx)(D.Z,{children:se&&ue.description.length>0?(0,U.jsx)(W.Z,{children:ue.description}):(0,U.jsx)(d.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,U.jsx)(B.Z,{})})}),se?(0,U.jsx)(O.Z,{children:(0,U.jsx)(C.Z,{onClick:function(){return re(!1)},autoFocus:!0,children:"Close"})}):null]})]})}function Y(){return(0,U.jsx)(r.Z,{maxWidth:"xl",style:{height:"calc(100vh - 68px)"},children:(0,U.jsx)(V,{})})}}}]);
//# sourceMappingURL=657.b3af0a3a.chunk.js.map