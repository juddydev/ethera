"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[657],{23895:function(e,t,n){n.d(t,{c:function(){return l}});var i=n(74165),r=n(15861),a=n(85554),o=n(11210),s=function(e){return e?e.replace(/([A-Z])/g,"_$1").toLowerCase():"invalid string passed"},l=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r,l,d,c){var u,f,m,p,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=[t,n].sort().join("."),f=u.toLowerCase()+d,m=[r,l].sort().join(" and "),p=o.K.getState().userChatRooms,h=!1,0===p.filter((function(e){return e.jid===f})).length&&(h=!0,a.ZP.createNewRoom(u.toLowerCase()),a.ZP.setOwner(u.toLowerCase()),a.ZP.roomConfig(u.toLowerCase(),{roomName:m}),a.ZP.subsribe(f),a.ZP.presenceInRoom(f),setTimeout((function(){a.ZP.sendInvite(s(t),f.toLowerCase(),s(n))}),1e3)),e.abrupt("return",{roomJid:f,roomName:m,isNewRoom:h});case 7:case"end":return e.stop()}}),e)})));return function(t,n,i,r,a,o){return e.apply(this,arguments)}}()},7657:function(e,t,n){n.r(t),n.d(t,{default:function(){return V}});var i=n(72791),r=n(20803),a=n(1413),o=n(74165),s=n(15861),l=n(70885),d=n(50228),c=n(85554),u=n(11210),f=n(57337),m=n(89721),p=n(91482),h=n(16263),g=n(45586),x=n(78703),v=n(31128),j=n(95178),y=n(64880),Z=n(13811),w=n(48928),b=n(58487),C=n(30199),S=n(16992),N=n(70324),k=n(60788),D=n(8440),A=n(78473),P=n(4565),I=n(77248),R=n(52898),J=n(23895),M=n(57050),L=n(52791),K=n(80184),F=function(e){var t=e.message,n=e.userJid,r=e.position,a=e.buttonSender,o=e.chooseDirectRoom,s=t.data.senderFirstName,d=t.data.senderLastName,m=t.data.senderJID,x=(0,y.k6)(),F=(0,i.useState)(),U=(0,l.Z)(F,2),E=U[0],T=U[1],_=(0,i.useState)(!1),z=(0,l.Z)(_,2),W=z[0],B=z[1],O=i.useState(null),H=(0,l.Z)(O,2),V=H[0],q=H[1],Y=(0,i.useState)("transfer"),$=(0,l.Z)(Y,2),G=$[0],Q=$[1],X=(0,i.useState)(""),ee=(0,l.Z)(X,2),te=ee[0],ne=ee[1],ie=Boolean(V),re=(0,i.useState)(1),ae=(0,l.Z)(re,2),oe=ae[0],se=ae[1],le=(0,u.K)((function(e){return e.balance})).filter((function(e){return!e.tokenType&&e.contractAddress.length>10})),de=(0,u.K)((function(e){return e.user}));return(0,i.useEffect)((function(){t.data.quickReplies&&T(JSON.parse(t.data.quickReplies))}),[]),(0,K.jsxs)("div",{is:"Message",children:[r.separator?(0,K.jsx)(v.it,{children:r.separator}):null,(0,K.jsxs)(v.v0,{model:{sender:s+" "+d,direction:String(n).split("/")[0]===String(m).split("/")[0]?"outgoing":"incoming",position:r.position},avatarPosition:String(n).split("/")[0]===String(m).split("/")[0]?"tr":"tl",avatarSpacer:"first"!==r.type&&"single"!==r.type,children:[("first"===r.type||"single"===r.type)&&(0,K.jsx)("img",{style:{borderRadius:"50%",boxSizing:"border-box",width:"42px",height:"42px",cursor:"pointer"},onClick:function(){return x.push("/profile/"+t.data.senderWalletAddress)},is:"Avatar",src:t.data.photoURL?t.data.photoURL:"https://icotar.com/initials/"+s+" "+d,onError:function(e){var t=e.currentTarget;t.onerror=null,t.src="https://icotar.com/initials/"+s+" "+d},alt:s}),(0,K.jsxs)(v.v0.CustomContent,{children:[("first"===r.type||"single"===r.type)&&(0,K.jsxs)("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,K.jsxs)("strong",{style:{cursor:"pointer"},onClick:function(){return x.push("/profile/"+t.data.senderWalletAddress)},children:[s," ",d,(0,K.jsx)("br",{})]}),String(n).split("/")[0]!==String(m).split("/")[0]?(0,K.jsx)(Z.Z,{"aria-label":"more",id:"long-button","aria-controls":ie?"long-menu":void 0,"aria-expanded":ie?"true":void 0,"aria-haspopup":"true",onClick:function(e){q(e.currentTarget)},children:(0,K.jsx)(R.Z,{})}):null]}),t.data.isMediafile&&"image"===t.data.mimetype.split("/")[0]?(0,K.jsx)(w.Z,{sx:{maxWidth:200},children:(0,K.jsx)(b.Z,{onClick:function(){B(!0),Q("image")},children:(0,K.jsx)(C.Z,{style:{height:150,objectFit:"cover",objectPosition:"left"},component:"img",height:"150",image:t.data.location,alt:t.data.originalName})})}):null,t.data.isMediafile&&"application"===t.data.mimetype.split("/")[0]?(0,K.jsxs)("a",{target:"_blank",href:t.data.location,children:[(0,K.jsx)(v.v0.ImageContent,{src:t.data.locationPreview,alt:t.data.originalName,width:150}),t.data.mimetype.split("/")[1]]}):null,t.data.isMediafile&&"video"===t.data.mimetype.split("/")[0]?(0,K.jsxs)("video",{controls:!0,width:"200px",children:[(0,K.jsx)("source",{src:t.data.location,type:t.data.mimetype,title:t.data.originalName}),"Sorry, your browser doesn't support videos."]}):null,t.data.isMediafile?null:(0,K.jsx)("span",{dangerouslySetInnerHTML:{__html:t.body.replace(/\b(https?\:\/\/\S+)/gm,'<a href="$1">$1</a>')}})]}),("last"===r.type||"single"===r.type)&&(0,K.jsx)(v.v0.Footer,{sentTime:(0,j.Z)(new Date,new Date(t.date))>5?(0,p.Z)(new Date(t.date),"h:mm:ss a"):(0,h.Z)((0,g.Z)(new Date(t.date),0),new Date,{addSuffix:!0})})]}),E?(0,K.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"max-content",marginLeft:"45px"},children:E.map((function(e,t){return(0,K.jsx)(v.zx,{onClick:function(){return a(e)},border:!0,children:e.name},t)}))}):null,(0,K.jsxs)(S.Z,{id:"basic-menu",anchorEl:V,open:ie,onClose:function(){return q(null)},MenuListProps:{"aria-labelledby":"basic-button"},anchorOrigin:{vertical:"bottom",horizontal:"center"},children:[(0,K.jsx)(N.Z,{onClick:function(){return e="transfer",q(null),B(!0),void Q(e);var e},children:"Transfer coins"}),(0,K.jsx)(N.Z,{onClick:function(){(0,J.c)(de.walletAddress,t.data.senderWalletAddress,de.firstName,t.data.senderFirstName,"@conference.dev.dxmpp.com",t.data.senderJID).then((function(e){if(e.isNewRoom){var t={jid:e.roomJid,name:e.roomName,room_background:"none",room_thumbnail:"none",users_cnt:"2",unreadMessages:0,composing:"",toUpdate:!0};u.K.getState().setNewUserChatRoom(t),o(e.roomJid)}else o(e.roomJid)})).catch((function(e){console.log("openPrivateRoom Error: ",e)}))},children:"Direct message"})]}),(0,K.jsxs)(k.Z,{open:W,onClose:function(){return B(!0)},maxWidth:"xl","aria-labelledby":"responsive-dialog-title",children:[(0,K.jsxs)(D.Z,{children:["error"===G?(0,K.jsx)("div",{children:te}):null,"transfer"===G?(0,K.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,K.jsxs)("div",{children:["Reward"," ",(0,K.jsx)("strong",{children:t.data.senderFirstName+" "+t.data.senderLastName})," ","with coins"]}),(0,K.jsx)(A.ZP,{"aria-label":"Coin amount",defaultValue:1,valueLabelDisplay:"auto",step:2,marks:!0,min:1,max:7,value:oe,onChange:function(e,t){return se(t||t[0])},sx:{marginTop:"10px"}}),(0,K.jsxs)(L.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,K.jsx)(P.Z,{sx:{fontWeight:"bold"},children:oe}),(0,K.jsx)("img",{src:M,style:{width:30,height:30},alt:"coin"})]})]}):null,"image"===G?(0,K.jsx)("div",{children:(0,K.jsx)("img",{src:t.data.location,alt:t.data.originalName,style:{maxWidth:"100%"}})}):null]}),(0,K.jsxs)(I.Z,{children:["transfer"===G&&(0,K.jsx)(v.zx,{onClick:function(){(0,f.tZ)("DPT",le[0].tokenName,Number(oe),t.data.senderWalletAddress).then((function(){var e=de.firstName+" "+de.lastName+" -> "+oe+" "+le[0].tokenName+" -> "+t.data.senderFirstName+" "+t.data.senderLastName;c.ZP.sendSystemMessage(t.roomJID,de.firstName,de.lastName,de.walletAddress,e,null,t.id),B(!1)})).catch((function(e){console.log(e),ne("An error occurred during the coin transfer."),Q("error")}))},children:"Send"}),(0,K.jsx)(v.zx,{onClick:function(){return B(!1)},autoFocus:!0,children:"Close"})]})]})]})},U=function(e){var t=e.message;e.userJid;return(0,K.jsx)("div",{style:{textAlign:"center",color:"#6ea9d7",fontSize:".8em",boxSizing:"border-box",fontFamily:"Helvetica Neue,Segoe UI,Helvetica,Arial,sans-serif"},children:t.body},t.key)},E=n(74142),T=n(52797),_=n(40464),z=n(39571),W=n(96580),B=n(17205),O=n(18267);function H(){var e,t,n=(0,u.K)((function(e){return e.historyMessages})),r=(0,u.K)((function(e){return e.user})),j=(0,u.K)((function(e){return e.userChatRooms})),Z=(0,u.K)((function(e){return e.loaderArchive})),w=(0,u.K)((function(e){return e.currentUntrackedChatRoom})),b=(0,i.useState)(),C=(0,l.Z)(b,2),S=C[0],N=C[1],A=(0,i.useState)(""),P=(0,l.Z)(A,2),R=P[0],J=P[1],M=(0,i.useState)(""),L=(0,l.Z)(M,2),H=L[0],V=L[1],q=(0,i.useState)({jid:"",name:"",room_background:"",room_thumbnail:"",users_cnt:""}),Y=(0,l.Z)(q,2),$=Y[0],G=Y[1],Q=(0,i.useRef)(null),X=(0,E.Z)(),ee=(0,T.Z)(X.breakpoints.down("md")),te=(0,i.useState)(!1),ne=(0,l.Z)(te,2),ie=ne[0],re=ne[1],ae=(0,i.useState)(!1),oe=(0,l.Z)(ae,2),se=oe[0],le=oe[1],de=(0,i.useState)({headline:"",description:""}),ce=(0,l.Z)(de,2),ue=ce[0],fe=ce[1],me=(0,y.UO)().roomJID,pe=(0,y.k6)(),he=(0,i.useState)(!0),ge=(0,l.Z)(he,2),xe=ge[0],ve=ge[1],je=(0,i.useCallback)((function(e){Se(e[0])}),[$]),ye=(0,O.uI)({onDrop:je,noClick:!0,maxFiles:1}).getRootProps;(0,i.useEffect)((function(){(0,f.k2)(r.walletAddress).then((function(e){N(e.data.result)}))}),[]);var Ze=function(e){pe.push("/chat/"+e.split("@")[0]),V(e);var t=j.filter((function(t){return t.jid===e}))[0];G(t),u.K.getState().clearCounterChatRoom(e),u.K.getState().setCurrentUntrackedChatRoom(e);var i=n.filter((function(t){return t.roomJID===e}));if(ve(!0),!Z&&i.length<=10&&i.length>0){var r=i[0].id;c.ZP.getPaginatedArchive(e,String(r),50)}},we=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return Z&&t.length<=0?"Loading...":t.length>0?t[0].body:"No messages yet"},be=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return t.length<=0?"":(0,p.Z)(new Date(t[0].date),"H:mm")},Ce=function(e){if(R.trim().length>0){var t="";null!==S&&void 0!==S&&S.profileImage&&(t=null===S||void 0===S?void 0:S.profileImage);var n=function(e){var t=e;return(0===(t=(t=(t=t.replace(/<br>/gi,"\n")).replace(/<p.*>/gi,"\n")).replace(/<(?:.|\s)*?>/g,"")).trim().length?(new DOMParser).parseFromString(e,"text/html"):(new DOMParser).parseFromString(t,"text/html")).body.textContent||""}(x.sanitize(R));n.trim().length>0&&c.ZP.sendMessage(H,r.firstName,r.lastName,t,r.walletAddress,"object"===typeof e?e.value:n,"object"===typeof e?e.notDisplayedValue:null)}},Se=function(e){fe({headline:"File is loading, please wait...",description:""}),re(!0);var t=new FormData;t.append("files",e),(0,f.cT)(t).then((function(e){var t="";null!==S&&void 0!==S&&S.profileImage&&(t=null===S||void 0===S?void 0:S.profileImage),e.data.results.map(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={firstName:r.firstName,lastName:r.lastName,walletAddress:r.walletAddress,chatName:$.name,userAvatar:t,createdAt:n.createdAt,expiresAt:n.expiresAt,fileName:n.filename,isVisible:n.isVisible,location:n.location,locationPreview:n.locationPreview,mimetype:n.mimetype,originalName:n.originalname,ownerKey:n.ownerKey,size:n.size,duration:null===n||void 0===n?void 0:n.duration,updatedAt:n.updatedAt,userId:n.userId,waveForm:"",attachmentId:n._id,wrappable:!0},c.ZP.sendMediaMessageStanza(H,i),re(!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).catch((function(e){console.log(e),fe({headline:"Error",description:"An error occurred while uploading the file"}),le(!0)})),Q.current&&(Q.current.value="")};return(0,i.useEffect)((function(){var e=setTimeout((function(){c.ZP.pausedComposing(r.walletAddress,$.jid)}),1e3);return function(){return clearTimeout(e)}}),[R]),(0,i.useEffect)((function(){w&&(me&&"none"!==me&&""!==me&&w.split("@")[0]!==me||Ze(w)),w.split("@")[0]!==me&&"none"!==me&&""!==me&&(u.K.getState().setCurrentUntrackedChatRoom(me),Ze(me)),window.onblur=function(){u.K.getState().setCurrentUntrackedChatRoom("")},window.onfocus=function(){H&&(u.K.getState().setCurrentUntrackedChatRoom(H),u.K.getState().clearCounterChatRoom(H))}}),[H]),(0,i.useEffect)((function(){var e=n.filter((function(e){return e.roomJID===H}));if(!Z&&e.length>0&&e.length<=51&&H&&xe){var t=e[0];e.length>=10&&e.length<15&&t.data.isSystemMessage?(ve(!1),c.ZP.getPaginatedArchive(H,String(t.id),5)):1===e.length&&(ve(!1),c.ZP.getPaginatedArchive(H,String(t.id),50))}}),[n]),(0,K.jsxs)(d.Z,{style:{paddingBlock:"20px",height:"100%"},children:[(0,K.jsxs)(v.tz,{responsive:!0,children:[(0,K.jsxs)(v.YE,{position:"left",scrollable:!1,children:[(0,K.jsx)(v.ol,{placeholder:"Search..."}),(0,K.jsx)(v.p7,{loading:Z,children:j.map((function(e){return(0,K.jsx)(v.ri,{active:e.jid===H,unreadCnt:e.unreadMessages,onClick:function(){return Ze(e.jid)},name:e.name,info:we(e.jid),lastActivityTime:be(e.jid),children:(0,K.jsx)(v.qE,{src:"none"!==e.room_background?e.room_background:"https://icotar.com/initials/"+e.name})},e.jid)}))})]}),(0,K.jsx)("div",(0,a.Z)((0,a.Z)({},ye()),{},{style:{width:"100%",height:"100%"},children:(0,K.jsxs)(v.uU,{children:[!!$&&(0,K.jsxs)(v.BU,{children:[(0,K.jsx)(v.BU.Back,{}),n.filter((function(e){return e.roomJID===H})).length>0&&(0,K.jsx)(v.BU.Content,{userName:$.name,info:"Active "+(0,h.Z)((0,g.Z)(new Date(n.filter((function(e){return e.roomJID===H})).slice(-1)[0].date),0),new Date,{addSuffix:!0})}),(0,K.jsx)(v.BU.Actions,{children:(0,K.jsx)(m.Z,{})})]}),(0,K.jsxs)(v.rN,{loadingMore:Z,onYReachStart:function(){var e=n.filter((function(e){return e.roomJID===H}));if(!Z){var t=e[0].id;c.ZP.getPaginatedArchive(H,String(t),10)}},disableOnYReachWhenNoScroll:!0,typingIndicator:!(null===(e=j.filter((function(e){return e.jid===H}))[0])||void 0===e||!e.composing)&&(0,K.jsx)(v.c2,{style:{opacity:".6"},content:null===(t=j.filter((function(e){return e.jid===H}))[0])||void 0===t?void 0:t.composing}),children:[n.filter((function(e){return e.roomJID===H})).map((function(e,t,n){var i,r,a,o,s=function(e,t,n){var i,r,a,o,s,l,d=null===(i=e[n-1])||void 0===i||null===(r=i.data.senderJID)||void 0===r?void 0:r.split("/")[0],c=null===(a=e[n+1])||void 0===a||null===(o=a.data.senderJID)||void 0===o?void 0:o.split("/")[0],u=null===(s=t.data.senderJID)||void 0===s?void 0:s.split("/")[0],f={position:"single",type:"single"};return e[n-1]&&t&&(0,p.Z)(new Date(null===(l=e[n-1])||void 0===l?void 0:l.date),"dd")!==(0,p.Z)(new Date(t.date),"dd")&&(f.separator=(0,p.Z)(new Date(t.date),"EEEE, dd LLLL yyyy")),d!==u&&c!==u?f:d!==u&&c===u?(f.position="first",f.type="first",f):d===u&&c===u?(f.position="normal",f.type="normal",f):d===u&&c!==u?(f.position="single",f.type="last",f):f}(n,e,t);return"false"===e.data.isSystemMessage?(0,K.jsx)(F,{is:"Message",position:s,message:e,userJid:null===(i=c.ZP.client)||void 0===i||null===(r=i.jid)||void 0===r?void 0:r.toString(),buttonSender:Ce,chooseDirectRoom:Ze},e.id):(0,K.jsx)(U,{is:"Message",message:e,userJid:null===(a=c.ZP.client)||void 0===a||null===(o=a.jid)||void 0===o?void 0:o.toString()},e.id)})),n.length<=0||!H&&(0,K.jsx)(v.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:Z?"Loading...":(0,K.jsx)("span",{children:!H&&"To get started, please select a chat room."})}),!Z&&H&&n.filter((function(e){return e.roomJID===H})).length<=0&&(0,K.jsx)(v.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:"Message list is empty"})]}),!!$&&(0,K.jsxs)("div",{is:"MessageInput",children:[(0,K.jsx)(v.Ru,{onPaste:function(e){var t=Array.from(e.clipboardData.items).find((function(e){return/^image\//.test(e.type)}));if(t){var n=t.getAsFile();Se(n)}},placeholder:"Type message here",onChange:function(e){J(e),c.ZP.isComposing(r.walletAddress,$.jid,r.firstName+" "+r.lastName)},onSend:Ce,onAttachClick:function(){return Q.current.click()}}),(0,K.jsx)("input",{type:"file",name:"file",id:"file",onChange:function(e){return Se(e.target.files[0])},ref:Q,style:{display:"none"}})]})]})}))]}),(0,K.jsxs)(k.Z,{fullScreen:ee,open:ie,onClose:function(){return re(!0)},"aria-labelledby":"responsive-dialog-title",children:[(0,K.jsx)(_.Z,{id:"responsive-dialog-title",children:ue.headline}),(0,K.jsx)(D.Z,{children:se&&ue.description.length>0?(0,K.jsx)(z.Z,{children:ue.description}):(0,K.jsx)(d.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,K.jsx)(W.Z,{})})}),se?(0,K.jsx)(I.Z,{children:(0,K.jsx)(B.Z,{onClick:function(){return re(!1)},autoFocus:!0,children:"Close"})}):null]})]})}function V(){return(0,K.jsx)(r.Z,{maxWidth:"xl",style:{height:"calc(100vh - 68px)"},children:(0,K.jsx)(H,{})})}}}]);
//# sourceMappingURL=657.c8302e10.chunk.js.map