"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[657],{23895:function(e,t,n){n.d(t,{c:function(){return l}});var i=n(74165),r=n(15861),a=n(85554),o=n(11210),s=function(e){return e?e.replace(/([A-Z])/g,"_$1").toLowerCase():"invalid string passed"},l=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r,l,d,c){var u,m,f,p,g;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=[t,n].sort().join("."),m=u.toLowerCase()+d,f=[r,l].sort().join(" and "),p=o.K.getState().userChatRooms,g=!1,0===p.filter((function(e){return e.jid===m})).length&&(g=!0,a.ZP.createNewRoom(u.toLowerCase()),a.ZP.setOwner(u.toLowerCase()),a.ZP.roomConfig(u.toLowerCase(),{roomName:f}),a.ZP.subsribe(m),a.ZP.presenceInRoom(m),setTimeout((function(){a.ZP.sendInvite(s(t),m.toLowerCase(),s(n))}),1e3)),e.abrupt("return",{roomJid:m,roomName:f,isNewRoom:g});case 7:case"end":return e.stop()}}),e)})));return function(t,n,i,r,a,o){return e.apply(this,arguments)}}()},7657:function(e,t,n){n.r(t),n.d(t,{default:function(){return V}});var i=n(72791),r=n(20803),a=n(1413),o=n(74165),s=n(15861),l=n(70885),d=n(50228),c=n(85554),u=n(11210),m=n(57337),f=n(89721),p=n(91482),g=n(16263),h=n(45586),x=n(78703),v=n(31128),j=n(95178),y=n(64880),Z=n(13811),w=n(48928),b=n(58487),S=n(30199),C=n(17205),k=n(60788),D=n(8440),N=n(4565),A=n(81872),I=n(59911),P=n(52898),M=n(23895),R=n(57050),J=n(52791),L=n(21686),K=n(64558),U=n(68438),z=n(80184),E=function(e){var t=e.message,n=e.userJid,r=e.position,a=e.buttonSender,o=e.chooseDirectRoom,s=t.data.senderFirstName,d=t.data.senderLastName,f=t.data.senderJID,x=(0,y.k6)(),E=(0,i.useState)(),_=(0,l.Z)(E,2),F=_[0],T=_[1],W=(0,i.useState)(!1),B=(0,l.Z)(W,2),O=B[0],H=B[1],Y=i.useState(null),q=(0,l.Z)(Y,2),V=q[0],$=q[1],G=(0,i.useState)("dialog"),Q=(0,l.Z)(G,2),X=Q[0],ee=Q[1],te=(0,i.useState)(""),ne=(0,l.Z)(te,2),ie=ne[0],re=ne[1],ae=Boolean(V),oe=(0,i.useState)(1),se=(0,l.Z)(oe,2),le=se[0],de=se[1],ce=(0,u.K)((function(e){return e.balance})).filter((function(e){return!e.tokenType&&e.contractAddress.length>10})),ue=(0,u.K)((function(e){return e.user})),me=(0,i.useState)("incoming"),fe=(0,l.Z)(me,2),pe=fe[0],ge=fe[1],he=function(e){$(null),H(!0),ee(e)},xe=function(e){var n=Number(e||le);(0,m.tZ)("DPT",ce[0].tokenName,n,t.data.senderWalletAddress).then((function(e){var i=ce[0].tokenName===U.zl?U.w5:ce[0].tokenName,r=ue.firstName+" "+ue.lastName,a=t.data.senderFirstName+" "+t.data.senderLastName,o="".concat(r," -> ").concat(le," ").concat(i," -> ").concat(a);c.ZP.sendSystemMessage(t.roomJID,ue.firstName,ue.lastName,ue.walletAddress,o,n,t.id),H(!1)})).catch((function(e){console.log(e),re("An error occurred during the coin transfer."),ee("error")}))},ve=function(e){"clarify"===e&&(re("Are you sure you want to block the user?"),ee("clarification")),"block"===e&&(c.ZP.blacklistUser(t.data.senderJID),u.K.getState().removeAllInMessageHistory(t.data.senderJID),H(!1))};return(0,i.useEffect)((function(){t.data.quickReplies&&T(JSON.parse(t.data.quickReplies)),ge(String(n).split("/")[0]===String(f).split("/")[0]?"outgoing":"incoming")}),[]),(0,z.jsxs)("div",{is:"Message",children:[r.separator?(0,z.jsx)(v.it,{children:r.separator}):null,(0,z.jsxs)(v.v0,{onContextMenu:"incoming"===pe?function(e){e.preventDefault(),he("dialog")}:null,style:{marginBottom:"last"===r.type||"single"===r.type?15:null},model:{sender:s+" "+d,direction:pe,position:r.position},avatarPosition:String(n).split("/")[0]===String(f).split("/")[0]?"tr":"tl",avatarSpacer:"first"!==r.type&&"single"!==r.type,children:[("first"===r.type||"single"===r.type)&&(0,z.jsx)("img",{style:{borderRadius:"50%",boxSizing:"border-box",width:"42px",height:"42px",cursor:"pointer"},onClick:function(){return x.push("/profile/"+t.data.senderWalletAddress)},is:"Avatar",src:t.data.photoURL?t.data.photoURL:"https://icotar.com/initials/"+s+" "+d,onError:function(e){var t=e.currentTarget;t.onerror=null,t.src="https://icotar.com/initials/"+s+" "+d},alt:s}),(0,z.jsxs)(v.v0.CustomContent,{children:[("first"===r.type||"single"===r.type)&&(0,z.jsxs)("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.jsxs)("strong",{style:{cursor:"pointer"},onClick:function(){return x.push("/profile/"+t.data.senderWalletAddress)},children:[s," ",d,(0,z.jsx)("br",{})]}),String(n).split("/")[0]!==String(f).split("/")[0]?(0,z.jsx)(Z.Z,{"aria-label":"more",id:"long-button","aria-controls":ae?"long-menu":void 0,"aria-expanded":ae?"true":void 0,"aria-haspopup":"true",onClick:function(){return he("dialog")},children:(0,z.jsx)(P.Z,{})}):null]}),t.data.isMediafile&&"image"===t.data.mimetype.split("/")[0]?(0,z.jsx)(w.Z,{sx:{maxWidth:200},children:(0,z.jsx)(b.Z,{onClick:function(){H(!0),ee("image")},children:(0,z.jsx)(S.Z,{style:{height:150,objectFit:"cover",objectPosition:"left"},component:"img",height:"150",image:t.data.location,alt:t.data.originalName})})}):null,t.data.isMediafile&&"application"===t.data.mimetype.split("/")[0]?(0,z.jsxs)("a",{target:"_blank",href:t.data.location,children:[(0,z.jsx)(v.v0.ImageContent,{src:t.data.locationPreview,alt:t.data.originalName,width:150}),t.data.mimetype.split("/")[1]]}):null,t.data.isMediafile&&"video"===t.data.mimetype.split("/")[0]?(0,z.jsxs)("video",{controls:!0,width:"200px",children:[(0,z.jsx)("source",{src:t.data.location,type:t.data.mimetype,title:t.data.originalName}),"Sorry, your browser doesn't support videos."]}):null,t.data.isMediafile&&"audio"===t.data.mimetype.split("/")[0]?(0,z.jsxs)("audio",{controls:!0,children:[(0,z.jsx)("source",{src:t.data.location,type:t.data.mimetype}),"Your browser does not support the audio element."]}):null,t.data.isMediafile?null:(0,z.jsxs)("div",{children:[(0,z.jsx)("span",{dangerouslySetInnerHTML:{__html:t.body.replace(/\b(https?\:\/\/\S+)/gm,'<a href="$1">$1</a>')}}),(0,z.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:5,minWidth:200,color:"incoming"===pe?"rgb(110, 169, 215)":"#c6e3fa",flexDirection:"incoming"===pe?"row":"row-reverse"},children:[(0,z.jsx)("div",{style:{fontSize:12},children:(0,j.Z)(new Date,new Date(t.date))>5?(0,p.Z)(new Date(t.date),"h:mm a"):(0,g.Z)((0,h.Z)(new Date(t.date),0),new Date,{addSuffix:!0})}),t.coinsInMessage>0?(0,z.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,z.jsx)("div",{style:{fontSize:12},children:null===t||void 0===t?void 0:t.coinsInMessage}),(0,z.jsx)("img",{src:R,style:{width:25,height:25},alt:"coin"})]}):null]})]})]})]}),F?(0,z.jsx)(J.Z,{sx:{"& button":{m:.5}},children:(0,z.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"max-content",marginLeft:"45px"},children:F.map((function(e,t){return(0,z.jsx)(C.Z,{variant:"outlined",size:"small",onClick:function(){return a(e)},children:e.name},t)}))})}):null,(0,z.jsx)(k.Z,{open:O,onClose:function(){return H(!1)},maxWidth:"xl",children:(0,z.jsxs)(D.Z,{children:["error"===X?(0,z.jsx)("div",{children:ie}):null,"clarification"===X?(0,z.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[ie,(0,z.jsx)(C.Z,{onClick:function(){return ve("block")},variant:"outlined",size:"small",children:"To block list"})]}):null,"dialog"===X?(0,z.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,z.jsxs)("div",{children:["Reward"," ",(0,z.jsx)("strong",{children:t.data.senderFirstName+" "+t.data.senderLastName})," ","with coins"]}),(0,z.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",margin:"10px 0px 10px 0px"},children:[1,3,5,"x"].map((function(e){return(0,z.jsxs)("div",{style:{textAlign:"center",cursor:"pointer"},onClick:function(){"number"===typeof e?xe(e):ee("transfer")},children:[(0,z.jsx)("img",{src:R,style:{width:25,height:25},alt:"coin"}),(0,z.jsx)(N.Z,{sx:{fontWeight:"bold"},children:e})]},e)}))}),(0,z.jsx)(A.Z,{style:{margin:"10px"}}),(0,z.jsx)(C.Z,{onClick:function(){(0,M.c)(ue.walletAddress,t.data.senderWalletAddress,ue.firstName,t.data.senderFirstName,"@conference.dev.dxmpp.com",t.data.senderJID).then((function(e){if(e.isNewRoom){var t={jid:e.roomJid,name:e.roomName,room_background:"none",room_thumbnail:"none",users_cnt:"2",unreadMessages:0,composing:"",toUpdate:!0};u.K.getState().setNewUserChatRoom(t),o(e.roomJid)}else o(e.roomJid)})).catch((function(e){console.log("openPrivateRoom Error: ",e)}))},variant:"outlined",startIcon:(0,z.jsx)(L.Z,{}),children:"Direct message"}),(0,z.jsx)(A.Z,{style:{margin:"10px"}}),(0,z.jsx)(C.Z,{onClick:function(){return ve("clarify")},variant:"contained",startIcon:(0,z.jsx)(K.Z,{}),children:"Block this user"}),(0,z.jsx)(N.Z,{style:{textAlign:"center"},variant:"caption",display:"block",gutterBottom:!0,children:"Stop seeing this user."})]}):null,"transfer"===X?(0,z.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,z.jsx)(I.Z,{id:"standard-basic",type:"number",label:"Enter transfer amount",variant:"standard",onChange:function(e){return de(Number(e.target.value))}}),(0,z.jsx)(C.Z,{style:{marginTop:10},onClick:function(){return xe()},variant:"outlined",size:"small",children:"Send coins"})]}):null,"image"===X?(0,z.jsx)("div",{children:(0,z.jsx)("img",{src:t.data.location,alt:t.data.originalName,style:{maxWidth:"100%"}})}):null]})})]})},_=function(e){var t=e.message;e.userJid;return(0,z.jsx)("div",{style:{textAlign:"center",color:"#6ea9d7",fontSize:".8em",boxSizing:"border-box",fontFamily:"Helvetica Neue,Segoe UI,Helvetica,Arial,sans-serif"},children:t.body},t.key)},F=n(74142),T=n(52797),W=n(40464),B=n(39571),O=n(96580),H=n(77248),Y=n(18267);function q(){var e,t,n=(0,u.K)((function(e){return e.historyMessages})),r=(0,u.K)((function(e){return e.user})),j=(0,u.K)((function(e){return e.userChatRooms})),Z=(0,u.K)((function(e){return e.loaderArchive})),w=(0,u.K)((function(e){return e.currentUntrackedChatRoom})),b=(0,i.useState)(),S=(0,l.Z)(b,2),N=S[0],A=S[1],I=(0,i.useState)(""),P=(0,l.Z)(I,2),M=P[0],R=P[1],J=(0,i.useState)(""),L=(0,l.Z)(J,2),K=L[0],U=L[1],q=(0,i.useState)({jid:"",name:"",room_background:"",room_thumbnail:"",users_cnt:""}),V=(0,l.Z)(q,2),$=V[0],G=V[1],Q=(0,i.useRef)(null),X=(0,F.Z)(),ee=(0,T.Z)(X.breakpoints.down("md")),te=(0,i.useState)(!1),ne=(0,l.Z)(te,2),ie=ne[0],re=ne[1],ae=(0,i.useState)(!1),oe=(0,l.Z)(ae,2),se=oe[0],le=oe[1],de=(0,i.useState)({headline:"",description:""}),ce=(0,l.Z)(de,2),ue=ce[0],me=ce[1],fe=(0,y.UO)().roomJID,pe=(0,y.k6)(),ge=(0,i.useState)(!0),he=(0,l.Z)(ge,2),xe=he[0],ve=he[1],je=(0,i.useCallback)((function(e){Ce(e[0])}),[$]),ye=(0,Y.uI)({onDrop:je,noClick:!0,maxFiles:1}).getRootProps;(0,i.useEffect)((function(){(0,m.k2)(r.walletAddress).then((function(e){A(e.data.result)}))}),[]);var Ze=function(e){pe.push("/chat/"+e.split("@")[0]),U(e);var t=j.filter((function(t){return t.jid===e}))[0];G(t),u.K.getState().clearCounterChatRoom(e),u.K.getState().setCurrentUntrackedChatRoom(e);var i=n.filter((function(t){return t.roomJID===e}));if(ve(!0),!Z&&i.length<=10&&i.length>0){var r=i[0].id;c.ZP.getPaginatedArchive(e,String(r),50)}},we=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return Z&&t.length<=0?"Loading...":t.length>0?t[0].body:"No messages yet"},be=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return t.length<=0?"":(0,p.Z)(new Date(t[0].date),"H:mm")},Se=function(e){if(M.trim().length>0){var t="";null!==N&&void 0!==N&&N.profileImage&&(t=null===N||void 0===N?void 0:N.profileImage);var n=function(e){var t=e;return(0===(t=(t=(t=t.replace(/<br>/gi,"\n")).replace(/<p.*>/gi,"\n")).replace(/<(?:.|\s)*?>/g,"")).trim().length?(new DOMParser).parseFromString(e,"text/html"):(new DOMParser).parseFromString(t,"text/html")).body.textContent||""}(x.sanitize(M));n.trim().length>0&&c.ZP.sendMessage(K,r.firstName,r.lastName,t,r.walletAddress,"object"===typeof e?e.value:n,"object"===typeof e?e.notDisplayedValue:null)}},Ce=function(e){me({headline:"File is loading, please wait...",description:""}),re(!0);var t=new FormData;t.append("files",e),(0,m.cT)(t).then((function(e){var t="";null!==N&&void 0!==N&&N.profileImage&&(t=null===N||void 0===N?void 0:N.profileImage),e.data.results.map(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(n){var i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={firstName:r.firstName,lastName:r.lastName,walletAddress:r.walletAddress,chatName:$.name,userAvatar:t,createdAt:n.createdAt,expiresAt:n.expiresAt,fileName:n.filename,isVisible:n.isVisible,location:n.location,locationPreview:n.locationPreview,mimetype:n.mimetype,originalName:n.originalname,ownerKey:n.ownerKey,size:n.size,duration:null===n||void 0===n?void 0:n.duration,updatedAt:n.updatedAt,userId:n.userId,waveForm:"",attachmentId:n._id,wrappable:!0},c.ZP.sendMediaMessageStanza(K,i),re(!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).catch((function(e){console.log(e),me({headline:"Error",description:"An error occurred while uploading the file"}),le(!0)})),Q.current&&(Q.current.value="")};return(0,i.useEffect)((function(){var e=setTimeout((function(){c.ZP.pausedComposing(r.walletAddress,$.jid)}),1e3);return function(){return clearTimeout(e)}}),[M]),(0,i.useEffect)((function(){w&&(fe&&"none"!==fe&&""!==fe&&w.split("@")[0]!==fe||(w.split("@")[1]?Ze(w):Ze(w+"@conference.dev.dxmpp.com"))),w.split("@")[0]!==fe&&"none"!==fe&&""!==fe&&(u.K.getState().setCurrentUntrackedChatRoom(fe),Ze(fe)),window.onblur=function(){u.K.getState().setCurrentUntrackedChatRoom("")},window.onfocus=function(){K&&(u.K.getState().setCurrentUntrackedChatRoom(K),u.K.getState().clearCounterChatRoom(K))}}),[K]),(0,i.useEffect)((function(){var e=n.filter((function(e){return e.roomJID===K}));if(!Z&&e.length>0&&e.length<=51&&K&&xe){var t=e[0];e.length>=10&&e.length<15&&t.data.isSystemMessage?(ve(!1),c.ZP.getPaginatedArchive(K,String(t.id),5)):1===e.length&&(ve(!1),c.ZP.getPaginatedArchive(K,String(t.id),50))}}),[n]),(0,z.jsxs)(d.Z,{style:{paddingBlock:"20px",height:"100%"},children:[(0,z.jsxs)(v.tz,{responsive:!0,children:[(0,z.jsxs)(v.YE,{position:"left",scrollable:!1,children:[(0,z.jsx)(v.ol,{placeholder:"Search..."}),(0,z.jsx)(v.p7,{loading:Z,children:j.map((function(e){return(0,z.jsx)(v.ri,{active:e.jid===K,unreadCnt:e.unreadMessages,onClick:function(){return Ze(e.jid)},name:e.name,info:we(e.jid),lastActivityTime:be(e.jid),children:(0,z.jsx)(v.qE,{src:"none"!==e.room_background?e.room_background:"https://icotar.com/initials/"+e.name})},e.jid)}))})]}),(0,z.jsx)("div",(0,a.Z)((0,a.Z)({},ye()),{},{style:{width:"100%",height:"100%"},children:(0,z.jsxs)(v.uU,{children:[!!$&&(0,z.jsxs)(v.BU,{children:[(0,z.jsx)(v.BU.Back,{}),n.filter((function(e){return e.roomJID===K})).length>0&&(0,z.jsx)(v.BU.Content,{userName:$.name,info:"Active "+(0,g.Z)((0,h.Z)(new Date(n.filter((function(e){return e.roomJID===K})).slice(-1)[0].date),0),new Date,{addSuffix:!0})}),(0,z.jsx)(v.BU.Actions,{children:(0,z.jsx)(f.Z,{})})]}),(0,z.jsxs)(v.rN,{loadingMore:Z,onYReachStart:function(){var e=n.filter((function(e){return e.roomJID===K}));if(!Z){var t=e[0].id;c.ZP.getPaginatedArchive(K,String(t),10)}},disableOnYReachWhenNoScroll:!0,typingIndicator:!(null===(e=j.filter((function(e){return e.jid===K}))[0])||void 0===e||!e.composing)&&(0,z.jsx)(v.c2,{style:{opacity:".6"},content:null===(t=j.filter((function(e){return e.jid===K}))[0])||void 0===t?void 0:t.composing}),children:[n.filter((function(e){return e.roomJID===K})).map((function(e,t,n){var i,r,a,o,s=function(e,t,n){var i,r,a,o,s,l,d,c=null===(i=e[n-1])||void 0===i||null===(r=i.data.senderJID)||void 0===r?void 0:r.split("/")[0],u=null===(a=e[n+1])||void 0===a||null===(o=a.data.senderJID)||void 0===o?void 0:o.split("/")[0],m=null===(s=t.data.senderJID)||void 0===s?void 0:s.split("/")[0],f={position:"single",type:"single"};return e[n-1]&&t&&(0,p.Z)(new Date(null===(d=e[n-1])||void 0===d?void 0:d.date),"dd")!==(0,p.Z)(new Date(t.date),"dd")&&(f.separator=(0,p.Z)(new Date(t.date),"EEEE, dd LLLL yyyy")),c!==m&&u!==m?f:c!==m&&u===m?(f.position="first",f.type="first",f):c===m&&u===m?(f.position="normal",f.type="normal",f):c===m&&u!==m&&"false"===(null===(l=e[n-1])||void 0===l?void 0:l.data.isSystemMessage)?(f.position="single",f.type="last",f):f}(n,e,t);return"false"===e.data.isSystemMessage?(0,z.jsx)(E,{is:"Message",position:s,message:e,userJid:null===(i=c.ZP.client)||void 0===i||null===(r=i.jid)||void 0===r?void 0:r.toString(),buttonSender:Se,chooseDirectRoom:Ze},e.id):(0,z.jsx)(_,{is:"Message",message:e,userJid:null===(a=c.ZP.client)||void 0===a||null===(o=a.jid)||void 0===o?void 0:o.toString()},e.id)})),n.length<=0||!K&&(0,z.jsx)(v.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:Z?"Loading...":(0,z.jsx)("span",{children:!K&&"To get started, please select a chat room."})}),!Z&&K&&n.filter((function(e){return e.roomJID===K})).length<=0&&(0,z.jsx)(v.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:"Message list is empty"})]}),!(null===$||void 0===$||!$.name)&&(0,z.jsxs)("div",{is:"MessageInput",children:[(0,z.jsx)(v.Ru,{onPaste:function(e){var t=Array.from(e.clipboardData.items).find((function(e){return/^image\//.test(e.type)}));if(t){var n=t.getAsFile();Ce(n)}},placeholder:"Type message here",onChange:function(e){R(e),c.ZP.isComposing(r.walletAddress,$.jid,r.firstName+" "+r.lastName)},onSend:Se,onAttachClick:function(){return Q.current.click()}}),(0,z.jsx)("input",{type:"file",name:"file",id:"file",onChange:function(e){return Ce(e.target.files[0])},ref:Q,style:{display:"none"}})]})]})}))]}),(0,z.jsxs)(k.Z,{fullScreen:ee,open:ie,onClose:function(){return re(!0)},"aria-labelledby":"responsive-dialog-title",children:[(0,z.jsx)(W.Z,{id:"responsive-dialog-title",children:ue.headline}),(0,z.jsx)(D.Z,{children:se&&ue.description.length>0?(0,z.jsx)(B.Z,{children:ue.description}):(0,z.jsx)(d.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,z.jsx)(O.Z,{})})}),se?(0,z.jsx)(H.Z,{children:(0,z.jsx)(C.Z,{onClick:function(){return re(!1)},autoFocus:!0,children:"Close"})}):null]})]})}function V(){return(0,z.jsx)(r.Z,{maxWidth:"xl",style:{height:"calc(100vh - 68px)"},children:(0,z.jsx)(q,{})})}}}]);
//# sourceMappingURL=657.55420e55.chunk.js.map