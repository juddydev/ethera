"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[657],{23895:function(e,t,n){n.d(t,{c:function(){return l}});var i=n(74165),r=n(15861),o=n(85554),a=n(11210),s=function(e){return e?e.replace(/([A-Z])/g,"_$1").toLowerCase():"invalid string passed"},l=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r,l,d,c){var u,f,m,p,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=[t,n].sort().join("."),f=u.toLowerCase()+d,m=[r,l].sort().join(" and "),p=a.K.getState().userChatRooms,h=!1,0===p.filter((function(e){return e.jid===f})).length&&(h=!0,o.ZP.createNewRoom(u.toLowerCase()),o.ZP.setOwner(u.toLowerCase()),o.ZP.roomConfig(u.toLowerCase(),{roomName:m}),o.ZP.subsribe(f),o.ZP.presenceInRoom(f),setTimeout((function(){o.ZP.sendInvite(s(t),f.toLowerCase(),s(n))}),1e3)),e.abrupt("return",{roomJid:f,roomName:m,isNewRoom:h});case 7:case"end":return e.stop()}}),e)})));return function(t,n,i,r,o,a){return e.apply(this,arguments)}}()},7657:function(e,t,n){n.r(t),n.d(t,{default:function(){return V}});var i=n(72791),r=n(20803),o=n(1413),a=n(74165),s=n(15861),l=n(70885),d=n(50228),c=n(85554),u=n(11210),f=n(57337),m=n(89721),p=n(91482),h=n(95178),g=n(16263),x=n(45586),v=n(31128),j=n(64880),y=n(13811),Z=n(48928),w=n(58487),C=n(30199),S=n(16992),b=n(70324),k=n(60788),N=n(8440),D=n(78473),A=n(4565),I=n(77248),P=n(52898),R=n(23895),J=n(57050),L=n(52791),M=n(80184),K=function(e){var t=e.message,n=e.userJid,r=e.position,o=e.buttonSender,a=e.chooseDirectRoom,s=t.data.senderFirstName,d=t.data.senderLastName,m=t.data.senderJID,K=(0,j.k6)(),E=(0,i.useState)(),T=(0,l.Z)(E,2),U=T[0],F=T[1],z=(0,i.useState)(!1),_=(0,l.Z)(z,2),W=_[0],B=_[1],O=i.useState(null),V=(0,l.Z)(O,2),q=V[0],Y=V[1],H=(0,i.useState)("transfer"),$=(0,l.Z)(H,2),G=$[0],Q=$[1],X=(0,i.useState)(""),ee=(0,l.Z)(X,2),te=ee[0],ne=ee[1],ie=Boolean(q),re=(0,i.useState)(1),oe=(0,l.Z)(re,2),ae=oe[0],se=oe[1],le=(0,u.K)((function(e){return e.balance})).filter((function(e){return!e.tokenType&&e.contractAddress.length>10})),de=(0,u.K)((function(e){return e.user}));(0,u.K)((function(e){return e.loaderArchive}));return(0,i.useEffect)((function(){t.data.quickReplies&&F(JSON.parse(t.data.quickReplies))}),[]),(0,M.jsxs)("div",{is:"Message",children:[r.separator?(0,M.jsx)(v.it,{children:r.separator}):null,(0,M.jsxs)(v.v0,{model:{sender:s+" "+d,direction:String(n).split("/")[0]===String(m).split("/")[0]?"outgoing":"incoming",position:r.position},avatarPosition:String(n).split("/")[0]===String(m).split("/")[0]?"tr":"tl",avatarSpacer:"first"!==r.type&&"single"!==r.type,children:[("first"===r.type||"single"===r.type)&&(0,M.jsx)("img",{style:{borderRadius:"50%",boxSizing:"border-box",width:"42px",height:"42px",cursor:"pointer"},onClick:function(){return K.push("/profile/"+t.data.senderWalletAddress)},is:"Avatar",src:t.data.photoURL?t.data.photoURL:"https://icotar.com/initials/"+s+" "+d,onError:function(e){var t=e.currentTarget;t.onerror=null,t.src="https://icotar.com/initials/"+s+" "+d},alt:s}),(0,M.jsxs)(v.v0.CustomContent,{children:[("first"===r.type||"single"===r.type)&&(0,M.jsxs)("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,M.jsxs)("strong",{style:{cursor:"pointer"},onClick:function(){return K.push("/profile/"+t.data.senderWalletAddress)},children:[s," ",d,(0,M.jsx)("br",{})]}),String(n).split("/")[0]!==String(m).split("/")[0]?(0,M.jsx)(y.Z,{"aria-label":"more",id:"long-button","aria-controls":ie?"long-menu":void 0,"aria-expanded":ie?"true":void 0,"aria-haspopup":"true",onClick:function(e){Y(e.currentTarget)},children:(0,M.jsx)(P.Z,{})}):null]}),t.data.isMediafile&&"image"===t.data.mimetype.split("/")[0]?(0,M.jsx)(Z.Z,{sx:{maxWidth:200},children:(0,M.jsx)(w.Z,{onClick:function(){B(!0),Q("image")},children:(0,M.jsx)(C.Z,{style:{height:150,objectFit:"cover",objectPosition:"left"},component:"img",height:"150",image:t.data.location,alt:t.data.originalName})})}):null,t.data.isMediafile&&"application"===t.data.mimetype.split("/")[0]?(0,M.jsxs)("a",{target:"_blank",href:t.data.location,children:[(0,M.jsx)(v.v0.ImageContent,{src:t.data.locationPreview,alt:t.data.originalName,width:150}),t.data.mimetype.split("/")[1]]}):null,t.data.isMediafile&&"video"===t.data.mimetype.split("/")[0]?(0,M.jsxs)("video",{controls:!0,width:"200px",children:[(0,M.jsx)("source",{src:t.data.location,type:t.data.mimetype,title:t.data.originalName}),"Sorry, your browser doesn't support videos."]}):null,t.data.isMediafile?null:t.body]}),("last"===r.type||"single"===r.type)&&(0,M.jsx)(v.v0.Footer,{sentTime:(0,h.Z)(new Date,new Date(t.date))>5?(0,p.Z)(new Date(t.date),"h:mm:ss a"):(0,g.Z)((0,x.Z)(new Date(t.date),0),new Date,{addSuffix:!0})})]}),U?(0,M.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"max-content",marginLeft:"45px"},children:U.map((function(e,t){return(0,M.jsx)(v.zx,{onClick:function(){return o(e)},border:!0,children:e.name},t)}))}):null,(0,M.jsxs)(S.Z,{id:"basic-menu",anchorEl:q,open:ie,onClose:function(){return Y(null)},MenuListProps:{"aria-labelledby":"basic-button"},anchorOrigin:{vertical:"bottom",horizontal:"center"},children:[(0,M.jsx)(b.Z,{onClick:function(){return e="transfer",Y(null),B(!0),void Q(e);var e},children:"Transfer coins"}),(0,M.jsx)(b.Z,{onClick:function(){(0,R.c)(de.walletAddress,t.data.senderWalletAddress,de.firstName,t.data.senderFirstName,"@conference.dev.dxmpp.com",t.data.senderJID).then((function(e){if(e.isNewRoom){u.K.getState().setLoaderArchive(!0);var t={jid:e.roomJid,name:e.roomName,room_background:"none",room_thumbnail:"none",users_cnt:"2",unreadMessages:0,composing:"",toUpdate:!0};u.K.getState().setNewUserChatRoom(t),console.log("SAVE ROOM TO LIST => ",u.K.getState().userChatRooms),a(e.roomJid),c.ZP.getRooms()}else a(e.roomJid)})).catch((function(e){console.log("openPrivateRoom Error: ",e)}))},children:"Direct message"}),(0,M.jsx)(b.Z,{onClick:function(){return Y(null)},children:"Ban this user"})]}),(0,M.jsxs)(k.Z,{open:W,onClose:function(){return B(!0)},maxWidth:"xl","aria-labelledby":"responsive-dialog-title",children:[(0,M.jsxs)(N.Z,{children:["error"===G?(0,M.jsx)("div",{children:te}):null,"transfer"===G?(0,M.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,M.jsxs)("div",{children:["Reward"," ",(0,M.jsx)("strong",{children:t.data.senderFirstName+" "+t.data.senderLastName})," ","with coins"]}),(0,M.jsx)(D.ZP,{"aria-label":"Coin amount",defaultValue:1,valueLabelDisplay:"auto",step:2,marks:!0,min:1,max:7,value:ae,onChange:function(e,t){return se(t||t[0])},sx:{marginTop:"10px"}}),(0,M.jsxs)(L.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,M.jsx)(A.Z,{sx:{fontWeight:"bold"},children:ae}),(0,M.jsx)("img",{src:J,style:{width:30,height:30},alt:"coin"})]})]}):null,"image"===G?(0,M.jsx)("div",{children:(0,M.jsx)("img",{src:t.data.location,alt:t.data.originalName,style:{maxWidth:"100%"}})}):null]}),(0,M.jsxs)(I.Z,{children:["transfer"===G&&(0,M.jsx)(v.zx,{onClick:function(){(0,f.tZ)("DPT",le[0].tokenName,Number(ae),t.data.senderWalletAddress).then((function(){var e=de.firstName+" "+de.lastName+" -> "+ae+" "+le[0].tokenName+" -> "+t.data.senderFirstName+" "+t.data.senderLastName;c.ZP.sendSystemMessage(t.roomJID,de.firstName,de.lastName,de.walletAddress,e,null,t.id),B(!1)})).catch((function(e){console.log(e),ne("An error occurred during the coin transfer."),Q("error")}))},children:"Send"}),(0,M.jsx)(v.zx,{onClick:function(){return B(!1)},autoFocus:!0,children:"Close"})]})]})]})},E=function(e){var t=e.message;e.userJid;return(0,M.jsx)("div",{style:{textAlign:"center",color:"#6ea9d7",fontSize:".8em",boxSizing:"border-box",fontFamily:"Helvetica Neue,Segoe UI,Helvetica,Arial,sans-serif"},children:t.body},t.key)},T=n(74142),U=n(52797),F=n(40464),z=n(39571),_=n(96580),W=n(17205),B=n(18267);function O(){var e,t,n=(0,u.K)((function(e){return e.historyMessages})),r=(0,u.K)((function(e){return e.user})),y=(0,u.K)((function(e){return e.userChatRooms})),Z=(0,u.K)((function(e){return e.loaderArchive})),w=(0,u.K)((function(e){return e.currentUntrackedChatRoom})),C=(0,i.useState)(),S=(0,l.Z)(C,2),b=S[0],D=S[1],A=(0,i.useState)(""),P=(0,l.Z)(A,2),R=P[0],J=P[1],L=(0,i.useState)(""),O=(0,l.Z)(L,2),V=O[0],q=O[1],Y=(0,i.useState)({jid:"",name:"",room_background:"",room_thumbnail:"",users_cnt:""}),H=(0,l.Z)(Y,2),$=H[0],G=H[1],Q=(0,i.useRef)(null),X=(0,T.Z)(),ee=(0,U.Z)(X.breakpoints.down("md")),te=(0,i.useState)(!1),ne=(0,l.Z)(te,2),ie=ne[0],re=ne[1],oe=(0,i.useState)(!1),ae=(0,l.Z)(oe,2),se=ae[0],le=ae[1],de=(0,i.useState)({headline:"",description:""}),ce=(0,l.Z)(de,2),ue=ce[0],fe=ce[1],me=(0,j.UO)().roomJID,pe=(0,j.k6)(),he=(0,i.useState)(!0),ge=(0,l.Z)(he,2),xe=ge[0],ve=ge[1],je=(0,i.useCallback)((function(e){be(e[0])}),[$]),ye=(0,B.uI)({onDrop:je,noClick:!0,maxFiles:1}).getRootProps;(0,i.useEffect)((function(){(0,f.k2)(r.walletAddress).then((function(e){D(e.data.result)}))}),[]);var Ze=function(e){pe.push("/chat/"+e.split("@")[0]),q(e);var t=y.filter((function(t){return t.jid===e}))[0];G(t),u.K.getState().clearCounterChatRoom(e),u.K.getState().setCurrentUntrackedChatRoom(e);var i=n.filter((function(t){return t.roomJID===e}));if(ve(!0),!Z&&i.length<=10&&i.length>0){var r=i[0].id;c.ZP.getPaginatedArchive(e,String(r),50)}},we=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return Z&&t.length<=0?"Loading...":t.length>0?t[0].body:"No messages yet"},Ce=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return t.length<=0?"":(0,h.Z)(new Date,new Date(t[0].date))>1?(0,p.Z)(new Date(t[0].date),"hh:mm"):(0,g.Z)((0,x.Z)(new Date(t[0].date),0),new Date,{addSuffix:!0})},Se=function(e){var t="";null!==b&&void 0!==b&&b.profileImage&&(t=null===b||void 0===b?void 0:b.profileImage),c.ZP.sendMessage(V,r.firstName,r.lastName,t,r.walletAddress,"object"===typeof e?e.value:R.split("<br>").join("\n"),"object"===typeof e?e.notDisplayedValue:null)},be=function(e){fe({headline:"File is loading, please wait...",description:""}),re(!0);var t=new FormData;t.append("files",e),(0,f.cT)(t).then((function(e){var t="";null!==b&&void 0!==b&&b.profileImage&&(t=null===b||void 0===b?void 0:b.profileImage),e.data.results.map(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(n){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={firstName:r.firstName,lastName:r.lastName,walletAddress:r.walletAddress,chatName:$.name,userAvatar:t,createdAt:n.createdAt,expiresAt:n.expiresAt,fileName:n.filename,isVisible:n.isVisible,location:n.location,locationPreview:n.locationPreview,mimetype:n.mimetype,originalName:n.originalname,ownerKey:n.ownerKey,size:n.size,duration:null===n||void 0===n?void 0:n.duration,updatedAt:n.updatedAt,userId:n.userId,waveForm:"",attachmentId:n._id,wrappable:!0},c.ZP.sendMediaMessageStanza(V,i),re(!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).catch((function(e){console.log(e),fe({headline:"Error",description:"An error occurred while uploading the file"}),le(!0)})),Q.current&&(Q.current.value="")};return(0,i.useEffect)((function(){var e=setTimeout((function(){c.ZP.pausedComposing(r.walletAddress,$.jid)}),1e3);return function(){return clearTimeout(e)}}),[R]),(0,i.useEffect)((function(){if(w&&(me&&"none"!==me&&w.split("@")[0]!==me||Ze(w)),w.split("@")[0]!==me&&"none"!==me){var e=me+"@conference.dev.dxmpp.com";u.K.getState().setCurrentUntrackedChatRoom(e),Ze(e)}window.onblur=function(){u.K.getState().setCurrentUntrackedChatRoom("")},window.onfocus=function(){V&&(u.K.getState().setCurrentUntrackedChatRoom(V),u.K.getState().clearCounterChatRoom(V))}}),[V]),(0,i.useEffect)((function(){var e=n.filter((function(e){return e.roomJID===V}));if(!Z&&e.length>0&&e.length<=51&&V&&xe){var t=e[0];e.length>=10&&e.length<15&&t.data.isSystemMessage?(ve(!1),c.ZP.getPaginatedArchive(V,String(t.id),5)):1===e.length&&(ve(!1),c.ZP.getPaginatedArchive(V,String(t.id),50))}}),[n]),(0,M.jsxs)(d.Z,{style:{paddingBlock:"20px",height:"100%"},children:[(0,M.jsxs)(v.tz,{responsive:!0,children:[(0,M.jsxs)(v.YE,{position:"left",scrollable:!1,children:[(0,M.jsx)(v.ol,{placeholder:"Search..."}),(0,M.jsx)(v.p7,{loading:Z,children:y.map((function(e){return(0,M.jsx)(v.ri,{active:e.jid===V,unreadCnt:e.unreadMessages,onClick:function(){return Ze(e.jid)},name:e.name,info:we(e.jid),lastActivityTime:Ce(e.jid),children:(0,M.jsx)(v.qE,{src:"none"!==e.room_background?e.room_background:"https://icotar.com/initials/"+e.name})},e.jid)}))})]}),(0,M.jsx)("div",(0,o.Z)((0,o.Z)({},ye()),{},{style:{width:"100%",height:"100%"},children:(0,M.jsxs)(v.uU,{children:[!!$&&(0,M.jsxs)(v.BU,{children:[(0,M.jsx)(v.BU.Back,{}),n.filter((function(e){return e.roomJID===V})).length>0&&(0,M.jsx)(v.BU.Content,{userName:$.name,info:"Active "+(0,g.Z)((0,x.Z)(new Date(n.filter((function(e){return e.roomJID===V})).slice(-1)[0].date),0),new Date,{addSuffix:!0})}),(0,M.jsx)(v.BU.Actions,{children:(0,M.jsx)(m.Z,{})})]}),(0,M.jsxs)(v.rN,{loadingMore:Z,onYReachStart:function(){var e=n.filter((function(e){return e.roomJID===V}));if(!Z){var t=e[0].id;c.ZP.getPaginatedArchive(V,String(t),10)}},disableOnYReachWhenNoScroll:!0,typingIndicator:!(null===(e=y.filter((function(e){return e.jid===V}))[0])||void 0===e||!e.composing)&&(0,M.jsx)(v.c2,{content:null===(t=y.filter((function(e){return e.jid===V}))[0])||void 0===t?void 0:t.composing}),children:[n.filter((function(e){return e.roomJID===V})).map((function(e,t,n){var i,r,o,a,s=function(e,t,n){var i,r,o,a,s,l,d=null===(i=e[n-1])||void 0===i||null===(r=i.data.senderJID)||void 0===r?void 0:r.split("/")[0],c=null===(o=e[n+1])||void 0===o||null===(a=o.data.senderJID)||void 0===a?void 0:a.split("/")[0],u=null===(s=t.data.senderJID)||void 0===s?void 0:s.split("/")[0],f={position:"single",type:"single"};return e[n-1]&&t&&(0,p.Z)(new Date(null===(l=e[n-1])||void 0===l?void 0:l.date),"dd")!==(0,p.Z)(new Date(t.date),"dd")&&(f.separator=(0,p.Z)(new Date(t.date),"EEEE, dd LLLL yyyy")),d!==u&&c!==u?f:d!==u&&c===u?(f.position="first",f.type="first",f):d===u&&c===u?(f.position="normal",f.type="normal",f):d===u&&c!==u?(f.position="single",f.type="last",f):f}(n,e,t);return"false"===e.data.isSystemMessage?(0,M.jsx)(K,{is:"Message",position:s,message:e,userJid:null===(i=c.ZP.client)||void 0===i||null===(r=i.jid)||void 0===r?void 0:r.toString(),buttonSender:Se,chooseDirectRoom:Ze},e.id):(0,M.jsx)(E,{is:"Message",message:e,userJid:null===(o=c.ZP.client)||void 0===o||null===(a=o.jid)||void 0===a?void 0:a.toString()},e.id)})),n.length<=0||!V&&(0,M.jsx)(v.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:Z?"Loading...":(0,M.jsx)("span",{children:!V&&"To get started, please select a chat room."})}),!Z&&V&&n.filter((function(e){return e.roomJID===V})).length<=0&&(0,M.jsx)(v.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:"Message list is empty"})]}),!!$&&(0,M.jsxs)("div",{is:"MessageInput",children:[(0,M.jsx)(v.Ru,{onPaste:function(e){var t=Array.from(e.clipboardData.items).find((function(e){return/^image\//.test(e.type)}));if(t){var n=t.getAsFile();be(n)}},placeholder:"Type message here",onChange:function(e){J(e),c.ZP.isComposing(r.walletAddress,$.jid,r.firstName+" "+r.lastName)},onSend:Se,onAttachClick:function(){return Q.current.click()}}),(0,M.jsx)("input",{type:"file",name:"file",id:"file",onChange:function(e){return be(e.target.files[0])},ref:Q,style:{display:"none"}})]})]})}))]}),(0,M.jsxs)(k.Z,{fullScreen:ee,open:ie,onClose:function(){return re(!0)},"aria-labelledby":"responsive-dialog-title",children:[(0,M.jsx)(F.Z,{id:"responsive-dialog-title",children:ue.headline}),(0,M.jsx)(N.Z,{children:se&&ue.description.length>0?(0,M.jsx)(z.Z,{children:ue.description}):(0,M.jsx)(d.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,M.jsx)(_.Z,{})})}),se?(0,M.jsx)(I.Z,{children:(0,M.jsx)(W.Z,{onClick:function(){return re(!1)},autoFocus:!0,children:"Close"})}):null]})]})}function V(){return(0,M.jsx)(r.Z,{maxWidth:"xl",style:{height:"calc(100vh - 68px)"},children:(0,M.jsx)(O,{})})}}}]);
//# sourceMappingURL=657.7a9ff64e.chunk.js.map