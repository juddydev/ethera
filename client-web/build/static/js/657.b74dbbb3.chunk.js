"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[657],{7657:function(e,t,n){n.r(t),n.d(t,{default:function(){return S}});var i=n(72791),r=n(57020),o=n(50228),s=n(16090),a=n(79271),l=n(70885),d=n(85554),u=n(57337),c=n(89721),f=n(91482),m=n(95178),p=n(16263),g=n(45586),h=n(31128),x=n(80184),v=function(e){var t=e.message,n=e.userJid,r=e.position,o=e.buttonSender,s=t.data.senderFirstName,d=t.data.senderLastName,u=t.data.senderJID,c=(0,a.k6)(),v=(0,i.useState)(),j=(0,l.Z)(v,2),y=j[0],S=j[1];return(0,i.useEffect)((function(){t.data.quickReplies&&S(JSON.parse(t.data.quickReplies))}),[]),(0,x.jsxs)("div",{is:"Message",children:[r.separator?(0,x.jsx)(h.it,{children:r.separator}):null,(0,x.jsxs)(h.v0,{model:{sender:s+" "+d,direction:String(n).split("/")[0]===String(u).split("/")[0]?"outgoing":"incoming",position:r.position},avatarPosition:String(n).split("/")[0]===String(u).split("/")[0]?"tr":"tl",avatarSpacer:"first"!==r.type&&"single"!==r.type,children:[("first"===r.type||"single"===r.type)&&(0,x.jsx)("img",{style:{borderRadius:"50%",boxSizing:"border-box",width:"42px",height:"42px",cursor:"pointer"},onClick:function(){return c.push("/profile/"+t.data.senderWalletAddress)},is:"Avatar",src:t.data.photoURL,onError:function(e){var t=e.currentTarget;t.onerror=null,t.src="https://icotar.com/initials/"+s+" "+d},alt:s}),(0,x.jsxs)(h.v0.CustomContent,{children:[("first"===r.type||"single"===r.type)&&(0,x.jsxs)("strong",{style:{cursor:"pointer"},onClick:function(){return c.push("/profile/"+t.data.senderWalletAddress)},children:[s," ",d,(0,x.jsx)("br",{})]}),t.data.isMediafile&&"image"===t.data.mimetype.split("/")[0]?(0,x.jsx)(h.v0.ImageContent,{src:t.data.location,alt:t.data.originalName,width:200}):null,t.data.isMediafile&&"video"===t.data.mimetype.split("/")[0]?(0,x.jsxs)("video",{controls:!0,width:"200px",children:[(0,x.jsx)("source",{src:t.data.location,type:t.data.mimetype,title:t.data.originalName}),"Sorry, your browser doesn't support videos."]}):null,t.data.isMediafile?null:t.body]}),("last"===r.type||"single"===r.type)&&(0,x.jsx)(h.v0.Footer,{sentTime:(0,m.Z)(new Date,new Date(t.date))>5?(0,f.Z)(new Date(t.date),"h:mm:ss a"):(0,p.Z)((0,g.Z)(new Date(t.date),0),new Date,{addSuffix:!0})})]},t.key),y?(0,x.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"max-content",marginLeft:"45px"},children:y.map((function(e,t){return(0,x.jsx)(h.zx,{onClick:function(){return o(e)},border:!0,children:e.name},t)}))}):null]})},j=function(e){var t=e.message;e.userJid;return(0,x.jsx)("div",{style:{textAlign:"center",color:"#6ea9d7",fontSize:".8em",boxSizing:"border-box",fontFamily:"Helvetica Neue,Segoe UI,Helvetica,Arial,sans-serif"},children:t.body},t.key)};function y(){var e,t,n=(0,s.K)((function(e){return e.historyMessages})),r=(0,s.K)((function(e){return e.user})),a=(0,s.K)((function(e){return e.userChatRooms})),y=(0,s.K)((function(e){return e.loaderArchive})),S=(0,s.K)((function(e){return e.currentUntrackedChatRoom})),w=(0,i.useState)(),C=(0,l.Z)(w,2),D=C[0],Z=C[1],b=(0,i.useState)(""),k=(0,l.Z)(b,2),A=k[0],I=k[1],J=(0,i.useState)(""),N=(0,l.Z)(J,2),R=N[0],E=N[1],K=(0,i.useState)({jid:"",name:"",room_background:"",room_thumbnail:"",users_cnt:""}),M=(0,l.Z)(K,2),U=M[0],P=M[1];(0,i.useEffect)((function(){(0,u.k2)(r.walletAddress).then((function(e){Z(e.data.result)}))}),[]);var L=function(e){E(e),P(a.filter((function(t){return t.jid===e}))[0]),s.K.getState().clearCounterChatRoom(e),s.K.getState().setCurrentUntrackedChatRoom(e);var t=n.filter((function(t){return t.roomJID===e}));if(!y&&t.length<=10&&t.length>0){var i=t[0].id;d.ZP.getPaginatedArchive(e,String(i),10)}},z=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return y&&t.length<=0?"Loading...":t.length>0?t[0].body:"No messages yet"},T=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return t.length<=0?"":(0,m.Z)(new Date,new Date(t[0].date))>1?(0,f.Z)(new Date(t[0].date),"hh:mm"):(0,p.Z)((0,g.Z)(new Date(t[0].date),0),new Date,{addSuffix:!0})},_=function(e){var t="";null!==D&&void 0!==D&&D.profileImage&&(t=null===D||void 0===D?void 0:D.profileImage),d.ZP.sendMessage(R,r.firstName,r.lastName,t,r.walletAddress,"object"===typeof e?e.value:A,"object"===typeof e?e.notDisplayedValue:null)};return(0,i.useEffect)((function(){var e=setTimeout((function(){d.ZP.pausedComposing(r.walletAddress,U.jid)}),1e3);return function(){return clearTimeout(e)}}),[A]),(0,i.useEffect)((function(){S&&L(S),window.onblur=function(){s.K.getState().setCurrentUntrackedChatRoom("")},window.onfocus=function(){R&&(s.K.getState().setCurrentUntrackedChatRoom(R),s.K.getState().clearCounterChatRoom(R))}}),[R]),(0,x.jsx)(o.Z,{style:{height:"500px"},children:(0,x.jsxs)(h.tz,{responsive:!0,children:[(0,x.jsxs)(h.YE,{position:"left",scrollable:!1,children:[(0,x.jsx)(h.ol,{placeholder:"Search..."}),(0,x.jsx)(h.p7,{loading:y,children:a.map((function(e){return(0,x.jsx)(h.ri,{active:e.jid===R,unreadCnt:e.unreadMessages,onClick:function(){return L(e.jid)},name:e.name,info:z(e.jid),lastActivityTime:T(e.jid),children:(0,x.jsx)(h.qE,{src:"none"!==e.room_background?e.room_background:"https://icotar.com/initials/"+e.name})},e.jid)}))})]}),(0,x.jsxs)(h.uU,{children:[!!U.name&&(0,x.jsxs)(h.BU,{children:[(0,x.jsx)(h.BU.Back,{}),n.filter((function(e){return e.roomJID===R})).length>0&&(0,x.jsx)(h.BU.Content,{userName:U.name,info:"Active "+(0,p.Z)((0,g.Z)(new Date(n.filter((function(e){return e.roomJID===R})).slice(-1)[0].date),0),new Date,{addSuffix:!0})}),(0,x.jsx)(h.BU.Actions,{children:(0,x.jsx)(c.Z,{})})]}),(0,x.jsxs)(h.rN,{loadingMore:y,onYReachStart:function(){if(!y){var e=n.filter((function(e){return e.roomJID===R}))[0].id;d.ZP.getPaginatedArchive(R,String(e),10)}},typingIndicator:!(null===(e=a.filter((function(e){return e.jid===R}))[0])||void 0===e||!e.composing)&&(0,x.jsx)(h.c2,{content:null===(t=a.filter((function(e){return e.jid===R}))[0])||void 0===t?void 0:t.composing}),children:[n.filter((function(e){return e.roomJID===R})).map((function(e,t,n){var i,r,o,s,a=function(e,t,n){var i,r,o,s,a,l,d=null===(i=e[n-1])||void 0===i||null===(r=i.data.senderJID)||void 0===r?void 0:r.split("/")[0],u=null===(o=e[n+1])||void 0===o||null===(s=o.data.senderJID)||void 0===s?void 0:s.split("/")[0],c=null===(a=t.data.senderJID)||void 0===a?void 0:a.split("/")[0],m={position:"single",type:"single"};return e[n-1]&&t&&(0,f.Z)(new Date(null===(l=e[n-1])||void 0===l?void 0:l.date),"dd")!==(0,f.Z)(new Date(t.date),"dd")&&(m.separator=(0,f.Z)(new Date(t.date),"EEEE, dd LLLL yyyy")),d!==c&&u!==c?m:d!==c&&u===c?(m.position="first",m.type="first",m):d===c&&u===c?(m.position="normal",m.type="normal",m):d===c&&u!==c?(m.position="single",m.type="last",m):m}(n,e,t);return"false"===e.data.isSystemMessage?(0,x.jsx)(v,{is:"Message",position:a,message:e,userJid:null===(i=d.ZP.client)||void 0===i||null===(r=i.jid)||void 0===r?void 0:r.toString(),buttonSender:_},e.id):(0,x.jsx)(j,{is:"Message",message:e,userJid:null===(o=d.ZP.client)||void 0===o||null===(s=o.jid)||void 0===s?void 0:s.toString()})})),n.length<=0||!R&&(0,x.jsx)(h.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:y?"Loading...":(0,x.jsx)("span",{children:!R&&"To get started, please select a chat room."})}),!y&&R&&n.filter((function(e){return e.roomJID===R})).length<=0&&(0,x.jsx)(h.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:"Message list is empty"})]}),!!U.name&&(0,x.jsx)(h.Ru,{placeholder:"Type message here",onChange:function(e){I(e),d.ZP.isComposing(r.walletAddress,U.jid,r.firstName+" "+r.lastName)},onSend:_})]})]})})}function S(){var e=(0,s.K)((function(e){return e.user})),t=(0,s.K)((function(e){return e.messages})),n=(0,a.k6)();return(0,i.useEffect)((function(){e.firstName||n.push("/")}),[e.firstName,n]),(0,x.jsxs)(r.Z,{maxWidth:"xl",style:{height:"calc(100vh - 68px)"},children:[(0,x.jsx)(o.Z,{children:"Chat"}),(0,x.jsx)(o.Z,{children:t.length}),(0,x.jsx)(y,{})]})}}}]);
//# sourceMappingURL=657.b74dbbb3.chunk.js.map