"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[463],{23895:function(e,t,n){n.d(t,{c:function(){return l}});var i=n(74165),r=n(15861),o=n(85554),s=n(11210),a=function(e){return e?e.replace(/([A-Z])/g,"_$1").toLowerCase():"invalid string passed"},l=function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r,l,c,d){var u,m,f,p,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=[t,n].sort().join("."),m=u.toLowerCase()+c,f=[r,l].sort().join(" and "),p=s.K.getState().userChatRooms,h=!1,0===p.filter((function(e){return e.jid===m})).length&&(h=!0,o.ZP.createNewRoom(u.toLowerCase()),o.ZP.setOwner(u.toLowerCase()),o.ZP.roomConfig(u.toLowerCase(),{roomName:f}),o.ZP.subsribe(m),o.ZP.presenceInRoom(m),setTimeout((function(){o.ZP.sendInvite(a(t),m.toLowerCase(),a(n))}),1e3)),e.abrupt("return",{roomJid:m,roomName:f,isNewRoom:h});case 7:case"end":return e.stop()}}),e)})));return function(t,n,i,r,o,s){return e.apply(this,arguments)}}()},3463:function(e,t,n){n.r(t),n.d(t,{default:function(){return he}});var i,r=n(72791),o=n(20803),s=n(1413),a=n(74165),l=n(15861),c=n(70885),d=n(50228),u=n(85554),m=n(11210),f=n(47409),p=n(91482),h=n(16263),g=n(45586),x=n(78703),v=n(31128),j=n(95178),y=n(64880),Z=n(13811),w=n(48928),b=n(58487),k=n(30199),C=n(17205),S=n(60788),N=n(8440),I=n(4565),D=n(81872),A=n(59911),R=n(52898),L=n(23895),M=n(57050),P=n(52791),J=n(21686),K=n(64558),z=n(68438),E=n(80184),T=function(e){var t=e.message,n=e.userJid,i=e.position,o=e.buttonSender,s=e.chooseDirectRoom,a=t.data.senderFirstName,l=t.data.senderLastName,d=t.data.senderJID,x=(0,y.k6)(),T=(0,r.useState)(),U=(0,c.Z)(T,2),_=U[0],F=U[1],W=(0,r.useState)(!1),B=(0,c.Z)(W,2),O=B[0],H=B[1],V=r.useState(null),Y=(0,c.Z)(V,2),$=Y[0],q=Y[1],G=(0,r.useState)("dialog"),Q=(0,c.Z)(G,2),X=Q[0],ee=Q[1],te=(0,r.useState)(""),ne=(0,c.Z)(te,2),ie=ne[0],re=ne[1],oe=Boolean($),se=(0,r.useState)(1),ae=(0,c.Z)(se,2),le=ae[0],ce=ae[1],de=(0,m.K)((function(e){return e.balance})).filter((function(e){return!e.tokenType&&e.contractAddress.length>10})),ue=(0,m.K)((function(e){return e.user})),me=(0,r.useState)("incoming"),fe=(0,c.Z)(me,2),pe=fe[0],he=fe[1],ge=function(e){q(null),H(!0),ee(e)},xe=function(e){var n=Number(e||le);(0,f.tZ)("DPT",de[0].tokenName,n,t.data.senderWalletAddress).then((function(e){var i=de[0].tokenName===z.zl?z.w5:de[0].tokenName,r=ue.firstName+" "+ue.lastName,o=t.data.senderFirstName+" "+t.data.senderLastName,s="".concat(r," -> ").concat(le," ").concat(i," -> ").concat(o);u.ZP.sendSystemMessage(t.roomJID,ue.firstName,ue.lastName,ue.walletAddress,s,n,t.id),H(!1)})).catch((function(e){console.log(e),re("An error occurred during the coin transfer."),ee("error")}))},ve=function(e){"clarify"===e&&(re("Are you sure you want to block the user?"),ee("clarification")),"block"===e&&(u.ZP.blacklistUser(t.data.senderJID),u.ZP.getBlackList(),m.K.getState().removeAllInMessageHistory(t.data.senderJID),H(!1))};return(0,r.useEffect)((function(){t.data.quickReplies&&F(JSON.parse(t.data.quickReplies)),he(String(n).split("/")[0]===String(d).split("/")[0]?"outgoing":"incoming")}),[]),(0,E.jsxs)("div",{is:"Message",children:[i.separator?(0,E.jsx)(v.it,{children:i.separator}):null,(0,E.jsxs)(v.v0,{onContextMenu:"incoming"===pe?function(e){e.preventDefault(),ge("dialog")}:null,style:{marginBottom:"last"===i.type||"single"===i.type?15:null},model:{sender:a+" "+l,direction:pe,position:i.position},avatarPosition:String(n).split("/")[0]===String(d).split("/")[0]?"tr":"tl",avatarSpacer:"first"!==i.type&&"single"!==i.type,children:[("first"===i.type||"single"===i.type)&&(0,E.jsx)("img",{style:{borderRadius:"50%",boxSizing:"border-box",width:"42px",height:"42px",cursor:"pointer"},onClick:function(){return x.push("/profile/"+t.data.senderWalletAddress)},is:"Avatar",src:t.data.photoURL?t.data.photoURL:"https://icotar.com/initials/"+a+" "+l,onError:function(e){var t=e.currentTarget;t.onerror=null,t.src="https://icotar.com/initials/"+a+" "+l},alt:a}),(0,E.jsxs)(v.v0.CustomContent,{children:[("first"===i.type||"single"===i.type)&&(0,E.jsxs)("span",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,E.jsxs)("strong",{style:{cursor:"pointer"},onClick:function(){return x.push("/profile/"+t.data.senderWalletAddress)},children:[a," ",l,(0,E.jsx)("br",{})]}),String(n).split("/")[0]!==String(d).split("/")[0]?(0,E.jsx)(Z.Z,{"aria-label":"more",id:"long-button","aria-controls":oe?"long-menu":void 0,"aria-expanded":oe?"true":void 0,"aria-haspopup":"true",onClick:function(){return ge("dialog")},children:(0,E.jsx)(R.Z,{})}):null]}),t.data.isMediafile&&"image"===t.data.mimetype.split("/")[0]?(0,E.jsx)(w.Z,{sx:{maxWidth:200},children:(0,E.jsx)(b.Z,{onClick:function(){H(!0),ee("image")},children:(0,E.jsx)(k.Z,{style:{height:150,objectFit:"cover",objectPosition:"left"},component:"img",height:"150",image:t.data.location,alt:t.data.originalName})})}):null,t.data.isMediafile&&"application"===t.data.mimetype.split("/")[0]?(0,E.jsxs)("a",{target:"_blank",href:t.data.location,children:[(0,E.jsx)(v.v0.ImageContent,{src:t.data.locationPreview,alt:t.data.originalName,width:150}),t.data.mimetype.split("/")[1]]}):null,t.data.isMediafile&&"video"===t.data.mimetype.split("/")[0]?(0,E.jsxs)("video",{controls:!0,width:"200px",children:[(0,E.jsx)("source",{src:t.data.location,type:t.data.mimetype,title:t.data.originalName}),"Sorry, your browser doesn't support videos."]}):null,t.data.isMediafile&&"audio"===t.data.mimetype.split("/")[0]?(0,E.jsxs)("audio",{controls:!0,children:[(0,E.jsx)("source",{src:t.data.location,type:t.data.mimetype}),"Your browser does not support the audio element."]}):null,t.data.isMediafile?null:(0,E.jsxs)("div",{children:[(0,E.jsx)("span",{dangerouslySetInnerHTML:{__html:t.body.replace(/\b(https?\:\/\/\S+)/gm,'<a href="$1">$1</a>')}}),(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:5,minWidth:200,color:"incoming"===pe?"rgb(110, 169, 215)":"#c6e3fa",flexDirection:"incoming"===pe?"row":"row-reverse"},children:[(0,E.jsx)("div",{style:{fontSize:12},children:(0,j.Z)(new Date,new Date(t.date))>5?(0,p.Z)(new Date(t.date),"h:mm a"):(0,h.Z)((0,g.Z)(new Date(t.date),0),new Date,{addSuffix:!0})}),t.coinsInMessage>0?(0,E.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,E.jsx)("div",{style:{fontSize:12},children:null===t||void 0===t?void 0:t.coinsInMessage}),(0,E.jsx)("img",{src:M,style:{width:25,height:25},alt:"coin"})]}):null]})]})]})]}),_?(0,E.jsx)(P.Z,{sx:{"& button":{m:.5}},children:(0,E.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"max-content",marginLeft:"45px"},children:_.map((function(e,t){return(0,E.jsx)(C.Z,{variant:"outlined",size:"small",onClick:function(){return o(e)},children:e.name},t)}))})}):null,(0,E.jsx)(S.Z,{open:O,onClose:function(){return H(!1)},maxWidth:"xl",children:(0,E.jsxs)(N.Z,{children:["error"===X?(0,E.jsx)("div",{children:ie}):null,"clarification"===X?(0,E.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[ie,(0,E.jsx)(C.Z,{onClick:function(){return ve("block")},variant:"outlined",size:"small",children:"To block list"})]}):null,"dialog"===X?(0,E.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,E.jsxs)("div",{children:["Reward"," ",(0,E.jsx)("strong",{children:t.data.senderFirstName+" "+t.data.senderLastName})," ","with coins"]}),(0,E.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",margin:"10px 0px 10px 0px"},children:[1,3,5,"x"].map((function(e){return(0,E.jsxs)("div",{style:{textAlign:"center",cursor:"pointer"},onClick:function(){"number"===typeof e?xe(e):ee("transfer")},children:[(0,E.jsx)("img",{src:M,style:{width:25,height:25},alt:"coin"}),(0,E.jsx)(I.Z,{sx:{fontWeight:"bold"},children:e})]},e)}))}),(0,E.jsx)(D.Z,{style:{margin:"10px"}}),(0,E.jsx)(C.Z,{onClick:function(){(0,L.c)(ue.walletAddress,t.data.senderWalletAddress,ue.firstName,t.data.senderFirstName,"@conference.dev.dxmpp.com",t.data.senderJID).then((function(e){if(e.isNewRoom){var t={jid:e.roomJid,name:e.roomName,room_background:"none",room_thumbnail:"none",users_cnt:"2",unreadMessages:0,composing:"",toUpdate:!0,description:""};m.K.getState().setNewUserChatRoom(t),s(e.roomJid)}else s(e.roomJid)})).catch((function(e){console.log("openPrivateRoom Error: ",e)}))},variant:"outlined",startIcon:(0,E.jsx)(J.Z,{}),children:"Direct message"}),(0,E.jsx)(D.Z,{style:{margin:"10px"}}),(0,E.jsx)(C.Z,{onClick:function(){return ve("clarify")},variant:"contained",startIcon:(0,E.jsx)(K.Z,{}),children:"Block this user"}),(0,E.jsx)(I.Z,{style:{textAlign:"center"},variant:"caption",display:"block",gutterBottom:!0,children:"Stop seeing this user."})]}):null,"transfer"===X?(0,E.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,E.jsx)(A.Z,{id:"standard-basic",type:"number",label:"Enter transfer amount",variant:"standard",onChange:function(e){return ce(Number(e.target.value))}}),(0,E.jsx)(C.Z,{style:{marginTop:10},onClick:function(){return xe()},variant:"outlined",size:"small",children:"Send coins"})]}):null,"image"===X?(0,E.jsx)("div",{children:(0,E.jsx)("img",{src:t.data.location,alt:t.data.originalName,style:{maxWidth:"100%"}})}):null]})})]})},U=function(e){var t=e.message;e.userJid;return(0,E.jsx)("div",{style:{textAlign:"center",color:"#6ea9d7",fontSize:".8em",boxSizing:"border-box",fontFamily:"Helvetica Neue,Segoe UI,Helvetica,Arial,sans-serif"},children:t.body},t.key)},_=n(74142),F=n(52797),W=n(40464),B=n(39571),O=n(96580),H=n(77248),V=n(18267),Y=n(4942),$=n(73763),q="/chat/",G=function(e){var t=e.room,n=e.name,i=e.chatId,r=e.setDirection,o=(0,y.k6)();return t?(0,E.jsx)(d.Z,{justifyContent:"center",alignItems:"center",style:{padding:"10px 0",maxWidth:170},children:(0,E.jsx)(C.Z,{onClick:function(){r(),o.push(q+t.roomJid+$.Ts)},children:n})}):(0,E.jsx)(d.Z,{justifyContent:"center",alignItems:"center",style:{padding:"10px 0"},children:(0,E.jsx)(C.Z,{disabled:!i,onClick:function(){r(),o.push(q+"none")},children:"Empty"})})},Q=n(91803),X=function(e){var t=e.room,n=e.direction,i=e.previousRoom,r=(0,y.k6)();return null!==t&&void 0!==t&&t.name?(0,E.jsxs)(d.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,E.jsx)(I.Z,{sx:{fontWeight:"bold",fontSize:18},children:t.name}),(0,E.jsx)(I.Z,{children:t.description})]}):(0,E.jsxs)(d.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,E.jsxs)(d.Z,{sx:{alignItems:"center",display:"flex"},children:[(0,E.jsxs)(I.Z,{children:["This space is empty. You can build your own room here for"," ",(0,E.jsx)("b",{children:"120 "})]}),(0,E.jsx)("img",{src:M,style:{width:20,height:20},alt:"coin"})]}),(0,E.jsx)(C.Z,{onClick:function(){r.push("/newchat",{metaDirection:n,metaRoom:i})},children:"Create Meta Room"})]})},ee=n(84094),te="north",ne="west",ie="south",re="east",oe={north:"n",west:"w",south:"s",east:"e"},se=(i={},(0,Y.Z)(i,ne,re),(0,Y.Z)(i,re,ne),(0,Y.Z)(i,ie,te),(0,Y.Z)(i,te,ie),i),ae={name:"",description:"",ownerNavLinks:{west:null,east:null,north:null,south:null},ownerId:"",contractAddress:"",createdAt:new Date,_id:"",roomJid:"",updatedAt:new Date,userNavLinks:{west:null,east:null,north:null,south:null}},le={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",p:2,outline:"none"},ce=function(e){var t=e.chatId,n=e.open,i=e.onClose,o=(0,r.useState)(""),s=(0,c.Z)(o,2),p=s[0],h=s[1],g=(0,r.useState)(!1),x=(0,c.Z)(g,2),v=x[0],j=x[1],y=(0,r.useState)(),w=(0,c.Z)(y,2),b=w[0],k=w[1],C=(0,r.useState)(ae),S=(0,c.Z)(C,2),N=S[0],I=S[1],D=(0,m.K)((function(e){return e.user})),A=(0,_.Z)(),R=function(){var e=(0,l.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j(!0),e.prev=1,e.next=4,(0,f.Vy)().get("/room/getRoom/"+t);case 4:n=e.sent,I(n.data.result),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),I(ae),console.log(e.t0);case 12:j(!1);case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){t||I(ae),t&&R()}),[t]);var L=function(e,t,n){var i=(0,u.$I)(D.walletAddress),r=D.firstName+" "+D.lastName+" has joined <-",o=D.firstName+" "+D.lastName+" has left ->",s={senderFirstName:D.firstName,senderLastName:D.lastName,senderWalletAddress:D.walletAddress,isSystemMessage:!0,tokenAmount:0,receiverMessageId:"",mucname:e,photoURL:D.profileImage,roomJid:t,isReply:!1,mainMessageText:"",mainMessageId:"",mainMessageUserName:""};u.ZP.sendMessageStanza(i+$.yK,t,n?o:r,s)},M=function(){var e=(0,l.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,f.Vy)().post("/room/join/"+t,{});case 3:n=e.sent,console.log(n.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();if((0,r.useEffect)((function(){null!==b&&void 0!==b&&b.name&&L(b.name,b.roomJid+$.Ts,!0)}),[b]),(0,r.useEffect)((function(){N.name&&(L(N.name,N.roomJid+$.Ts,!1),M())}),[N]),!N.roomJid&&!p)return null;var P=function(e){var n,i,r,o,s=function(e){return se[e]}(p);return function(){var e,t,n,i,r,o,s,a;return!(null!==N&&void 0!==N&&null!==(e=N.ownerNavLinks)&&void 0!==e&&e.south)&&!(null!==N&&void 0!==N&&null!==(t=N.ownerNavLinks)&&void 0!==t&&t.east)&&!(null!==N&&void 0!==N&&null!==(n=N.ownerNavLinks)&&void 0!==n&&n.west)&&!(null!==N&&void 0!==N&&null!==(i=N.ownerNavLinks)&&void 0!==i&&i.north)&&!(null!==N&&void 0!==N&&null!==(r=N.userNavLinks)&&void 0!==r&&r.south)&&!(null!==N&&void 0!==N&&null!==(o=N.userNavLinks)&&void 0!==o&&o.east)&&!(null!==N&&void 0!==N&&null!==(s=N.userNavLinks)&&void 0!==s&&s.west)&&!(null!==N&&void 0!==N&&null!==(a=N.userNavLinks)&&void 0!==a&&a.north)}()&&e===s?(0,E.jsx)(G,{name:s+":"+(null===b||void 0===b?void 0:b.name),chatId:t,room:b,setDirection:function(){h(s),k(b)}}):(0,E.jsx)(G,{name:oe[e]+":"+((null===(n=N.ownerNavLinks[e])||void 0===n?void 0:n.name)||(null===(i=N.userNavLinks[e])||void 0===i?void 0:i.name)),chatId:t,room:(null===N||void 0===N||null===(r=N.ownerNavLinks)||void 0===r?void 0:r[e])||(null===N||void 0===N||null===(o=N.userNavLinks)||void 0===o?void 0:o[e]),setDirection:function(){h(e),k(N)}})};return(0,E.jsx)(Q.Z,{open:n,onClose:i,children:(0,E.jsx)(d.Z,{sx:le,children:v?(0,E.jsx)(O.Z,{size:50}):(0,E.jsxs)(d.Z,{children:[(0,E.jsx)(d.Z,{sx:{bgcolor:"white",mb:"10px",borderRadius:"10px",p:2},children:(0,E.jsx)(X,{room:N,direction:p,previousRoom:b})}),(0,E.jsxs)(d.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",bgcolor:"white",borderRadius:"10px",p:2},children:[P(te),(0,E.jsxs)(d.Z,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",alignItems:"center",justifyContent:"center"},children:[(0,E.jsx)(d.Z,{sx:{display:"flex"},children:P(ne)}),(0,E.jsx)(d.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,E.jsx)(Z.Z,{sx:{color:A.palette.primary.main},children:(0,E.jsx)(ee.Z,{fontSize:"large"})})}),(0,E.jsx)(d.Z,{sx:{display:"flex"},children:P(re)})]}),P(ie)]})]})})})},de=n(61102),ue=n(14250),me=n(24177),fe=function(e,t){if(t===z.hx.official||t===z.hx.favourite){for(var n=function(e){return e.filter((function(e){var t,n=null===e||void 0===e||null===(t=e.jid)||void 0===t?void 0:t.split("@")[0];return z.Ey[n]}))}(e),i=[],r=m.K.getState().userChatRoomGroups,o=function(t){var n=r[t],o=e.filter((function(e){return e.jid===n.jid&&n.group===z.hx.official}));o[0]&&i.push(o[0])},s=0;s<r.length;++s)o(s);return i.concat(n)}return e};function pe(){var e,t,n=(0,m.K)((function(e){return e.historyMessages})),i=(0,m.K)((function(e){return e.user})),o=(0,m.K)((function(e){return e.userChatRooms})),j=(0,m.K)((function(e){return e.loaderArchive})),w=(0,m.K)((function(e){return e.currentUntrackedChatRoom})),b=(0,r.useState)(),k=(0,c.Z)(b,2),I=k[0],D=k[1],A=(0,r.useState)(""),R=(0,c.Z)(A,2),L=R[0],M=R[1],P=(0,r.useState)(!0),J=(0,c.Z)(P,2),K=J[0],Y=J[1],$=(0,r.useState)(""),q=(0,c.Z)($,2),G=q[0],Q=q[1],X=(0,r.useMemo)((function(){return o.find((function(e){return e.jid===G}))}),[o,G]),ee=(0,r.useState)({jid:"",name:"",room_background:"",room_thumbnail:"",users_cnt:""}),te=(0,c.Z)(ee,2),ne=te[0],ie=te[1],re=(0,r.useRef)(null),oe=(0,_.Z)(),se=(0,F.Z)(oe.breakpoints.down("md")),ae=(0,r.useState)(!1),le=(0,c.Z)(ae,2),pe=le[0],he=le[1],ge=(0,r.useState)(!1),xe=(0,c.Z)(ge,2),ve=xe[0],je=xe[1],ye=(0,r.useState)(!1),Ze=(0,c.Z)(ye,2),we=Ze[0],be=Ze[1],ke=(0,r.useState)({headline:"",description:""}),Ce=(0,c.Z)(ke,2),Se=Ce[0],Ne=Ce[1],Ie=(0,y.UO)().roomJID,De=(0,y.k6)(),Ae=(0,r.useState)(!0),Re=(0,c.Z)(Ae,2),Le=Re[0],Me=Re[1],Pe=(0,m.K)((function(e){return e.activeRoomFilter})),Je=(0,m.K)((function(e){return e.setActiveRoomFilter})),Ke=Pe===z.hx.meta,ze=(0,r.useCallback)((function(e){Be(e[0])}),[ne]),Ee=(0,V.uI)({onDrop:ze,noClick:!0,maxFiles:1}).getRootProps;(0,r.useEffect)((function(){Ie&&(Ue(Ie),Y(!0))}),[Ie]),(0,r.useEffect)((function(){(0,f.k2)(i.walletAddress).then((function(e){D(e.data.result)}))}),[]);var Te=function(e){De.push("/chat/"+e.split("@")[0]),Ue(e)},Ue=function(e){Q(e);var t=o.filter((function(t){return t.jid===e}))[0];ie(t),m.K.getState().clearCounterChatRoom(e),m.K.getState().setCurrentUntrackedChatRoom(e);var i=n.filter((function(t){return t.roomJID===e}));if(Me(!0),!j&&i.length<=10&&i.length>0){var r=i[0].id;u.ZP.getPaginatedArchive(e,String(r),50)}},_e=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return j&&t.length<=0?"Loading...":t.length>0?t[0].body:"No messages yet"},Fe=function(e){var t=n.filter((function(t){return t.roomJID===e})).slice(-1);return t.length<=0?"":(0,p.Z)(new Date(t[0].date),"H:mm")},We=function(e){if(L.trim().length>0){var t="";null!==I&&void 0!==I&&I.profileImage&&(t=null===I||void 0===I?void 0:I.profileImage);var n=function(e){var t=e;return(0===(t=(t=(t=t.replace(/<br>/gi,"\n")).replace(/<p.*>/gi,"\n")).replace(/<(?:.|\s)*?>/g,"")).trim().length?(new DOMParser).parseFromString(e,"text/html"):(new DOMParser).parseFromString(t,"text/html")).body.textContent||""}(x.sanitize(L));n.trim().length>0&&u.ZP.sendMessage(G,i.firstName,i.lastName,t,i.walletAddress,"object"===typeof e?e.value:n,"object"===typeof e?e.notDisplayedValue:null)}},Be=function(e){Ne({headline:"File is loading, please wait...",description:""}),he(!0);var t=new FormData;t.append("files",e),(0,f.cT)(t).then((function(e){var t="";null!==I&&void 0!==I&&I.profileImage&&(t=null===I||void 0===I?void 0:I.profileImage),e.data.results.map(function(){var e=(0,l.Z)((0,a.Z)().mark((function e(n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={firstName:i.firstName,lastName:i.lastName,walletAddress:i.walletAddress,chatName:ne.name,userAvatar:t,createdAt:n.createdAt,expiresAt:n.expiresAt,fileName:n.filename,isVisible:n.isVisible,location:n.location,locationPreview:n.locationPreview,mimetype:n.mimetype,originalName:n.originalname,ownerKey:n.ownerKey,size:n.size,duration:null===n||void 0===n?void 0:n.duration,updatedAt:n.updatedAt,userId:n.userId,waveForm:"",attachmentId:n._id,wrappable:!0},u.ZP.sendMediaMessageStanza(G,r),he(!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).catch((function(e){console.log(e),Ne({headline:"Error",description:"An error occurred while uploading the file"}),je(!0)})),re.current&&(re.current.value="")};return(0,r.useEffect)((function(){var e=setTimeout((function(){u.ZP.pausedComposing(i.walletAddress,ne.jid)}),1e3);return function(){return clearTimeout(e)}}),[L]),(0,r.useEffect)((function(){w&&(Ie&&"none"!==Ie&&""!==Ie&&w.split("@")[0]!==Ie||(w.split("@")[1]?Te(w):Te(w+"@conference.dev.dxmpp.com"))),w.split("@")[0]!==Ie&&"none"!==Ie&&""!==Ie&&(m.K.getState().setCurrentUntrackedChatRoom(Ie),Te(Ie)),window.onblur=function(){m.K.getState().setCurrentUntrackedChatRoom("")},window.onfocus=function(){G&&(m.K.getState().setCurrentUntrackedChatRoom(G),m.K.getState().clearCounterChatRoom(G))}}),[G]),(0,r.useEffect)((function(){var e=n.filter((function(e){return e.roomJID===G}));if(!j&&e.length>0&&e.length<=51&&G&&Le){var t=e[0];e.length>=10&&e.length<15&&t.data.isSystemMessage?(Me(!1),u.ZP.getPaginatedArchive(G,String(t.id),5)):1===e.length&&(Me(!1),u.ZP.getPaginatedArchive(G,String(t.id),50))}}),[n]),(0,E.jsxs)(d.Z,{style:{paddingBlock:"20px",height:"100%"},children:[(0,E.jsxs)(v.tz,{responsive:!0,children:[(0,E.jsxs)(v.YE,{position:"left",scrollable:!1,children:[(0,E.jsx)(v.ol,{placeholder:"Search..."}),(0,E.jsx)(v.p7,{loading:j,children:fe(o,Pe).map((function(e){return(0,E.jsx)(v.ri,{active:e.jid===G,unreadCnt:e.unreadMessages,onClick:function(){return Te(e.jid)},name:e.name,info:_e(e.jid),lastActivityTime:Fe(e.jid),children:(0,E.jsx)(v.qE,{src:"none"!==e.room_thumbnail?e.room_thumbnail:"https://icotar.com/initials/"+e.name})},e.jid)}))})]}),(0,E.jsx)("div",(0,s.Z)((0,s.Z)({},Ee()),{},{style:{width:"100%",height:"100%"},children:(0,E.jsxs)(v.uU,{children:[!!ne&&(0,E.jsxs)(v.BU,{children:[(0,E.jsx)(v.BU.Back,{}),n.filter((function(e){return e.roomJID===G})).length>0&&(0,E.jsx)(v.BU.Content,{userName:ne.name,onClick:function(){De.push("/chatDetails/"+w)},info:"Active "+(0,h.Z)((0,g.Z)(new Date(n.filter((function(e){return e.roomJID===G})).slice(-1)[0].date),0),new Date,{addSuffix:!0})}),(0,E.jsx)(v.BU.Actions,{children:(0,E.jsx)(Z.Z,{sx:{color:"black"},onClick:function(){return be(!0)},children:(0,E.jsx)(de.Z,{})})})]}),(0,E.jsxs)(v.rN,{style:{backgroundImage:null!==X&&void 0!==X&&X.room_background?"url(".concat(X.room_background,")"):"white",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%"},loadingMore:j,onYReachStart:function(){var e=n.filter((function(e){return e.roomJID===G}));if(!j){var t=e[0].id;u.ZP.getPaginatedArchive(G,String(t),10)}},disableOnYReachWhenNoScroll:!0,typingIndicator:!(null===(e=o.filter((function(e){return e.jid===G}))[0])||void 0===e||!e.composing)&&(0,E.jsx)(v.c2,{style:{opacity:".6"},content:null===(t=o.filter((function(e){return e.jid===G}))[0])||void 0===t?void 0:t.composing}),children:[n.filter((function(e){return e.roomJID===G})).map((function(e,t,n){var i,r,o,s,a=function(e,t,n){var i,r,o,s,a,l,c,d=null===(i=e[n-1])||void 0===i||null===(r=i.data.senderJID)||void 0===r?void 0:r.split("/")[0],u=null===(o=e[n+1])||void 0===o||null===(s=o.data.senderJID)||void 0===s?void 0:s.split("/")[0],m=null===(a=t.data.senderJID)||void 0===a?void 0:a.split("/")[0],f={position:"single",type:"single"};return e[n-1]&&t&&(0,p.Z)(new Date(null===(c=e[n-1])||void 0===c?void 0:c.date),"dd")!==(0,p.Z)(new Date(t.date),"dd")&&(f.separator=(0,p.Z)(new Date(t.date),"EEEE, dd LLLL yyyy")),d!==m&&u!==m?f:d!==m&&u===m?(f.position="first",f.type="first",f):d===m&&u===m?(f.position="normal",f.type="normal",f):d===m&&u!==m&&"false"===(null===(l=e[n-1])||void 0===l?void 0:l.data.isSystemMessage)?(f.position="single",f.type="last",f):f}(n,e,t);return"false"===e.data.isSystemMessage?(0,E.jsx)(T,{is:"Message",position:a,message:e,userJid:null===(i=u.ZP.client)||void 0===i||null===(r=i.jid)||void 0===r?void 0:r.toString(),buttonSender:We,chooseDirectRoom:Te},e.id):(0,E.jsx)(U,{is:"Message",message:e,userJid:null===(o=u.ZP.client)||void 0===o||null===(s=o.jid)||void 0===s?void 0:s.toString()},e.id)})),n.length<=0||!G||"none@conference.dev.dxmpp.com"===G&&(0,E.jsx)(v.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:j?"Loading...":(0,E.jsx)("span",{children:G&&"none@conference.dev.dxmpp.com"!==G?null:"Choose a chat room or create one to start a conversation."})}),!j&&G&&"none@conference.dev.dxmpp.com"!==G&&n.filter((function(e){return e.roomJID===G})).length<=0&&(0,E.jsxs)(v.rN.Content,{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"100%",textAlign:"center",fontSize:"1.2em"},children:["Message list is empty ",G]})]}),!(null===ne||void 0===ne||!ne.name)&&(0,E.jsxs)("div",{is:"MessageInput",children:[(0,E.jsx)(v.Ru,{onPaste:function(e){var t=Array.from(e.clipboardData.items).find((function(e){return/^image\//.test(e.type)}));if(t){var n=t.getAsFile();Be(n)}},placeholder:"Type message here",onChange:function(e){M(e),u.ZP.isComposing(i.walletAddress,ne.jid,i.firstName+" "+i.lastName)},onSend:We,onAttachClick:function(){return re.current.click()}}),(0,E.jsx)("input",{type:"file",name:"file",id:"file",onChange:function(e){return Be(e.target.files[0])},ref:re,style:{display:"none"}})]})]})}))]}),(0,E.jsxs)(S.Z,{fullScreen:se,open:pe,onClose:function(){return he(!0)},"aria-labelledby":"responsive-dialog-title",children:[(0,E.jsx)(W.Z,{id:"responsive-dialog-title",children:Se.headline}),(0,E.jsx)(N.Z,{children:ve&&Se.description.length>0?(0,E.jsx)(B.Z,{children:Se.description}):(0,E.jsx)(d.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,E.jsx)(O.Z,{})})}),ve?(0,E.jsx)(H.Z,{children:(0,E.jsx)(C.Z,{onClick:function(){return he(!1)},autoFocus:!0,children:"Close"})}):null]}),(0,E.jsx)(ue.z,{open:we,link:(0,me.C$)({roomAddress:null===X||void 0===X?void 0:X.jid}),onClose:function(){be(!1)},title:"Share Chatroom"}),(0,E.jsx)(ce,{open:K||Ke,chatId:G.split("@")[0],onClose:function(){Y(!1),Ke&&Je("")}})]})}function he(){return(0,E.jsx)(o.Z,{maxWidth:"xl",style:{height:"calc(100vh - 68px)"},children:(0,E.jsx)(pe,{})})}}}]);
//# sourceMappingURL=463.1cff371b.chunk.js.map